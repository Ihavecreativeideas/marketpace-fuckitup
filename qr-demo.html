<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Code Demo - MarketPace</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1a0b3d 0%, #2d1b4e 25%, #4b0082 50%, #191970 75%, #00008b 100%);
            color: #e2e8f0;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .marketpace-logo {
            background: linear-gradient(135deg, #2a0845, #1a0033);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 48px;
            font-weight: bold;
            margin-bottom: 10px;
            text-shadow: 0 0 20px #4169e1;
            filter: drop-shadow(0 0 10px #0066ff);
        }

        .subtitle {
            color: rgba(255, 255, 255, 0.7);
            font-size: 18px;
            margin-bottom: 30px;
        }

        .demo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .demo-card {
            background: rgba(16, 24, 48, 0.9);
            border: 2px solid rgba(0, 255, 255, 0.3);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .card-title {
            color: #00ffff;
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }

        .qr-display {
            text-align: center;
            margin: 20px 0;
        }

        .qr-image {
            border: 3px solid rgba(0, 255, 255, 0.5);
            border-radius: 10px;
            margin-bottom: 15px;
            max-width: 200px;
            width: 100%;
        }

        .qr-placeholder {
            width: 200px;
            height: 200px;
            background: rgba(0, 0, 0, 0.3);
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            color: rgba(255, 255, 255, 0.5);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            color: rgba(255, 255, 255, 0.8);
            font-weight: bold;
            margin-bottom: 8px;
            display: block;
        }

        .form-select, .form-input {
            width: 100%;
            padding: 12px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: #e2e8f0;
            font-size: 14px;
        }

        .form-select:focus, .form-input:focus {
            outline: none;
            border-color: #00ffff;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
        }

        .btn {
            background: linear-gradient(135deg, #00ffff, #0066ff);
            color: #000;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 255, 255, 0.3);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            color: #e2e8f0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .qr-info {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }

        .qr-info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .status-message {
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            text-align: center;
            font-weight: bold;
        }

        .status-success {
            background: rgba(34, 197, 94, 0.2);
            border: 1px solid rgba(34, 197, 94, 0.5);
            color: #22c55e;
        }

        .status-error {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.5);
            color: #ef4444;
        }

        .purpose-examples {
            margin-top: 30px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
        }

        .purpose-title {
            color: #ffd700;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }

        .purpose-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }

        .purpose-item {
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 5px;
            padding: 8px;
            font-size: 12px;
            text-align: center;
        }

        @media (max-width: 768px) {
            .demo-grid {
                grid-template-columns: 1fr;
            }
            
            .marketpace-logo {
                font-size: 32px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="marketpace-logo">MarketPace</div>
            <div class="subtitle">QR Code System Demo & Testing Platform</div>
        </div>

        <div class="demo-grid">
            <!-- QR Code Generator -->
            <div class="demo-card">
                <div class="card-title">Generate QR Code</div>
                
                <div class="form-group">
                    <label class="form-label">User ID</label>
                    <input type="text" class="form-input" id="userId" value="demo-user-123" placeholder="Enter user ID">
                </div>

                <div class="form-group">
                    <label class="form-label">Purpose</label>
                    <select class="form-select" id="purpose">
                        <option value="pickup">Order Pickup</option>
                        <option value="service_checkin">Service Check-in</option>
                        <option value="business_booking">Business Booking</option>
                        <option value="rental_self_pickup">Rental Self Pickup</option>
                        <option value="rental_self_return">Rental Self Return</option>
                        <option value="rental_driver_pickup_owner">Driver Pickup (Owner)</option>
                        <option value="rental_driver_dropoff_renter">Driver Dropoff (Renter)</option>
                        <option value="rental_driver_pickup_renter">Driver Pickup (Renter)</option>
                        <option value="rental_driver_return_owner">Driver Return (Owner)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Related ID</label>
                    <input type="text" class="form-input" id="relatedId" value="order-456" placeholder="Order/Rental/Booking ID">
                </div>

                <div class="form-group">
                    <label class="form-label">Expiry Hours</label>
                    <select class="form-select" id="expiryHours">
                        <option value="1">1 Hour</option>
                        <option value="6">6 Hours</option>
                        <option value="12">12 Hours</option>
                        <option value="24" selected>24 Hours</option>
                        <option value="48">48 Hours</option>
                    </select>
                </div>

                <button class="btn" onclick="generateQRCode()" id="generateBtn">Generate QR Code</button>

                <div class="qr-display">
                    <div id="qrPlaceholder" class="qr-placeholder">
                        QR Code will appear here
                    </div>
                    <img id="qrImage" class="qr-image" style="display: none;" alt="Generated QR Code">
                </div>

                <div id="qrInfo" class="qr-info" style="display: none;">
                    <div class="qr-info-row">
                        <span>QR ID:</span>
                        <span id="qrIdDisplay">-</span>
                    </div>
                    <div class="qr-info-row">
                        <span>Expires:</span>
                        <span id="expiryDisplay">-</span>
                    </div>
                    <div class="qr-info-row">
                        <span>Verification URL:</span>
                        <span id="urlDisplay">-</span>
                    </div>
                </div>

                <div id="generateStatus"></div>
            </div>

            <!-- QR Code Scanner/Verifier -->
            <div class="demo-card">
                <div class="card-title">QR Code Verification</div>
                
                <div class="form-group">
                    <label class="form-label">QR Code ID</label>
                    <input type="text" class="form-input" id="scanQrId" placeholder="Enter QR Code ID to verify">
                </div>

                <div class="form-group">
                    <label class="form-label">Scanned By (User ID)</label>
                    <input type="text" class="form-input" id="scannedBy" value="scanner-user-789" placeholder="Enter scanner user ID">
                </div>

                <button class="btn" onclick="verifyQRCode()" id="verifyBtn">Verify QR Code</button>
                <button class="btn btn-secondary" onclick="fillFromGenerated()">Use Generated QR</button>

                <div id="verifyStatus"></div>

                <div id="verifyDetails" style="display: none;">
                    <div class="qr-info">
                        <div class="qr-info-row">
                            <span>Purpose:</span>
                            <span id="verifyPurpose">-</span>
                        </div>
                        <div class="qr-info-row">
                            <span>Related ID:</span>
                            <span id="verifyRelatedId">-</span>
                        </div>
                        <div class="qr-info-row">
                            <span>Next Action:</span>
                            <span id="verifyNextAction">-</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- API Testing -->
            <div class="demo-card">
                <div class="card-title">API Testing</div>
                
                <button class="btn" onclick="testGenerateAPI()">Test Generate API</button>
                <button class="btn" onclick="testVerifyAPI()">Test Verify API</button>
                <button class="btn btn-secondary" onclick="testGetUserQRs()">Get User QR Codes</button>

                <div id="apiResults" style="margin-top: 20px; max-height: 300px; overflow-y: auto; background: rgba(0,0,0,0.2); border-radius: 8px; padding: 15px; font-family: monospace; font-size: 12px;">
                    <div style="color: rgba(255,255,255,0.7);">API test results will appear here...</div>
                </div>
            </div>
        </div>

        <!-- Purpose Examples -->
        <div class="purpose-examples">
            <div class="purpose-title">QR Code Purposes & Use Cases</div>
            <div class="purpose-list">
                <div class="purpose-item">pickup - Order Pickup Confirmation</div>
                <div class="purpose-item">service_checkin - Service Attendance</div>
                <div class="purpose-item">business_booking - Business Booking Confirm</div>
                <div class="purpose-item">rental_self_pickup - Renter Picks Up Item</div>
                <div class="purpose-item">rental_self_return - Renter Returns Item</div>
                <div class="purpose-item">rental_driver_pickup_owner - Driver Gets from Owner</div>
                <div class="purpose-item">rental_driver_dropoff_renter - Driver Delivers to Renter</div>
                <div class="purpose-item">rental_driver_pickup_renter - Driver Gets from Renter</div>
                <div class="purpose-item">rental_driver_return_owner - Driver Returns to Owner</div>
            </div>
        </div>
    </div>

    <script>
        let generatedQRData = null;

        async function generateQRCode() {
            const generateBtn = document.getElementById('generateBtn');
            const userId = document.getElementById('userId').value;
            const purpose = document.getElementById('purpose').value;
            const relatedId = document.getElementById('relatedId').value;
            const expiryHours = parseInt(document.getElementById('expiryHours').value);

            if (!userId || !purpose || !relatedId) {
                showStatus('generateStatus', 'Please fill in all required fields', 'error');
                return;
            }

            generateBtn.disabled = true;
            generateBtn.textContent = 'Generating...';

            try {
                const response = await fetch('/api/generate-qr', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        userId,
                        purpose,
                        relatedId,
                        expiryHours
                    }),
                });

                const result = await response.json();

                if (result.success) {
                    generatedQRData = result.qrCode;
                    displayQRCode(result.qrCode);
                    showStatus('generateStatus', 'QR Code generated successfully!', 'success');
                } else {
                    showStatus('generateStatus', `Error: ${result.error}`, 'error');
                }

            } catch (error) {
                console.error('Generate QR error:', error);
                showStatus('generateStatus', 'Network error. Please try again.', 'error');
            } finally {
                generateBtn.disabled = false;
                generateBtn.textContent = 'Generate QR Code';
            }
        }

        function displayQRCode(qrData) {
            const placeholder = document.getElementById('qrPlaceholder');
            const image = document.getElementById('qrImage');
            const info = document.getElementById('qrInfo');

            placeholder.style.display = 'none';
            image.style.display = 'block';
            image.src = qrData.qrImage;
            info.style.display = 'block';

            document.getElementById('qrIdDisplay').textContent = qrData.id;
            document.getElementById('expiryDisplay').textContent = new Date(qrData.expiresAt).toLocaleString();
            document.getElementById('urlDisplay').textContent = qrData.verificationUrl;
        }

        async function verifyQRCode() {
            const verifyBtn = document.getElementById('verifyBtn');
            const qrCodeId = document.getElementById('scanQrId').value;
            const scannedBy = document.getElementById('scannedBy').value;

            if (!qrCodeId || !scannedBy) {
                showStatus('verifyStatus', 'Please fill in QR Code ID and Scanner User ID', 'error');
                return;
            }

            verifyBtn.disabled = true;
            verifyBtn.textContent = 'Verifying...';

            try {
                const response = await fetch('/api/verify-qr', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        qrCodeId,
                        scannedBy
                    }),
                });

                const result = await response.json();

                if (result.success) {
                    showStatus('verifyStatus', result.message, 'success');
                    displayVerifyDetails(result);
                } else {
                    showStatus('verifyStatus', `Error: ${result.message}`, 'error');
                }

            } catch (error) {
                console.error('Verify QR error:', error);
                showStatus('verifyStatus', 'Network error. Please try again.', 'error');
            } finally {
                verifyBtn.disabled = false;
                verifyBtn.textContent = 'Verify QR Code';
            }
        }

        function displayVerifyDetails(result) {
            const details = document.getElementById('verifyDetails');
            details.style.display = 'block';

            document.getElementById('verifyPurpose').textContent = result.purpose || 'N/A';
            document.getElementById('verifyRelatedId').textContent = result.relatedId || 'N/A';
            document.getElementById('verifyNextAction').textContent = result.nextAction || 'N/A';
        }

        function fillFromGenerated() {
            if (generatedQRData) {
                document.getElementById('scanQrId').value = generatedQRData.id;
                showStatus('verifyStatus', 'Filled with generated QR Code ID', 'success');
            } else {
                showStatus('verifyStatus', 'No QR code generated yet', 'error');
            }
        }

        async function testGenerateAPI() {
            logAPI('Testing Generate QR API...');
            try {
                const response = await fetch('/api/generate-qr', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        userId: 'test-user-' + Date.now(),
                        purpose: 'pickup',
                        relatedId: 'test-order-' + Date.now(),
                        expiryHours: 1
                    }),
                });
                const result = await response.json();
                logAPI('Generate API Response:', result);
            } catch (error) {
                logAPI('Generate API Error:', error.message);
            }
        }

        async function testVerifyAPI() {
            if (!generatedQRData) {
                logAPI('No QR code generated yet. Please generate one first.');
                return;
            }

            logAPI('Testing Verify QR API...');
            try {
                const response = await fetch('/api/verify-qr', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        qrCodeId: generatedQRData.id,
                        scannedBy: 'test-scanner-' + Date.now()
                    }),
                });
                const result = await response.json();
                logAPI('Verify API Response:', result);
            } catch (error) {
                logAPI('Verify API Error:', error.message);
            }
        }

        async function testGetUserQRs() {
            const userId = document.getElementById('userId').value || 'demo-user-123';
            logAPI(`Testing Get User QR Codes for user: ${userId}`);
            try {
                const response = await fetch(`/api/qr-codes/user/${userId}`);
                const result = await response.json();
                logAPI('Get User QRs Response:', result);
            } catch (error) {
                logAPI('Get User QRs Error:', error.message);
            }
        }

        function logAPI(message, data = null) {
            const results = document.getElementById('apiResults');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.style.marginBottom = '10px';
            logEntry.style.borderBottom = '1px solid rgba(255,255,255,0.1)';
            logEntry.style.paddingBottom = '10px';
            
            let content = `[${timestamp}] ${message}`;
            if (data) {
                content += '\n' + JSON.stringify(data, null, 2);
            }
            
            logEntry.textContent = content;
            results.appendChild(logEntry);
            results.scrollTop = results.scrollHeight;
        }

        function showStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="status-message status-${type}">${message}</div>`;
            setTimeout(() => {
                element.innerHTML = '';
            }, 5000);
        }

        // Auto-fill demo data on page load
        window.addEventListener('load', () => {
            const now = Date.now();
            document.getElementById('userId').value = `demo-user-${now}`;
            document.getElementById('relatedId').value = `order-${now}`;
            document.getElementById('scannedBy').value = `scanner-${now}`;
        });
    </script>
</body>
</html>