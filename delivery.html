<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Deliveries - MarketPace</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0d0221 0%, #1a0233 50%, #2d1b69 100%);
            color: white;
            min-height: 100vh;
            padding-bottom: 80px;
        }

        /* Floating Particles */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: rgba(0, 255, 255, 0.6);
            border-radius: 50%;
            animation: float 6s infinite ease-in-out;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); opacity: 0.6; }
            50% { transform: translateY(-20px) rotate(180deg); opacity: 1; }
        }

        /* Header */
        .header {
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(0, 255, 255, 0.2);
            padding: 12px 16px;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 600px;
            margin: 0 auto;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            background: linear-gradient(135deg, #00ff88, #00cc6a);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Main Content */
        .main-content {
            max-width: 600px;
            margin: 0 auto;
            padding: 0 16px;
            position: relative;
            z-index: 10;
        }

        .page-title {
            font-size: 28px;
            text-align: center;
            margin: 20px 0;
            background: linear-gradient(135deg, #00ff88, #00cc6a);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 20px rgba(0, 255, 136, 0.3);
        }

        /* Tab Navigation */
        .tab-navigation {
            display: flex;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 4px;
            margin: 20px 0;
        }

        .tab-btn {
            flex: 1;
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.6);
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #00ff88, #00cc6a);
            color: #000;
        }

        /* Delivery Cards */
        .deliveries-grid {
            display: grid;
            gap: 16px;
            margin-bottom: 20px;
        }

        .delivery-card {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 16px;
            backdrop-filter: blur(10px);
        }

        .delivery-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .delivery-type {
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 20px;
            font-weight: bold;
        }

        .delivery-type.purchase {
            background: rgba(0, 100, 255, 0.3);
            color: #64b5f6;
            border: 1px solid rgba(0, 100, 255, 0.5);
        }

        .delivery-type.sale {
            background: rgba(255, 50, 50, 0.3);
            color: #ff8a80;
            border: 1px solid rgba(255, 50, 50, 0.5);
        }

        .delivery-status {
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 20px;
            font-weight: bold;
        }

        .delivery-status.picked-up {
            background: rgba(255, 217, 61, 0.3);
            color: #ffd93d;
        }

        .delivery-status.in-transit {
            background: rgba(0, 255, 136, 0.3);
            color: #00ff88;
        }

        .delivery-status.delivered {
            background: rgba(76, 175, 80, 0.3);
            color: #4caf50;
        }

        .delivery-status.returned {
            background: rgba(255, 87, 34, 0.3);
            color: #ff5722;
        }

        .item-info {
            margin: 12px 0;
        }

        .item-name {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 4px;
        }

        .item-details {
            font-size: 14px;
            opacity: 0.8;
            margin-bottom: 8px;
        }

        .driver-info {
            display: flex;
            align-items: center;
            margin: 12px 0;
            padding: 8px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
        }

        .driver-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #00ff88, #00cc6a);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #000;
            margin-right: 12px;
        }

        .driver-details h4 {
            margin: 0;
            font-size: 14px;
        }

        .driver-details .rating {
            font-size: 12px;
            color: #ffd93d;
        }

        .route-progress {
            margin: 12px 0;
        }

        .route-info {
            font-size: 12px;
            margin-bottom: 8px;
            opacity: 0.8;
        }

        .progress-bar {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            height: 8px;
            margin-bottom: 8px;
        }

        .progress-fill {
            background: linear-gradient(135deg, #00ff88, #00cc6a);
            height: 100%;
            border-radius: 10px;
            transition: width 0.3s ease;
        }

        .stops-list {
            font-size: 11px;
            opacity: 0.7;
        }

        .delivery-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .action-btn {
            flex: 1;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 12px;
            text-align: center;
        }

        .action-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-1px);
        }

        .action-btn.primary {
            background: linear-gradient(135deg, #00ff88, #00cc6a);
            color: #000;
        }

        .action-btn.danger {
            background: linear-gradient(135deg, #ff5722, #ff8a80);
            color: #000;
        }

        .cost-breakdown {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            margin: 8px 0;
            padding: 8px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 6px;
        }

        .notification-banner {
            background: linear-gradient(135deg, #ff6b6b, #ffd93d);
            color: #000;
            padding: 12px;
            border-radius: 8px;
            margin: 16px 0;
            text-align: center;
            font-weight: bold;
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            z-index: 1000;
        }

        .nav-container {
            display: flex;
            max-width: 600px;
            margin: 0 auto;
        }

        .nav-item {
            flex: 1;
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.6);
            padding: 8px 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .nav-item.active {
            color: #00ff88;
        }

        .nav-icon {
            font-size: 18px;
            margin-bottom: 4px;
        }

        .nav-label {
            font-size: 10px;
        }

        /* Honor System Features */
        .delivery-size-info {
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid rgba(0, 255, 136, 0.3);
            border-radius: 8px;
            padding: 12px;
            margin: 8px 0;
            font-size: 12px;
        }

        .size-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
            margin-right: 8px;
        }

        .size-small { background: rgba(0, 255, 136, 0.2); color: #00ff88; }
        .size-medium { background: rgba(255, 193, 7, 0.2); color: #ffc107; }
        .size-large { background: rgba(255, 107, 107, 0.2); color: #ff6b6b; }
        .size-bulk { background: rgba(138, 43, 226, 0.2); color: #8a2be2; }

        .honor-system-notice {
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid rgba(255, 193, 7, 0.3);
            border-radius: 8px;
            padding: 12px;
            margin: 12px 0;
            font-size: 12px;
            text-align: center;
        }

        .delivery-fee-breakdown {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 12px;
            margin: 8px 0;
            font-size: 12px;
        }

        .fee-line {
            display: flex;
            justify-content: space-between;
            margin: 4px 0;
        }

        .fee-line.total {
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            padding-top: 8px;
            margin-top: 8px;
            font-weight: bold;
            color: #00ff88;
        }

        .honesty-rating {
            display: flex;
            align-items: center;
            margin: 8px 0;
            padding: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
            font-size: 12px;
        }

        .rating-stars {
            margin-left: 8px;
        }

        .star {
            color: #ffd93d;
            margin-right: 2px;
        }

        /* Rating Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .modal-content {
            background: linear-gradient(135deg, #0d0221 0%, #1a0233 50%, #2d1b69 100%);
            margin: 15% auto;
            padding: 20px;
            border-radius: 12px;
            width: 90%;
            max-width: 400px;
            border: 1px solid rgba(0, 255, 136, 0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 18px;
            color: #00ff88;
        }

        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
        }

        .rating-stars {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin: 20px 0;
        }

        .star {
            font-size: 32px;
            color: rgba(255, 255, 255, 0.3);
            cursor: pointer;
            transition: color 0.2s ease;
        }

        .star.active {
            color: #ffd93d;
        }

        .tip-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin: 16px 0;
        }

        .tip-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tip-btn.selected {
            background: linear-gradient(135deg, #00ff88, #00cc6a);
            color: #000;
        }

        .form-input, .form-textarea {
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            padding: 10px;
            color: white;
            font-size: 14px;
            margin: 8px 0;
        }

        .form-textarea {
            height: 80px;
            resize: vertical;
        }

        .submit-btn {
            width: 100%;
            background: linear-gradient(135deg, #00ff88, #00cc6a);
            color: #000;
            border: none;
            padding: 12px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            font-size: 16px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <!-- Floating Particles -->
    <div class="particles" id="particles"></div>

    <!-- Header -->
    <div class="header">
        <div class="header-content">
            <div class="logo">🚚 My Deliveries</div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <h1 class="page-title">Delivery Dashboard</h1>

        <!-- Tab Navigation -->
        <div class="tab-navigation">
            <button class="tab-btn active" onclick="switchTab('current')">Current</button>
            <button class="tab-btn" onclick="switchTab('past')">Past Deliveries</button>
        </div>

        <!-- Current Deliveries -->
        <div id="current" class="content-section">
            <div class="honor-system-notice">
                ⚖️ Honor System Delivery Pricing: Choose item size honestly when placing orders. Drivers can rate buyer/seller honesty to maintain community trust.
            </div>
            
            <div class="notification-banner">
                📦 You have 2 active deliveries in progress
            </div>

            <div class="deliveries-grid">
                <!-- Current Delivery 1 -->
                <div class="delivery-card">
                    <div class="delivery-header">
                        <div class="delivery-type purchase">PURCHASE</div>
                        <div class="delivery-status in-transit">IN TRANSIT</div>
                    </div>

                    <div class="item-info">
                        <div class="item-name">Vintage Leather Jacket</div>
                        <div class="item-details">From: Sarah's Boutique • Order #MP1234</div>
                        <div class="delivery-size-info">
                            <span class="size-badge size-small">Small Item</span>
                            <span style="opacity: 0.8;">Fits in garbage bag - No extra charge</span>
                        </div>
                        <div class="honesty-rating">
                            <span>Buyer Honesty Rating:</span>
                            <div class="rating-stars">
                                <span class="star">⭐</span><span class="star">⭐</span><span class="star">⭐</span><span class="star">⭐</span><span class="star">⭐</span>
                            </div>
                        </div>
                    </div>

                    <div class="driver-info">
                        <div class="driver-avatar">MJ</div>
                        <div class="driver-details">
                            <h4>Mike Johnson</h4>
                            <div class="rating">⭐ 4.9 • 250+ deliveries</div>
                        </div>
                    </div>

                    <div class="route-progress">
                        <div class="route-info">Stop 3 of 6 • ETA: 25 minutes</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 50%;"></div>
                        </div>
                        <div class="stops-list">
                            ✅ Stop 1: Pickup (Sarah's Boutique)<br>
                            ✅ Stop 2: Downtown Electronics<br>
                            🚚 Stop 3: Garden Center (current)<br>
                            ⏳ Stop 4: Your delivery<br>
                            ⏳ Stop 5: Coffee shop delivery<br>
                            ⏳ Stop 6: Final pickup
                        </div>
                    </div>

                    <div class="delivery-fee-breakdown">
                        <div class="fee-line">
                            <span>Item Total:</span>
                            <span>$85.00</span>
                        </div>
                        <div class="fee-line">
                            <span>Small Item Delivery:</span>
                            <span>FREE</span>
                        </div>
                        <div class="fee-line">
                            <span>Your Share (50%):</span>
                            <span>$0.00</span>
                        </div>
                        <div class="fee-line total">
                            <span>Your Total:</span>
                            <span>$85.00</span>
                        </div>
                    </div>

                    <div class="delivery-actions">
                        <button class="action-btn primary" onclick="trackLive('MP1234')">📍 Track Live</button>
                        <button class="action-btn" onclick="contactDriver('mike-johnson')">💬 Message Driver</button>
                        <button class="action-btn" onclick="openSizeModal()">📦 Update Size</button>
                        <button class="action-btn danger" onclick="declineDelivery('MP1234')">❌ Decline</button>
                    </div>
                </div>

                <!-- Current Delivery 2 -->
                <div class="delivery-card">
                    <div class="delivery-header">
                        <div class="delivery-type sale">SALE</div>
                        <div class="delivery-status picked-up">PICKED UP</div>
                    </div>

                    <div class="item-info">
                        <div class="item-name">Garden Tool Set (3 items)</div>
                        <div class="item-details">To: Tom Wilson • Order #MP5678</div>
                        <div class="delivery-size-info">
                            <span class="size-badge size-medium">Medium Items</span>
                            <span style="opacity: 0.8;">Mixed sizes - Large item delivery charge applied</span>
                        </div>
                        <div class="honesty-rating">
                            <span>Seller Honesty Rating:</span>
                            <div class="rating-stars">
                                <span class="star">⭐</span><span class="star">⭐</span><span class="star">⭐</span><span class="star">⭐</span><span class="star">⭐</span>
                            </div>
                        </div>
                    </div>

                    <div class="driver-info">
                        <div class="driver-avatar">AR</div>
                        <div class="driver-details">
                            <h4>Amy Rodriguez</h4>
                            <div class="rating">⭐ 4.8 • 180+ deliveries</div>
                        </div>
                    </div>

                    <div class="route-progress">
                        <div class="route-info">Stop 1 of 4 • ETA: 45 minutes</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 25%;"></div>
                        </div>
                        <div class="stops-list">
                            ✅ Stop 1: Pickup (your item)<br>
                            🚚 Stop 2: Electronics store pickup<br>
                            ⏳ Stop 3: Book delivery<br>
                            ⏳ Stop 4: Tom Wilson delivery
                        </div>
                    </div>

                    <div class="delivery-fee-breakdown">
                        <div class="fee-line">
                            <span>Item Total:</span>
                            <span>$150.00</span>
                        </div>
                        <div class="fee-line">
                            <span>Large Item Delivery:</span>
                            <span>$25.00</span>
                        </div>
                        <div class="fee-line">
                            <span>Your Share (50%):</span>
                            <span>-$12.50</span>
                        </div>
                        <div class="fee-line">
                            <span>MarketPace Fee (5%):</span>
                            <span>-$7.50</span>
                        </div>
                        <div class="fee-line total">
                            <span>You Receive:</span>
                            <span>$130.00</span>
                        </div>
                    </div>

                    <div class="delivery-actions">
                        <button class="action-btn primary" onclick="trackLive('MP5678')">📍 Track Live</button>
                        <button class="action-btn" onclick="contactDriver('amy-rodriguez')">💬 Message Driver</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Past Deliveries -->
        <div id="past" class="content-section" style="display: none;">
            <div class="deliveries-grid">
                <!-- Past Delivery 1 -->
                <div class="delivery-card">
                    <div class="delivery-header">
                        <div class="delivery-type purchase">PURCHASE</div>
                        <div class="delivery-status delivered">DELIVERED</div>
                    </div>

                    <div class="item-info">
                        <div class="item-name">Smart Phone Case</div>
                        <div class="item-details">From: Tech Plus • Delivered Jan 8, 2025</div>
                    </div>

                    <div class="driver-info">
                        <div class="driver-avatar">DJ</div>
                        <div class="driver-details">
                            <h4>David Johnson</h4>
                            <div class="rating">⭐ 4.7 • 320+ deliveries</div>
                        </div>
                    </div>

                    <div class="cost-breakdown">
                        <span>Delivery Fee: $6.00</span>
                        <span>Tip Given: $3.00</span>
                    </div>

                    <div class="delivery-actions">
                        <button class="action-btn primary" onclick="rateDriver('david-johnson', 'MP9999')">⭐ Rate & Review</button>
                        <button class="action-btn" onclick="rateHonesty('david-johnson', 'MP9999')">⚖️ Rate Honesty</button>
                        <button class="action-btn" onclick="tipDriver('david-johnson')">💰 Add Tip</button>
                        <button class="action-btn" onclick="viewReceipt('MP9999')">📄 Receipt</button>
                    </div>
                </div>

                <!-- Past Delivery 2 -->
                <div class="delivery-card">
                    <div class="delivery-header">
                        <div class="delivery-type sale">SALE</div>
                        <div class="delivery-status returned">RETURNED</div>
                    </div>

                    <div class="item-info">
                        <div class="item-name">Vintage Camera</div>
                        <div class="item-details">To: Lisa Chen • Returned Jan 7, 2025</div>
                    </div>

                    <div class="driver-info">
                        <div class="driver-avatar">MR</div>
                        <div class="driver-details">
                            <h4>Maria Rodriguez</h4>
                            <div class="rating">⭐ 4.9 • 410+ deliveries</div>
                        </div>
                    </div>

                    <div class="cost-breakdown">
                        <span>Return Fee: $4.50</span>
                        <span>Your Loss: -$54.50</span>
                    </div>

                    <div class="delivery-actions">
                        <button class="action-btn" onclick="viewReturnReason('MP7777')">📋 Return Reason</button>
                        <button class="action-btn" onclick="rateDriver('maria-rodriguez', 'MP7777')">⭐ Rate Driver</button>
                    </div>
                </div>

                <!-- Past Delivery 3 -->
                <div class="delivery-card">
                    <div class="delivery-header">
                        <div class="delivery-type purchase">PURCHASE</div>
                        <div class="delivery-status delivered">DELIVERED</div>
                    </div>

                    <div class="item-info">
                        <div class="item-name">Coffee Beans (2lb)</div>
                        <div class="item-details">From: Local Roasters • Delivered Jan 5, 2025</div>
                    </div>

                    <div class="driver-info">
                        <div class="driver-avatar">ST</div>
                        <div class="driver-details">
                            <h4>Sam Taylor</h4>
                            <div class="rating">⭐ 5.0 • 150+ deliveries</div>
                        </div>
                    </div>

                    <div class="cost-breakdown">
                        <span>Delivery Fee: $5.50</span>
                        <span>Tip Given: $5.00</span>
                    </div>

                    <div class="delivery-actions">
                        <button class="action-btn" onclick="reorderItem('coffee-beans')">🔄 Reorder</button>
                        <button class="action-btn" onclick="viewReceipt('MP5555')">📄 Receipt</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Delivery Size Selection Modal -->
    <div id="sizeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Select Delivery Size</h2>
                <button class="close-btn" onclick="closeSizeModal()">&times;</button>
            </div>
            
            <div style="margin-bottom: 20px;">
                <p>Please honestly select your item size(s) and quantity:</p>
            </div>
            
            <div style="margin-bottom: 16px;">
                <label style="display: block; margin-bottom: 8px; color: #00ff88;">Number of Items:</label>
                <input type="number" id="itemQuantity" class="form-input" value="1" min="1" placeholder="How many items?">
            </div>
            
            <div style="margin-bottom: 16px;">
                <label style="display: block; margin-bottom: 8px; color: #00ff88;">Item Size:</label>
                <select id="itemSize" class="form-input" onchange="updatePricing()">
                    <option value="small">Small (Fits in garbage bag) - No extra fee</option>
                    <option value="medium">Medium (Larger than garbage bag) - +$25 oversized fee</option>
                    <option value="large">Large (Furniture, appliances) - +$25 oversized fee</option>
                    <option value="bulk">Large Bulk Delivery - +$25 oversized fee</option>
                </select>
            </div>
            
            <div style="background: rgba(255, 193, 7, 0.1); border: 1px solid rgba(255, 193, 7, 0.3); border-radius: 6px; padding: 12px; margin: 16px 0; font-size: 12px;">
                <strong>Honor System:</strong> Multiple small items that fit in one garbage bag = No extra fee. Mix of medium/large items or choosing "Large Bulk Delivery" = +$25 oversized fee.
            </div>
            
            <div id="sizePricing" style="margin: 16px 0; padding: 12px; background: rgba(0, 0, 0, 0.3); border-radius: 6px;">
                <div style="display: flex; justify-content: space-between;">
                    <span>Oversized Fee:</span>
                    <span id="deliveryFee">No extra fee</span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <span>Your Share (50%):</span>
                    <span id="yourShare">$0.00</span>
                </div>
            </div>
            
            <button class="submit-btn" onclick="confirmDeliverySize()">Confirm Delivery</button>
        </div>
    </div>

    <!-- Honesty Rating Modal -->
    <div id="honestyModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Rate Item Size Honesty</h2>
                <button class="close-btn" onclick="closeHonestyModal()">&times;</button>
            </div>
            
            <div style="margin-bottom: 20px;">
                <p>Was the item size accurately reported by the buyer/seller?</p>
            </div>
            
            <div class="rating-stars" id="honestyStars">
                <span class="star" onclick="setHonestyRating(1)">⭐</span>
                <span class="star" onclick="setHonestyRating(2)">⭐</span>
                <span class="star" onclick="setHonestyRating(3)">⭐</span>
                <span class="star" onclick="setHonestyRating(4)">⭐</span>
                <span class="star" onclick="setHonestyRating(5)">⭐</span>
            </div>
            
            <textarea class="form-textarea" id="honestyComment" placeholder="Optional: Explain any size discrepancies..."></textarea>
            
            <button class="submit-btn" onclick="submitHonestyRating()">Submit Rating</button>
        </div>
    </div>

    <!-- Rating/Review Modal -->
    <div id="ratingModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Rate Your Driver</h2>
                <button class="close-btn" onclick="closeRatingModal()">&times;</button>
            </div>
            
            <div style="text-align: center; margin-bottom: 20px;">
                <div id="driverName" style="font-size: 18px; margin-bottom: 8px;"></div>
                <div style="opacity: 0.7;">How was your delivery experience?</div>
            </div>

            <div class="rating-stars" id="ratingStars">
                <span class="star" onclick="setRating(1)">⭐</span>
                <span class="star" onclick="setRating(2)">⭐</span>
                <span class="star" onclick="setRating(3)">⭐</span>
                <span class="star" onclick="setRating(4)">⭐</span>
                <span class="star" onclick="setRating(5)">⭐</span>
            </div>

            <textarea class="form-textarea" id="reviewText" placeholder="Share your experience (optional)..."></textarea>

            <div style="margin: 16px 0;">
                <div style="margin-bottom: 8px; color: #ffd93d;">Add a tip (100% goes to driver):</div>
                <div class="tip-options">
                    <button class="tip-btn" onclick="selectTip(2)">$2</button>
                    <button class="tip-btn" onclick="selectTip(3)">$3</button>
                    <button class="tip-btn" onclick="selectTip(5)">$5</button>
                </div>
                <input type="number" class="form-input" id="customTip" placeholder="Custom tip amount" min="0" step="0.50">
            </div>

            <button class="submit-btn" onclick="submitRating()">Submit Rating & Tip</button>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <div class="bottom-nav">
        <div class="nav-container">
            <button class="nav-item" onclick="goToPage('home')">
                <div class="nav-icon">🏠</div>
                <div class="nav-label">Home</div>
            </button>
            <button class="nav-item" onclick="goToPage('shop')">
                <div class="nav-icon">🛍️</div>
                <div class="nav-label">Shops</div>
            </button>
            <button class="nav-item" onclick="goToPage('services')">
                <div class="nav-icon">🔧</div>
                <div class="nav-label">Services</div>
            </button>
            <button class="nav-item" onclick="goToPage('hub')">
                <div class="nav-icon">🎭</div>
                <div class="nav-label">The Hub</div>
            </button>
            <button class="nav-item active" onclick="goToPage('delivery')">
                <div class="nav-icon">🚚</div>
                <div class="nav-label">Delivery</div>
            </button>
            <button class="nav-item" onclick="goToPage('menu')">
                <div class="nav-icon">☰</div>
                <div class="nav-label">Menu</div>
            </button>
        </div>
    </div>

    <script>
        let currentRating = 0;
        let selectedTip = 0;
        let currentDriverId = '';
        let currentOrderId = '';

        // Initialize floating particles
        function createParticles() {
            const container = document.getElementById('particles');
            for (let i = 0; i < 50; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 6 + 's';
                particle.style.animationDuration = (Math.random() * 4 + 4) + 's';
                
                // Random colors
                const colors = ['rgba(0, 255, 255, 0.6)', 'rgba(0, 255, 136, 0.6)', 'rgba(255, 217, 61, 0.6)'];
                particle.style.background = colors[Math.floor(Math.random() * colors.length)];
                
                container.appendChild(particle);
            }
        }

        // Tab switching
        function switchTab(tab) {
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            // Show/hide content
            document.getElementById('current').style.display = tab === 'current' ? 'block' : 'none';
            document.getElementById('past').style.display = tab === 'past' ? 'block' : 'none';
        }

        // Navigation functions
        function goToPage(page) {
            // Update active nav item
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.closest('.nav-item').classList.add('active');

            // Navigate to different pages
            switch(page) {
                case 'home':
                    window.location.href = '/community';
                    break;
                case 'shop':
                    window.location.href = '/shops';
                    break;
                case 'services':
                    // Filter community for services
                    window.location.href = '/community?filter=services';
                    break;
                case 'hub':
                    window.location.href = '/the-hub';
                    break;
                case 'delivery':
                    // Already on delivery page
                    break;
                case 'menu':
                    window.location.href = '/menu';
                    break;
            }
        }

        // Delivery action functions
        function trackLive(orderId) {
            alert(`Opening live tracking for order ${orderId}...\n\nYou can see real-time driver location and estimated arrival time.`);
        }

        function contactDriver(driverId) {
            alert(`Opening message thread with ${driverId.replace('-', ' ')}...\n\nYou can send messages about delivery instructions or ask for updates.`);
        }

        function declineDelivery(orderId) {
            if (confirm('Are you sure you want to decline this delivery?\n\nNote: The item will be returned to the seller, and return fees may apply ($2 + $0.50/mile).')) {
                alert(`Delivery ${orderId} declined. The driver has been notified and will return the item to the seller.\n\nReturn routing has been optimized and may affect other delivery times.`);
                // In real app: update delivery status and re-route
            }
        }

        function rateDriver(driverId, orderId) {
            currentDriverId = driverId;
            currentOrderId = orderId;
            document.getElementById('driverName').textContent = driverId.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase());
            document.getElementById('ratingModal').style.display = 'block';
        }

        function closeRatingModal() {
            document.getElementById('ratingModal').style.display = 'none';
            currentRating = 0;
            selectedTip = 0;
            // Reset UI
            document.querySelectorAll('.star').forEach(star => star.classList.remove('active'));
            document.querySelectorAll('.tip-btn').forEach(btn => btn.classList.remove('selected'));
            document.getElementById('reviewText').value = '';
            document.getElementById('customTip').value = '';
        }

        function setRating(rating) {
            currentRating = rating;
            document.querySelectorAll('.star').forEach((star, index) => {
                star.classList.toggle('active', index < rating);
            });
        }

        function selectTip(amount) {
            selectedTip = amount;
            document.querySelectorAll('.tip-btn').forEach(btn => btn.classList.remove('selected'));
            event.target.classList.add('selected');
            document.getElementById('customTip').value = '';
        }

        function submitRating() {
            const customTip = parseFloat(document.getElementById('customTip').value) || 0;
            const finalTip = customTip > 0 ? customTip : selectedTip;
            const review = document.getElementById('reviewText').value;

            if (currentRating === 0) {
                alert('Please select a rating before submitting.');
                return;
            }

            alert(`Rating submitted!\n\n⭐ Rating: ${currentRating} stars\n💰 Tip: $${finalTip.toFixed(2)}\n📝 Review: ${review || 'No review provided'}\n\nThank you for your feedback! The driver has been notified.`);
            
            closeRatingModal();
        }

        function tipDriver(driverId) {
            const tip = prompt('Enter tip amount (100% goes to driver):', '3.00');
            if (tip && !isNaN(tip) && parseFloat(tip) > 0) {
                alert(`$${parseFloat(tip).toFixed(2)} tip sent to ${driverId.replace('-', ' ')}!\n\nThank you for supporting our drivers.`);
            }
        }

        function viewReceipt(orderId) {
            alert(`Opening receipt for order ${orderId}...\n\nDetailed breakdown of item cost, delivery fees, tips, and taxes.`);
        }

        function viewReturnReason(orderId) {
            alert(`Return reason for ${orderId}:\n\n"Item was damaged during shipping. Box was wet and contents were affected."\n\nReturn processed on Jan 7, 2025\nReturn fee: $4.50 (charged to seller)`);
        }

        function reorderItem(itemId) {
            alert(`Adding ${itemId.replace('-', ' ')} to your cart...\n\nWould you like to order from the same seller or browse other options?`);
        }

        // Honor System Functions
        let currentHonestyRating = 0;
        
        function openSizeModal() {
            document.getElementById('sizeModal').style.display = 'block';
            updatePricing();
        }
        
        function closeSizeModal() {
            document.getElementById('sizeModal').style.display = 'none';
        }
        
        function updatePricing() {
            const size = document.getElementById('itemSize').value;
            const quantity = parseInt(document.getElementById('itemQuantity').value) || 1;
            let fee = 0;
            let feeText = 'No extra fee';
            
            if (size === 'medium' || size === 'large' || size === 'bulk') {
                fee = 25;
                feeText = '+$25.00';
            }
            
            const yourShare = fee / 2;
            
            document.getElementById('deliveryFee').textContent = feeText;
            document.getElementById('yourShare').textContent = '$' + yourShare.toFixed(2);
        }
        
        async function confirmDeliverySize() {
            const size = document.getElementById('itemSize').value;
            const quantity = document.getElementById('itemQuantity').value;
            const orderId = 'MP1234'; // In real app, get from context
            
            try {
                const response = await fetch('/api/delivery/size', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ orderId, size, quantity })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    const feeText = data.deliveryFee === 0 ? 'No extra fee' : `+$${data.deliveryFee} oversized fee`;
                    alert(`Delivery size confirmed!\n\nItems: ${quantity}\nSize: ${size}\nOversized Fee: ${feeText}\nYour Share: $${data.yourShare.toFixed(2)}\n\nYour delivery has been updated. The driver will be notified of any changes.`);
                } else {
                    alert('Error updating delivery size: ' + data.message);
                }
            } catch (error) {
                alert('Network error updating delivery size. Please try again.');
                console.error('Error:', error);
            }
            
            closeSizeModal();
        }
        
        function rateHonesty(userId, orderId) {
            document.getElementById('honestyModal').style.display = 'block';
        }
        
        function closeHonestyModal() {
            document.getElementById('honestyModal').style.display = 'none';
            currentHonestyRating = 0;
            document.querySelectorAll('#honestyStars .star').forEach(star => star.classList.remove('active'));
            document.getElementById('honestyComment').value = '';
        }
        
        function setHonestyRating(rating) {
            currentHonestyRating = rating;
            document.querySelectorAll('#honestyStars .star').forEach((star, index) => {
                star.classList.toggle('active', index < rating);
            });
        }
        
        async function submitHonestyRating() {
            if (currentHonestyRating === 0) {
                alert('Please select a honesty rating before submitting.');
                return;
            }
            
            const comment = document.getElementById('honestyComment').value;
            const raterId = 'current-user'; // In real app, get from auth context
            const ratedUserId = 'other-user'; // In real app, get from delivery context  
            const orderId = 'MP9999'; // In real app, get from context
            
            try {
                const response = await fetch('/api/delivery/honesty-rating', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        raterId, 
                        ratedUserId, 
                        orderId, 
                        honestyScore: currentHonestyRating, 
                        comment 
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    const ratingText = currentHonestyRating >= 4 ? 'Accurate size reporting' : 'Size was not accurately reported';
                    alert(`Honesty rating submitted!\n\n⚖️ Rating: ${currentHonestyRating} stars\n📝 ${ratingText}\n${comment ? '💬 Comment: ' + comment : ''}\n\nThank you for helping maintain community trust!`);
                } else {
                    alert('Error submitting honesty rating: ' + data.message);
                }
            } catch (error) {
                alert('Network error submitting rating. Please try again.');
                console.error('Error:', error);
            }
            
            closeHonestyModal();
        }

        // Close modal when clicking outside
        window.addEventListener('click', function(e) {
            const ratingModal = document.getElementById('ratingModal');
            const sizeModal = document.getElementById('sizeModal');
            const honestyModal = document.getElementById('honestyModal');
            
            if (e.target === ratingModal) {
                closeRatingModal();
            } else if (e.target === sizeModal) {
                closeSizeModal();
            } else if (e.target === honestyModal) {
                closeHonestyModal();
            }
        });

        // Initialize particles when page loads
        createParticles();
    </script>
</body>
</html>