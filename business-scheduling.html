<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Scheduling - MarketPace</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: 
                radial-gradient(circle at 20% 20%, rgba(120, 119, 198, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(255, 119, 198, 0.12) 0%, transparent 50%),
                radial-gradient(circle at 40% 60%, rgba(0, 255, 255, 0.08) 0%, transparent 50%),
                linear-gradient(135deg, #0a0a0f 0%, #1a0d2e 30%, #0f1419 70%, #000000 100%);
            color: #e2e8f0;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(1px 1px at 25px 5px, rgba(255, 255, 255, 0.1), transparent),
                radial-gradient(1px 1px at 50px 25px, rgba(0, 255, 255, 0.1), transparent),
                radial-gradient(1px 1px at 125px 30px, rgba(255, 119, 198, 0.1), transparent);
            background-size: 150px 100px, 200px 120px, 250px 140px;
            pointer-events: none;
            z-index: -1;
        }

        /* Old header styles removed - replaced with streamlined header */

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Employee Avatar Colors */
        .employee-avatar.manager { background: linear-gradient(135deg, #8B4513, #A0522D); color: white; }
        .employee-avatar.cashier { background: linear-gradient(135deg, #00ff88, #00cc6a); color: black; }
        .employee-avatar.sales { background: linear-gradient(135deg, #ff6b9d, #ff4757); color: white; }
        .employee-avatar.stock { background: linear-gradient(135deg, #4169e1, #0066ff); color: white; }
        .employee-avatar.assistant { background: linear-gradient(135deg, #8a2be2, #6a1b9a); color: white; }
        .employee-avatar.security { background: linear-gradient(135deg, #ff4444, #cc0000); color: white; }

        .tab-content {
            display: none;
            background: transparent;
            padding-top: 0;
            margin-top: 0;
        }

        .tab-content.active {
            display: block;
        }

        /* Tab Container */
        .tab-container {
            background: transparent;
            width: 100%;
        }

        /* Ensure body and container have dark background */
        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }

        .container {
            background: transparent;
            padding: 0 20px;
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .card-title {
            font-size: 24px;
            font-weight: 600;
            color: #00ffff;
        }

        .btn {
            background: linear-gradient(135deg, #00ffff, #0066ff);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 255, 255, 0.3);
        }

        .btn-primary {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
        }

        /* Modern Schedule Header Styles */
        .schedule-header-card {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.12);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(10px);
        }

        .schedule-view-toggle {
            display: flex;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 12px;
            padding: 4px;
            gap: 4px;
        }

        .view-toggle-btn {
            background: none;
            border: none;
            color: #94a3b8;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            font-weight: 500;
        }

        .view-toggle-btn.active {
            background: linear-gradient(135deg, #00ffff, #0066ff);
            color: white;
            box-shadow: 0 4px 15px rgba(0, 255, 255, 0.3);
        }

        .schedule-actions {
            display: flex;
            gap: 12px;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }

        /* Date Navigation Card */
        .date-navigation-card {
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.1), rgba(0, 102, 255, 0.1));
            border: 1px solid rgba(0, 255, 255, 0.2);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-date-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #00ffff;
        }

        .nav-date-btn:hover {
            background: rgba(0, 255, 255, 0.2);
            transform: scale(1.05);
        }

        .current-date-display {
            text-align: center;
        }

        .date-main {
            font-size: 28px;
            font-weight: 700;
            color: #00ffff;
            margin-bottom: 4px;
        }

        .date-year {
            font-size: 16px;
            color: #94a3b8;
            margin-bottom: 8px;
        }

        .date-status {
            font-size: 14px;
            color: #ffd700;
            background: rgba(255, 215, 0, 0.1);
            padding: 4px 12px;
            border-radius: 20px;
            display: inline-block;
        }

        /* Quick Stats Styles */
        .quick-stats-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 16px;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .stat-icon {
            font-size: 24px;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #00ffff, #0066ff);
            border-radius: 12px;
        }

        .stat-number {
            font-size: 24px;
            font-weight: 700;
            color: #00ffff;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 13px;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Main Schedule Container */
        .main-schedule-container {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 24px;
        }

        .time-grid-header {
            display: grid;
            grid-template-columns: repeat(9, 1fr);
            gap: 8px;
            margin-bottom: 24px;
            padding: 0 20px;
        }

        .time-slot {
            text-align: center;
            font-size: 12px;
            font-weight: 500;
            color: #94a3b8;
            padding: 8px 4px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        /* Modern Employee Cards */
        .employee-cards-container {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .modern-employee-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 20px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .modern-employee-card:hover {
            transform: translateY(-2px);
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .employee-profile-section {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 16px;
        }

        .employee-avatar {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: 700;
            color: white;
            text-transform: uppercase;
        }

        .manager-avatar {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
        }

        .cashier-avatar {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .sales-avatar {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }

        .stock-avatar {
            background: linear-gradient(135deg, #8b5cf6, #a855f7);
        }

        .assistant-avatar {
            background: linear-gradient(135deg, #06b6d4, #0891b2);
        }

        .security-avatar {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
        }

        .employee-details {
            flex: 1;
        }

        .employee-name {
            font-size: 18px;
            font-weight: 600;
            color: #f8fafc;
            margin-bottom: 4px;
        }

        .employee-role {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .manager-role { color: #a78bfa; }
        .cashier-role { color: #34d399; }
        .sales-role { color: #fbbf24; }
        .stock-role { color: #c084fc; }
        .assistant-role { color: #22d3ee; }
        .security-role { color: #f87171; }

        .employee-status {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: #94a3b8;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #10b981;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .employee-actions {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #94a3b8;
        }

        .action-btn:hover {
            background: rgba(0, 255, 255, 0.2);
            color: #00ffff;
            transform: scale(1.1);
        }

        /* Shift Visual Timeline */
        .shift-visual-timeline {
            position: relative;
            height: 40px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            margin-top: 12px;
            overflow: hidden;
        }

        .shift-block {
            position: absolute;
            height: 100%;
            border-radius: 6px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 4px 8px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .shift-block:hover {
            transform: translateY(-2px);
            z-index: 10;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .manager-shift {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            border: 1px solid rgba(99, 102, 241, 0.5);
        }

        .cashier-shift {
            background: linear-gradient(135deg, #10b981, #059669);
            border: 1px solid rgba(16, 185, 129, 0.5);
        }

        .sales-shift {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            border: 1px solid rgba(245, 158, 11, 0.5);
        }

        .break-shift {
            background: linear-gradient(135deg, #64748b, #475569);
            border: 1px solid rgba(100, 116, 139, 0.5);
        }

        .stock-shift {
            background: linear-gradient(135deg, #8b5cf6, #a855f7);
            border: 1px solid rgba(139, 92, 246, 0.5);
        }

        .assistant-shift {
            background: linear-gradient(135deg, #06b6d4, #0891b2);
            border: 1px solid rgba(6, 182, 212, 0.5);
        }

        .security-shift {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            border: 1px solid rgba(220, 38, 38, 0.5);
        }

        .shift-label {
            font-size: 10px;
            font-weight: 600;
            color: white;
            line-height: 1;
            margin-bottom: 2px;
        }

        .shift-task {
            font-size: 9px;
            color: rgba(255, 255, 255, 0.8);
            line-height: 1;
        }

        /* Sleek Minimalist Header */
        .simple-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding: 8px 0;
            width: 100%;
        }

        .view-selector {
            display: flex;
            gap: 12px;
            align-items: center;
            flex-wrap: nowrap;
        }

        .view-btn {
            padding: 8px 16px;
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #e2e8f0;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
            font-size: 14px;
            white-space: nowrap;
            min-width: fit-content;
        }

        .view-btn:hover {
            border-color: rgba(0, 255, 255, 0.5);
            color: #00ffff;
        }

        .view-btn.active {
            background: rgba(0, 255, 255, 0.1);
            border-color: #00ffff;
            color: #00ffff;
        }

        .add-btn {
            background: transparent;
            border: 1px solid rgba(16, 185, 129, 0.5);
            color: #10b981;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 500;
            font-size: 14px;
            transition: all 0.2s ease;
            white-space: nowrap;
            min-width: fit-content;
        }

        .add-btn:hover {
            background: rgba(16, 185, 129, 0.1);
            border-color: #10b981;
            color: #34d399;
        }

        /* Calendar Container */
        .calendar-container {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid rgba(0, 255, 255, 0.1);
        }

        .date-header {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 24px;
            padding: 16px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 12px;
        }

        .nav-arrow {
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid rgba(0, 255, 255, 0.3);
            color: #00ffff;
            width: 40px;
            height: 40px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: bold;
            transition: all 0.2s ease;
        }

        .nav-arrow:hover {
            background: rgba(0, 255, 255, 0.2);
            transform: scale(1.05);
        }

        .week-range {
            color: #e2e8f0;
            font-size: 18px;
            font-weight: 600;
            min-width: 200px;
            text-align: center;
        }

        /* Calendar Grid */
        .calendar-grid {
            display: grid;
            grid-template-columns: 100px repeat(7, 1fr);
            gap: 2px;
            background: 
                radial-gradient(circle at 50% 0%, rgba(0, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 0% 50%, rgba(255, 20, 147, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 100% 50%, rgba(155, 89, 182, 0.05) 0%, transparent 50%),
                rgba(0, 0, 0, 0.6);
            border-radius: 16px;
            overflow: hidden;
            min-height: 1100px;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.4),
                0 0 60px rgba(0, 255, 255, 0.1),
                inset 0 0 60px rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(0, 255, 255, 0.2);
            position: relative;
        }
        
        .calendar-grid::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(0, 255, 255, 0.8) 30%, 
                rgba(255, 20, 147, 0.6) 70%, 
                transparent 100%);
            animation: scanline 4s ease-in-out infinite;
            z-index: 10;
        }
        
        @keyframes scanline {
            0%, 100% { transform: translateY(0); opacity: 0; }
            50% { transform: translateY(1100px); opacity: 1; }
        }

        .time-column {
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            flex-direction: column;
        }

        .time-header {
            height: 60px;
            background: rgba(0, 0, 0, 0.8);
            border-bottom: 1px solid rgba(0, 255, 255, 0.2);
        }

        .time-slot {
            height: 65px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #00ffff;
            font-size: 13px;
            font-weight: 700;
            border-bottom: 1px solid rgba(0, 255, 255, 0.2);
            background: 
                linear-gradient(90deg, 
                    rgba(0, 0, 0, 0.8) 0%, 
                    rgba(0, 255, 255, 0.05) 50%, 
                    rgba(0, 0, 0, 0.8) 100%);
            text-shadow: 
                0 0 8px rgba(0, 255, 255, 0.6),
                0 1px 4px rgba(0, 0, 0, 0.8);
            letter-spacing: 1px;
            transition: all 0.3s ease;
        }
        
        .time-slot:hover {
            background: 
                linear-gradient(90deg, 
                    rgba(0, 0, 0, 0.7) 0%, 
                    rgba(0, 255, 255, 0.1) 50%, 
                    rgba(0, 0, 0, 0.7) 100%);
            box-shadow: inset 0 0 15px rgba(0, 255, 255, 0.2);
        }

        .day-column {
            background: rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .day-header {
            height: 60px;
            background: 
                linear-gradient(135deg, 
                    rgba(0, 0, 0, 0.9) 0%, 
                    rgba(0, 255, 255, 0.1) 50%, 
                    rgba(0, 0, 0, 0.9) 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-bottom: 2px solid rgba(0, 255, 255, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .day-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(0, 255, 255, 0.2) 50%, 
                transparent 100%);
            animation: headerSweep 8s ease-in-out infinite;
        }
        
        @keyframes headerSweep {
            0% { left: -100%; }
            50% { left: 100%; }
            100% { left: -100%; }
        }

        .day-name {
            color: #00ffff;
            font-size: 12px;
            font-weight: 700;
            letter-spacing: 1.5px;
            text-shadow: 0 0 8px rgba(0, 255, 255, 0.6);
            z-index: 1;
            position: relative;
        }

        .day-number {
            color: #e2e8f0;
            font-size: 18px;
            font-weight: 800;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
            z-index: 1;
            position: relative;
        }

        .day-schedule {
            position: relative;
            height: 1105px;
            background: linear-gradient(to bottom, 
                rgba(0, 0, 0, 0.2) 0%, 
                rgba(0, 0, 0, 0.1) 30%,
                rgba(0, 255, 255, 0.02) 50%, 
                rgba(0, 0, 0, 0.1) 70%,
                rgba(0, 0, 0, 0.2) 100%);
            border-left: 1px solid rgba(0, 255, 255, 0.1);
        }

        /* Shift Blocks */
        .shift-block {
            position: absolute;
            left: 4px;
            right: 4px;
            border-radius: 8px;
            padding: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            backdrop-filter: blur(15px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .shift-block:hover {
            transform: translateX(3px) scale(1.02);
            border-color: rgba(255, 255, 255, 0.4);
            box-shadow: 0 6px 24px rgba(0, 0, 0, 0.4);
            z-index: 10;
        }

        .shift-block.manager {
            background: linear-gradient(135deg, 
                rgba(255, 215, 0, 0.25) 0%, 
                rgba(255, 165, 0, 0.2) 50%, 
                rgba(218, 165, 32, 0.15) 100%);
            border: 2px solid rgba(255, 215, 0, 0.5);
            box-shadow: 
                0 0 20px rgba(255, 215, 0, 0.3),
                inset 0 0 20px rgba(255, 215, 0, 0.1);
        }

        .shift-block.cashier {
            background: linear-gradient(135deg, 
                rgba(0, 255, 127, 0.25) 0%, 
                rgba(46, 204, 113, 0.2) 50%, 
                rgba(39, 174, 96, 0.15) 100%);
            border: 2px solid rgba(0, 255, 127, 0.5);
            box-shadow: 
                0 0 20px rgba(0, 255, 127, 0.3),
                inset 0 0 20px rgba(0, 255, 127, 0.1);
        }

        .shift-block.sales {
            background: linear-gradient(135deg, 
                rgba(255, 20, 147, 0.25) 0%, 
                rgba(231, 76, 60, 0.2) 50%, 
                rgba(192, 57, 43, 0.15) 100%);
            border: 2px solid rgba(255, 20, 147, 0.5);
            box-shadow: 
                0 0 20px rgba(255, 20, 147, 0.3),
                inset 0 0 20px rgba(255, 20, 147, 0.1);
        }

        .shift-block.stock {
            background: linear-gradient(135deg, 
                rgba(52, 152, 219, 0.25) 0%, 
                rgba(41, 128, 185, 0.2) 50%, 
                rgba(44, 62, 80, 0.15) 100%);
            border: 2px solid rgba(52, 152, 219, 0.5);
            box-shadow: 
                0 0 20px rgba(52, 152, 219, 0.3),
                inset 0 0 20px rgba(52, 152, 219, 0.1);
        }

        .shift-block.assistant {
            background: linear-gradient(135deg, 
                rgba(155, 89, 182, 0.25) 0%, 
                rgba(142, 68, 173, 0.2) 50%, 
                rgba(125, 60, 152, 0.15) 100%);
            border: 2px solid rgba(155, 89, 182, 0.5);
            box-shadow: 
                0 0 20px rgba(155, 89, 182, 0.3),
                inset 0 0 20px rgba(155, 89, 182, 0.1);
        }

        .shift-block.security {
            background: linear-gradient(135deg, 
                rgba(231, 76, 60, 0.25) 0%, 
                rgba(192, 57, 43, 0.2) 50%, 
                rgba(169, 50, 38, 0.15) 100%);
            border: 2px solid rgba(231, 76, 60, 0.5);
            box-shadow: 
                0 0 20px rgba(231, 76, 60, 0.3),
                inset 0 0 20px rgba(231, 76, 60, 0.1);
        }

        .shift-info {
            color: white;
            font-size: 12px;
            font-weight: 700;
            line-height: 1.3;
            margin-bottom: 6px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.7);
            letter-spacing: 0.5px;
        }

        .shift-time {
            color: rgba(255, 255, 255, 0.95);
            font-size: 11px;
            font-weight: 600;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.7);
            letter-spacing: 0.3px;
        }

        /* Hour Grid Lines */
        .hour-grid {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: 1;
        }

        .hour-line {
            position: absolute;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(0, 255, 255, 0.15) 10%, 
                rgba(0, 255, 255, 0.08) 50%, 
                rgba(0, 255, 255, 0.15) 90%, 
                transparent 100%);
        }

        .shift-block {
            z-index: 2;
        }

        /* Schedule Summary Bar */
        .schedule-summary-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
            margin: 20px 0;
            padding: 16px;
            background: 
                radial-gradient(circle at 25% 25%, rgba(0, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 75% 75%, rgba(255, 20, 147, 0.1) 0%, transparent 50%),
                rgba(0, 0, 0, 0.5);
            border-radius: 16px;
            border: 2px solid rgba(0, 255, 255, 0.2);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.4),
                0 0 40px rgba(0, 255, 255, 0.1),
                inset 0 0 40px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
            max-width: 100%;
        }
        
        .schedule-summary-bar::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(0, 255, 255, 0.1) 50%, 
                transparent 100%);
            animation: sweep 6s ease-in-out infinite;
        }
        
        @keyframes sweep {
            0% { left: -100%; }
            50% { left: 100%; }
            100% { left: -100%; }
        }

        .summary-item {
            text-align: center;
            padding: 12px 8px;
            background: 
                radial-gradient(circle at center, rgba(0, 0, 0, 0.4) 0%, transparent 70%),
                rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            border: 1px solid rgba(0, 255, 255, 0.3);
            position: relative;
            z-index: 1;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            min-width: 0;
            word-wrap: break-word;
        }
        
        .summary-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 255, 255, 0.2);
            border-color: rgba(0, 255, 255, 0.5);
        }

        .summary-label {
            color: #94a3b8;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            margin-bottom: 12px;
            opacity: 0.8;
        }

        .summary-value {
            color: #00ffff;
            font-size: 24px;
            font-weight: 800;
            text-shadow: 
                0 0 10px rgba(0, 255, 255, 0.5),
                0 2px 4px rgba(0, 0, 0, 0.3);
            letter-spacing: 1px;
        }

        /* Voice Control Panel */
        .voice-control-panel {
            background: 
                radial-gradient(circle at 20% 20%, rgba(138, 43, 226, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(255, 20, 147, 0.1) 0%, transparent 50%),
                rgba(0, 0, 0, 0.5);
            border-radius: 16px;
            border: 2px solid rgba(138, 43, 226, 0.3);
            padding: 24px;
            margin: 24px 0;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.4),
                0 0 40px rgba(138, 43, 226, 0.1),
                inset 0 0 40px rgba(0, 0, 0, 0.3);
        }

        .voice-control-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 20px;
        }

        .voice-icon {
            color: #8a2be2;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(138, 43, 226, 0.2);
            border-radius: 12px;
            border: 1px solid rgba(138, 43, 226, 0.4);
        }

        .voice-control-title {
            color: #e2e8f0;
            font-size: 20px;
            font-weight: 700;
            flex: 1;
        }

        .voice-status {
            color: #8a2be2;
            font-size: 14px;
            font-weight: 600;
            padding: 8px 16px;
            background: rgba(138, 43, 226, 0.1);
            border-radius: 20px;
            border: 1px solid rgba(138, 43, 226, 0.3);
        }

        .voice-controls {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
        }

        .voice-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            border-radius: 12px;
            border: none;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .voice-btn.primary {
            background: linear-gradient(135deg, #8a2be2, #9932cc);
            color: white;
            box-shadow: 0 4px 16px rgba(138, 43, 226, 0.3);
        }

        .voice-btn.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(138, 43, 226, 0.4);
        }

        .voice-btn.secondary {
            background: rgba(231, 76, 60, 0.2);
            color: #e74c3c;
            border: 1px solid rgba(231, 76, 60, 0.4);
        }

        .voice-examples {
            margin-bottom: 20px;
        }

        .example-title {
            color: #94a3b8;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 12px;
        }

        .example-commands {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 8px;
        }

        .example-cmd {
            color: #8a2be2;
            font-size: 13px;
            padding: 8px 12px;
            background: rgba(138, 43, 226, 0.05);
            border-radius: 8px;
            border: 1px solid rgba(138, 43, 226, 0.2);
            font-style: italic;
        }

        .voice-output {
            min-height: 60px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 16px;
            border: 1px solid rgba(138, 43, 226, 0.2);
            color: #e2e8f0;
            font-family: monospace;
            font-size: 14px;
        }

        /* Quick Add Panel */
        .quick-add-panel {
            background: 
                radial-gradient(circle at 30% 30%, rgba(0, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 70% 70%, rgba(255, 215, 0, 0.1) 0%, transparent 50%),
                rgba(0, 0, 0, 0.5);
            border-radius: 16px;
            border: 2px solid rgba(0, 255, 255, 0.3);
            padding: 24px;
            margin: 24px 0;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.4),
                0 0 40px rgba(0, 255, 255, 0.1);
        }

        .panel-header {
            margin-bottom: 20px;
        }

        .panel-title {
            color: #00ffff;
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .panel-subtitle {
            color: #94a3b8;
            font-size: 14px;
        }

        .employee-roster {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 16px;
        }

        .employee-chip {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 16px;
            border-radius: 12px;
            cursor: grab;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            border: 2px solid transparent;
        }

        .employee-chip:active {
            cursor: grabbing;
        }

        .employee-chip:hover {
            transform: translateY(-4px) scale(1.05);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .employee-chip.manager {
            background: linear-gradient(135deg, 
                rgba(255, 215, 0, 0.2) 0%, 
                rgba(255, 165, 0, 0.15) 100%);
            border-color: rgba(255, 215, 0, 0.4);
        }

        .employee-chip.cashier {
            background: linear-gradient(135deg, 
                rgba(0, 255, 127, 0.2) 0%, 
                rgba(46, 204, 113, 0.15) 100%);
            border-color: rgba(0, 255, 127, 0.4);
        }

        .employee-chip.sales {
            background: linear-gradient(135deg, 
                rgba(255, 20, 147, 0.2) 0%, 
                rgba(231, 76, 60, 0.15) 100%);
            border-color: rgba(255, 20, 147, 0.4);
        }

        .employee-chip.stock {
            background: linear-gradient(135deg, 
                rgba(52, 152, 219, 0.2) 0%, 
                rgba(41, 128, 185, 0.15) 100%);
            border-color: rgba(52, 152, 219, 0.4);
        }

        .employee-chip.assistant {
            background: linear-gradient(135deg, 
                rgba(155, 89, 182, 0.2) 0%, 
                rgba(142, 68, 173, 0.15) 100%);
            border-color: rgba(155, 89, 182, 0.4);
        }

        .employee-chip.security {
            background: linear-gradient(135deg, 
                rgba(231, 76, 60, 0.2) 0%, 
                rgba(192, 57, 43, 0.15) 100%);
            border-color: rgba(231, 76, 60, 0.4);
        }

        .chip-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: 700;
            color: white;
            margin-bottom: 8px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }

        .chip-name {
            color: white;
            font-size: 14px;
            font-weight: 700;
            margin-bottom: 4px;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
        }

        .chip-role {
            color: rgba(255, 255, 255, 0.8);
            font-size: 12px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Scale Selector Panel */
        .scale-selector-panel {
            background: 
                radial-gradient(circle at 20% 20%, rgba(255, 215, 0, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(0, 255, 127, 0.1) 0%, transparent 50%),
                rgba(0, 0, 0, 0.5);
            border-radius: 16px;
            border: 2px solid rgba(255, 215, 0, 0.3);
            padding: 24px;
            margin: 24px 0;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.4),
                0 0 40px rgba(255, 215, 0, 0.1);
        }

        .scale-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .scale-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            border-radius: 12px;
            border: 2px solid rgba(255, 215, 0, 0.3);
            background: rgba(0, 0, 0, 0.3);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .scale-btn:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.3);
            border-color: rgba(255, 215, 0, 0.6);
        }

        .scale-btn.active {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 165, 0, 0.1));
            border-color: #ffd700;
            box-shadow: 0 4px 16px rgba(255, 215, 0, 0.4);
        }

        .scale-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .scale-label {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .scale-count {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }

        .bulk-actions {
            border-top: 1px solid rgba(255, 215, 0, 0.3);
            padding-top: 20px;
        }

        .bulk-title {
            color: #ffd700;
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 16px;
        }

        .bulk-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
        }

        .bulk-btn {
            padding: 12px 16px;
            border-radius: 8px;
            border: 1px solid rgba(255, 215, 0, 0.4);
            background: rgba(255, 215, 0, 0.1);
            color: #ffd700;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .bulk-btn:hover {
            background: rgba(255, 215, 0, 0.2);
            transform: translateY(-2px);
        }

        /* Smart Employee Panel */
        .smart-employee-panel {
            background: 
                radial-gradient(circle at 30% 30%, rgba(52, 152, 219, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 70% 70%, rgba(155, 89, 182, 0.1) 0%, transparent 50%),
                rgba(0, 0, 0, 0.5);
            border-radius: 16px;
            border: 2px solid rgba(52, 152, 219, 0.3);
            padding: 24px;
            margin: 24px 0;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.4),
                0 0 40px rgba(52, 152, 219, 0.1);
        }

        .employee-filters {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 16px;
            margin-bottom: 20px;
        }

        .filter-input, .filter-select {
            padding: 12px 16px;
            border-radius: 8px;
            border: 1px solid rgba(52, 152, 219, 0.4);
            background: rgba(0, 0, 0, 0.3);
            color: white;
            font-size: 14px;
        }

        .filter-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .filter-input:focus, .filter-select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }

        /* Responsive Employee Roster */
        .employee-roster {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 12px;
            max-height: 400px;
            overflow-y: auto;
            padding-right: 8px;
        }

        .employee-roster::-webkit-scrollbar {
            width: 6px;
        }

        .employee-roster::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 3px;
        }

        .employee-roster::-webkit-scrollbar-thumb {
            background: rgba(52, 152, 219, 0.5);
            border-radius: 3px;
        }

        /* Compact Employee Chips for Large Scale */
        .employee-chip.compact {
            padding: 12px;
            min-height: auto;
        }

        .employee-chip.compact .chip-avatar {
            width: 32px;
            height: 32px;
            font-size: 14px;
            margin-bottom: 6px;
        }

        .employee-chip.compact .chip-name {
            font-size: 12px;
            margin-bottom: 2px;
        }

        .employee-chip.compact .chip-role {
            font-size: 10px;
        }

        /* Pagination */
        .roster-pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 16px;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid rgba(52, 152, 219, 0.3);
        }

        .page-btn {
            padding: 8px 16px;
            border-radius: 6px;
            border: 1px solid rgba(52, 152, 219, 0.4);
            background: rgba(52, 152, 219, 0.1);
            color: #3498db;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .page-btn:hover {
            background: rgba(52, 152, 219, 0.2);
        }

        .page-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .page-info {
            color: #3498db;
            font-size: 14px;
            font-weight: 600;
        }

        /* Large Scale Optimizations */
        @media (max-width: 768px) {
            .employee-filters {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .scale-options {
                grid-template-columns: 1fr;
            }
            
            .bulk-buttons {
                grid-template-columns: repeat(2, 1fr);
            }
            
            #smartEmployeeGrid {
                grid-template-columns: 1fr !important;
                gap: 12px !important;
            }
            
            .employee-card {
                padding: 12px !important;
                min-height: 100px !important;
            }
            
            .employee-card .btn {
                font-size: 11px !important;
                padding: 4px 8px !important;
            }
            
            #selectedEmployeeScheduling {
                padding: 16px !important;
            }
            
            #multiDayCalendar {
                gap: 6px !important;
                padding: 12px !important;
            }
            
            .shift-template {
                font-size: 11px !important;
                padding: 6px 12px !important;
            }
            
            .employee-filters {
                grid-template-columns: 1fr !important;
                gap: 8px !important;
            }
            
            .employee-chip {
                min-width: auto !important;
                padding: 8px !important;
            }
            
            .chip-avatar {
                width: 28px !important;
                height: 28px !important;
                font-size: 12px !important;
            }
            
            .chip-name {
                font-size: 11px !important;
            }
            
            .chip-role {
                font-size: 9px !important;
            }
            }
        }

        /* List View */
        .list-container {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid rgba(0, 255, 255, 0.1);
        }

        .employee-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .employee-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 12px;
            border: 1px solid rgba(0, 255, 255, 0.1);
            transition: all 0.2s ease;
        }

        .employee-item:hover {
            background: rgba(0, 0, 0, 0.6);
            border-color: rgba(0, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .employee-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 18px;
        }

        .employee-avatar.manager {
            background: linear-gradient(135deg, #8B4513, #A0522D);
        }

        .employee-avatar.cashier {
            background: linear-gradient(135deg, #228B22, #32CD32);
        }

        .employee-avatar.sales {
            background: linear-gradient(135deg, #FF8C00, #FFA500);
        }

        .employee-details {
            flex: 1;
        }

        .employee-name {
            color: #e2e8f0;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .employee-shifts {
            color: #94a3b8;
            font-size: 13px;
            line-height: 1.4;
        }

        .hours-total {
            color: #00ffff;
            font-size: 18px;
            font-weight: 700;
            text-align: center;
            min-width: 60px;
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .calendar-grid {
                grid-template-columns: 60px repeat(7, 1fr);
            }
            
            .time-column {
                font-size: 10px;
            }
            
            .shift-info {
                font-size: 10px;
            }
            
            .shift-time {
                font-size: 9px;
            }
        }

        @media (max-width: 768px) {
            .simple-header {
                flex-direction: column;
                gap: 16px;
                text-align: center;
            }

            .calendar-container {
                padding: 16px;
            }

            .calendar-grid {
                grid-template-columns: 50px repeat(7, 1fr);
                min-height: 800px;
                gap: 0.5px;
            }

            .time-slot {
                height: 50px;
                font-size: 10px;
            }

            .day-schedule {
                height: 850px;
            }

            .day-header {
                height: 50px;
            }

            .day-name {
                font-size: 10px;
            }

            .day-number {
                font-size: 14px;
            }

            .shift-block {
                padding: 4px;
                left: 1px;
                right: 1px;
            }

            .shift-info {
                font-size: 9px;
                margin-bottom: 2px;
            }

            .shift-time {
                font-size: 8px;
            }

            .week-range {
                font-size: 16px;
            }

            .schedule-summary-bar {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
                padding: 12px;
                margin: 16px 0;
            }

            .summary-item {
                padding: 8px 4px;
            }

            .summary-label {
                font-size: 11px;
            }

            .summary-value {
                font-size: 16px;
            }
        }

            .nav-arrow {
                width: 35px;
                height: 35px;
                font-size: 16px;
            }
        }

        @media (max-width: 480px) {
            .calendar-grid {
                grid-template-columns: 40px repeat(7, 1fr);
                min-height: 600px;
            }

            .time-slot {
                height: 40px;
                font-size: 8px;
            }

            .day-schedule {
                height: 640px;
            }

            .day-header {
                height: 40px;
            }

            .shift-block {
                padding: 2px;
            }

            .shift-info {
                font-size: 8px;
            }

            .shift-time {
                font-size: 7px;
            }
        }

        .time-labels-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            padding: 0 20px;
        }

        .time-label {
            font-size: 12px;
            color: #94a3b8;
            font-weight: 500;
        }

        .employee-schedule-grid {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .employee-schedule-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .employee-info-section {
            min-width: 180px;
            flex-shrink: 0;
        }

        .employee-name {
            font-size: 16px;
            font-weight: 600;
            color: #e2e8f0;
            margin-bottom: 4px;
        }

        .employee-role {
            font-size: 13px;
            color: #94a3b8;
            margin-bottom: 2px;
        }

        .employee-hours {
            font-size: 12px;
            color: #00ffff;
        }

        /* One-Click Status Update Widget */
        .status-widget {
            position: relative;
            display: inline-block;
        }

        .status-button {
            background: none;
            border: none;
            color: white;
            font-size: 12px;
            font-weight: bold;
            padding: 4px 8px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 70px;
            text-align: center;
        }

        .status-button.available {
            background: linear-gradient(135deg, #00ff88, #00cc66);
            box-shadow: 0 2px 8px rgba(0, 255, 136, 0.3);
        }

        .status-button.scheduled {
            background: linear-gradient(135deg, #ffd700, #ffb300);
            box-shadow: 0 2px 8px rgba(255, 215, 0, 0.3);
        }

        .status-button.off {
            background: linear-gradient(135deg, #ff6b9d, #ff4757);
            box-shadow: 0 2px 8px rgba(255, 107, 157, 0.3);
        }

        .status-button.break {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            box-shadow: 0 2px 8px rgba(155, 89, 182, 0.3);
        }

        .status-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        }

        .status-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 8px;
            display: none;
            z-index: 1000;
            backdrop-filter: blur(10px);
            margin-top: 4px;
        }

        .status-dropdown.show {
            display: block;
            animation: statusDropdownFade 0.2s ease-out;
        }

        @keyframes statusDropdownFade {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .status-option {
            display: block;
            width: 100%;
            background: none;
            border: none;
            color: white;
            padding: 6px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
            font-weight: 500;
            transition: all 0.2s ease;
            margin-bottom: 2px;
        }

        .status-option:last-child {
            margin-bottom: 0;
        }

        .status-option:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(2px);
        }

        .status-option.available { border-left: 3px solid #00ff88; }
        .status-option.scheduled { border-left: 3px solid #ffd700; }
        .status-option.off { border-left: 3px solid #ff6b9d; }
        .status-option.break { border-left: 3px solid #9b59b6; }

        .shift-timeline {
            flex: 1;
            height: 40px;
            position: relative;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            overflow: hidden;
        }

        .shift-bar {
            position: absolute;
            top: 4px;
            bottom: 4px;
            border-radius: 6px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 10px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .shift-bar:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .shift-time {
            font-size: 9px;
            opacity: 0.9;
        }

        .shift-task {
            font-size: 8px;
            opacity: 0.8;
            margin-top: 1px;
        }

        .manager-shift {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
        }

        .cashier-shift {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .sales-shift {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }

        .break-shift {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }

        .stock-shift {
            background: linear-gradient(135deg, #0891b2, #0e7490);
        }

        .assistant-shift {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
        }

        .security-shift {
            background: linear-gradient(135deg, #374151, #1f2937);
        }

        /* Summary Panel */
        .summary-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .summary-card {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 20px;
        }

        .summary-title {
            font-size: 18px;
            font-weight: 600;
            color: #00ffff;
            margin-bottom: 16px;
        }

        .summary-content {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .shift-summary-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }

        .shift-time {
            font-weight: 600;
            color: #e2e8f0;
            margin-bottom: 4px;
        }

        .shift-employees {
            font-size: 14px;
            color: #94a3b8;
        }

        .employee-count {
            background: linear-gradient(135deg, #00ffff, #0066ff);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 14px;
        }

        /* Sleek Voice Control Panel */
        .voice-control-panel-sleek {
            position: relative;
            background: linear-gradient(135deg, rgba(102, 51, 153, 0.15), rgba(65, 105, 225, 0.15));
            border: 1px solid rgba(138, 43, 226, 0.3);
            border-radius: 16px;
            padding: 16px;
            margin: 24px 0;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }

        .voice-header-sleek {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        /* Futuristic Voice Icon with Moving Particles */
        .voice-icon-container {
            position: relative;
            width: 48px;
            height: 48px;
        }

        .voice-icon-main {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, #8a2be2, #4169e1);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            z-index: 2;
            box-shadow: 0 4px 16px rgba(138, 43, 226, 0.4);
        }

        /* Animated Particles */
        .particle {
            position: absolute;
            border-radius: 50%;
            opacity: 0.8;
        }

        .particle-1 {
            width: 4px;
            height: 4px;
            background: #8a2be2;
            top: 10px;
            left: 10px;
            animation: particle1 3s infinite linear;
        }

        .particle-2 {
            width: 3px;
            height: 3px;
            background: #4169e1;
            top: 30px;
            right: 8px;
            animation: particle2 2.5s infinite linear;
        }

        .particle-3 {
            width: 2px;
            height: 2px;
            background: #9370db;
            bottom: 12px;
            left: 15px;
            animation: particle3 2s infinite linear;
        }

        .particle-4 {
            width: 3px;
            height: 3px;
            background: #6a5acd;
            top: 5px;
            right: 20px;
            animation: particle4 3.5s infinite linear;
        }

        @keyframes particle1 {
            0%, 100% { transform: translate(0, 0) scale(1); opacity: 0.8; }
            25% { transform: translate(8px, -5px) scale(1.2); opacity: 1; }
            50% { transform: translate(15px, 8px) scale(0.8); opacity: 0.6; }
            75% { transform: translate(-5px, 12px) scale(1.1); opacity: 0.9; }
        }

        @keyframes particle2 {
            0%, 100% { transform: translate(0, 0) rotate(0deg); opacity: 0.7; }
            33% { transform: translate(-10px, 8px) rotate(120deg); opacity: 1; }
            66% { transform: translate(5px, -12px) rotate(240deg); opacity: 0.5; }
        }

        @keyframes particle3 {
            0%, 100% { transform: translate(0, 0) scale(1); }
            50% { transform: translate(12px, -15px) scale(1.5); }
        }

        @keyframes particle4 {
            0%, 100% { transform: translate(0, 0) rotate(0deg) scale(1); }
            25% { transform: translate(-8px, 10px) rotate(90deg) scale(0.7); }
            50% { transform: translate(10px, 5px) rotate(180deg) scale(1.3); }
            75% { transform: translate(-5px, -8px) rotate(270deg) scale(0.9); }
        }

        /* Pulse Effect */
        .voice-pulse {
            position: absolute;
            inset: -4px;
            border-radius: 50%;
            border: 2px solid rgba(138, 43, 226, 0.4);
            animation: voicePulse 2s infinite;
            display: none;
        }

        @keyframes voicePulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.7; }
            100% { transform: scale(1.4); opacity: 0; }
        }

        .voice-title-section {
            flex: 1;
        }

        .voice-title {
            color: #8a2be2;
            margin: 0;
            font-size: 16px;
            font-weight: 600;
        }

        .voice-subtitle {
            color: #94a3b8;
            margin: 2px 0 0 0;
            font-size: 12px;
        }

        /* Compact Command Button */
        .command-btn {
            background: linear-gradient(135deg, #8a2be2, #4169e1);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 4px 12px rgba(138, 43, 226, 0.3);
            transition: all 0.3s ease;
        }

        .command-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(138, 43, 226, 0.4);
            background: linear-gradient(135deg, #9a3bf2, #5179f5);
        }

        .command-btn:active {
            transform: translateY(0);
        }

        /* Sleek Dropdown */
        .voice-dropdown {
            display: none;
            background: linear-gradient(135deg, rgba(138, 43, 226, 0.1), rgba(65, 105, 225, 0.1));
            border: 1px solid rgba(138, 43, 226, 0.2);
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 12px;
            backdrop-filter: blur(8px);
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .dropdown-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .dropdown-title {
            color: #8a2be2;
            margin: 0;
            font-size: 13px;
            font-weight: 600;
        }

        .dropdown-close {
            background: none;
            border: none;
            color: #94a3b8;
            cursor: pointer;
            font-size: 16px;
            padding: 0;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .dropdown-close:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .command-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            font-size: 11px;
        }

        .command-item {
            padding: 6px 8px;
            border-radius: 6px;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .command-item.purple {
            color: #b19cd9;
            background: rgba(138, 43, 226, 0.1);
            border-left: 3px solid #8a2be2;
        }

        .command-item.blue {
            color: #8bb6ff;
            background: rgba(65, 105, 225, 0.1);
            border-left: 3px solid #4169e1;
        }

        .command-item:hover {
            transform: translateX(4px);
            background: rgba(255, 255, 255, 0.1);
        }

        /* Compact Voice Console */
        .voice-console {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(138, 43, 226, 0.2);
            border-radius: 8px;
            padding: 10px;
            max-height: 80px;
            overflow-y: auto;
            display: none;
            font-family: 'Courier New', monospace;
        }

        #voice-console-text {
            color: #94a3b8;
            font-size: 11px;
            line-height: 1.3;
        }

        /* Streamlined Header Styles */
        .streamlined-header {
            background: linear-gradient(135deg, rgba(65, 105, 225, 0.1), rgba(138, 43, 226, 0.1));
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(65, 105, 225, 0.2);
            padding: 15px 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .modern-back-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #4169e1;
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid rgba(65, 105, 225, 0.2);
            background: rgba(65, 105, 225, 0.1);
            transition: all 0.3s ease;
        }

        .modern-back-btn:hover {
            background: rgba(65, 105, 225, 0.2);
            transform: translateX(-2px);
        }

        .header-title-section {
            flex: 1;
        }

        .marketpace-text {
            background: linear-gradient(135deg, #2a0845, #1a0033);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 20px rgba(65, 105, 225, 0.3), 
                         0 0 40px rgba(0, 102, 255, 0.2);
            filter: drop-shadow(0 0 8px rgba(65, 105, 225, 0.4));
            font-size: 28px;
            font-weight: bold;
            margin: 0;
        }

        .header-subtitle {
            color: #94a3b8;
            font-size: 14px;
            margin: 5px 0 0 0;
        }

        /* Compact Navigation Styles */
        .compact-nav {
            display: flex;
            gap: 8px;
            padding: 15px 0;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .nav-chip {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(65, 105, 225, 0.2);
            border-radius: 20px;
            padding: 10px 16px;
            color: #94a3b8;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 38px;
        }

        .nav-chip:hover {
            background: rgba(65, 105, 225, 0.1);
            border-color: rgba(65, 105, 225, 0.4);
            color: #4169e1;
            transform: translateY(-1px);
        }

        .nav-chip.active {
            background: linear-gradient(135deg, #4169e1, #8a2be2);
            border-color: #4169e1;
            color: white;
            box-shadow: 0 4px 15px rgba(65, 105, 225, 0.3);
        }

        .nav-chip svg {
            opacity: 0.8;
            transition: opacity 0.3s ease;
        }

        .nav-chip:hover svg,
        .nav-chip.active svg {
            opacity: 1;
        }

        /* Responsive Navigation */
        @media (max-width: 768px) {
            .compact-nav {
                justify-content: center;
            }
            
            .nav-chip {
                flex: 1;
                justify-content: center;
                min-width: 100px;
                font-size: 12px;
                padding: 8px 12px;
            }
            
            .marketpace-text {
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <!-- Streamlined Header -->
    <div class="streamlined-header">
        <div class="header-content">
            <a href="javascript:history.back()" class="modern-back-btn">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 12H5M12 19l-7-7 7-7"/>
                </svg>
                Back
            </a>
            <div class="header-title-section">
                <h1 class="marketpace-text">Business Scheduling</h1>
                <p class="header-subtitle">Advanced workforce management</p>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Compact Navigation -->
        <div class="compact-nav">
            <button class="nav-chip active" onclick="showTab('schedule')" data-tab="schedule">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                    <line x1="16" y1="2" x2="16" y2="6"/>
                    <line x1="8" y1="2" x2="8" y2="6"/>
                    <line x1="3" y1="10" x2="21" y2="10"/>
                </svg>
                Schedule
            </button>
            <button class="nav-chip" onclick="showTab('employees')" data-tab="employees">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                    <circle cx="12" cy="7" r="4"/>
                </svg>
                Employees
            </button>
            <button class="nav-chip" onclick="showTab('volunteers')" data-tab="volunteers">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                    <circle cx="12" cy="7" r="4"/>
                    <path d="M12 14l2-2-2-2-2 2 2 2z"/>
                </svg>
                Volunteers
            </button>
            <button class="nav-chip" onclick="showTab('qr-system')" data-tab="qr-system">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                    <rect x="7" y="7" width="3" height="3"/>
                    <rect x="14" y="7" width="3" height="3"/>
                    <rect x="7" y="14" width="3" height="3"/>
                    <rect x="14" y="14" width="3" height="3"/>
                </svg>
                QR System
            </button>
        </div>

        <!-- Tab Container with Dark Background -->
        <div class="tab-container">
            <!-- Daily Schedule Tab -->
            <div id="schedule" class="tab-content active">
            <!-- Sleek Voice Control Assistant -->
            <div class="voice-control-panel-sleek">
                <!-- Compact Header with Futuristic Icon -->
                <div class="voice-header-sleek">
                    <!-- Futuristic Voice Icon with Moving Particles -->
                    <div class="voice-icon-container">
                        <!-- Main Icon -->
                        <div class="voice-icon-main">
                            <!-- Futuristic Microphone SVG -->
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" style="color: white;">
                                <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z" fill="currentColor"/>
                                <path d="M19 10v2a7 7 0 0 1-14 0v-2" stroke="currentColor" stroke-width="2" fill="none"/>
                                <path d="M12 19v4M8 23h8" stroke="currentColor" stroke-width="2"/>
                            </svg>
                        </div>
                        
                        <!-- Animated Particles -->
                        <div class="particle particle-1"></div>
                        <div class="particle particle-2"></div>
                        <div class="particle particle-3"></div>
                        <div class="particle particle-4"></div>
                        
                        <!-- Pulse Effect -->
                        <div class="voice-pulse" id="voice-pulse-effect"></div>
                    </div>
                    
                    <div class="voice-title-section">
                        <h3 class="voice-title">Voice Assistant</h3>
                        <p class="voice-subtitle">Natural language scheduling</p>
                    </div>
                    
                    <!-- Compact Command Button -->
                    <button class="command-btn" id="voice-command-btn" onclick="toggleVoiceControl()">Command</button>
                </div>

                <!-- Sleek Dropdown with Example Commands -->
                <div class="voice-dropdown" id="voice-commands-dropdown">
                    <div class="dropdown-header">
                        <h4 class="dropdown-title">Voice Commands</h4>
                        <button class="dropdown-close" onclick="hideVoiceDropdown()">×</button>
                    </div>
                    <div class="command-grid">
                        <div class="command-item purple">"Schedule Sarah Monday 9-5"</div>
                        <div class="command-item blue">"Add Mike Tuesday morning"</div>
                        <div class="command-item purple">"Remove Jessica Friday"</div>
                        <div class="command-item blue">"Show availability"</div>
                        <div class="command-item purple">"Weekend shifts for cashiers"</div>
                        <div class="command-item blue">"Help commands"</div>
                    </div>
                </div>

                <!-- Compact Voice Console -->
                <div class="voice-console" id="voice-output-console">
                    <div id="voice-console-text">Voice system ready...</div>
                </div>
            </div>

            <!-- Simple Header -->
            <div class="simple-header">
                <div class="view-selector">
                    <button class="view-btn active" onclick="switchToView('calendar')">Calendar</button>
                    <button class="view-btn" onclick="switchToView('list')">List</button>
                    <button class="add-btn" onclick="showCreateShiftTemplates()">+ Add</button>
                </div>
            </div>

            <!-- Calendar Graph Mode -->
            <div id="calendar-view" class="calendar-container">
                <!-- Date Header -->
                <div class="date-header">
                    <button class="nav-arrow" onclick="navigateWeek(-1)">‹</button>
                    <span class="week-range">July 20 - 26, 2025</span>
                    <button class="nav-arrow" onclick="navigateWeek(1)">›</button>
                </div>

                <!-- Calendar Grid -->
                <div class="calendar-grid">
                    <!-- Time Column -->
                    <div class="time-column">
                        <div class="time-header"></div>
                        <div class="time-slot">6 AM</div>
                        <div class="time-slot">7 AM</div>
                        <div class="time-slot">8 AM</div>
                        <div class="time-slot">9 AM</div>
                        <div class="time-slot">10 AM</div>
                        <div class="time-slot">11 AM</div>
                        <div class="time-slot">12 PM</div>
                        <div class="time-slot">1 PM</div>
                        <div class="time-slot">2 PM</div>
                        <div class="time-slot">3 PM</div>
                        <div class="time-slot">4 PM</div>
                        <div class="time-slot">5 PM</div>
                        <div class="time-slot">6 PM</div>
                        <div class="time-slot">7 PM</div>
                        <div class="time-slot">8 PM</div>
                        <div class="time-slot">9 PM</div>
                        <div class="time-slot">10 PM</div>
                    </div>

                    <!-- Days -->
                    <div class="day-column">
                        <div class="day-header">
                            <div class="day-name">MON</div>
                            <div class="day-number">20</div>
                        </div>
                        <div class="day-schedule">
                            <!-- Hour grid lines -->
                            <div class="hour-grid">
                                <div class="hour-line" style="top: 65px;"></div>
                                <div class="hour-line" style="top: 130px;"></div>
                                <div class="hour-line" style="top: 195px;"></div>
                                <div class="hour-line" style="top: 260px;"></div>
                                <div class="hour-line" style="top: 325px;"></div>
                                <div class="hour-line" style="top: 390px;"></div>
                                <div class="hour-line" style="top: 455px;"></div>
                                <div class="hour-line" style="top: 520px;"></div>
                                <div class="hour-line" style="top: 585px;"></div>
                                <div class="hour-line" style="top: 650px;"></div>
                                <div class="hour-line" style="top: 715px;"></div>
                                <div class="hour-line" style="top: 780px;"></div>
                                <div class="hour-line" style="top: 845px;"></div>
                                <div class="hour-line" style="top: 910px;"></div>
                                <div class="hour-line" style="top: 975px;"></div>
                                <div class="hour-line" style="top: 1040px;"></div>
                            </div>
                            <!-- Shift blocks -->
                            <div class="shift-block manager" style="top: 65px; height: 325px;" onclick="editShift('sarah-mon-7-12')">
                                <div class="shift-info">Sarah • Manager</div>
                                <div class="shift-time">7AM-12PM</div>
                            </div>
                            <div class="shift-block cashier" style="top: 195px; height: 325px;" onclick="editShift('mike-mon-9-2')">
                                <div class="shift-info">Mike • Cashier</div>
                                <div class="shift-time">9AM-2PM</div>
                            </div>
                            <div class="shift-block sales" style="top: 260px; height: 585px;" onclick="editShift('jessica-mon-10-7')">
                                <div class="shift-info">Jessica • Sales</div>
                                <div class="shift-time">10AM-7PM</div>
                            </div>
                        </div>
                    </div>

                    <div class="day-column">
                        <div class="day-header">
                            <div class="day-name">TUE</div>
                            <div class="day-number">21</div>
                        </div>
                        <div class="day-schedule">
                            <div class="hour-grid">
                                <div class="hour-line" style="top: 65px;"></div>
                                <div class="hour-line" style="top: 130px;"></div>
                                <div class="hour-line" style="top: 195px;"></div>
                                <div class="hour-line" style="top: 260px;"></div>
                                <div class="hour-line" style="top: 325px;"></div>
                                <div class="hour-line" style="top: 390px;"></div>
                                <div class="hour-line" style="top: 455px;"></div>
                                <div class="hour-line" style="top: 520px;"></div>
                                <div class="hour-line" style="top: 585px;"></div>
                                <div class="hour-line" style="top: 650px;"></div>
                                <div class="hour-line" style="top: 715px;"></div>
                                <div class="hour-line" style="top: 780px;"></div>
                                <div class="hour-line" style="top: 845px;"></div>
                                <div class="hour-line" style="top: 910px;"></div>
                                <div class="hour-line" style="top: 975px;"></div>
                                <div class="hour-line" style="top: 1040px;"></div>
                            </div>
                            <div class="shift-block stock" style="top: 0px; height: 390px;" onclick="editShift('david-tue-6-12')">
                                <div class="shift-info">David • Stock</div>
                                <div class="shift-time">6AM-12PM</div>
                            </div>
                            <div class="shift-block assistant" style="top: 520px; height: 520px;" onclick="editShift('emma-tue-2-10')">
                                <div class="shift-info">Emma • Assistant</div>
                                <div class="shift-time">2PM-10PM</div>
                            </div>
                        </div>
                    </div>

                    <div class="day-column">
                        <div class="day-header">
                            <div class="day-name">WED</div>
                            <div class="day-number">22</div>
                        </div>
                        <div class="day-schedule">
                            <div class="shift-block manager" style="top: 120px; height: 480px;" onclick="editShift('sarah-wed-8-4')">
                                <div class="shift-info">Sarah • Manager</div>
                                <div class="shift-time">8AM-4PM</div>
                            </div>
                            <div class="shift-block security" style="top: 720px; height: 240px;" onclick="editShift('carlos-wed-6-10')">
                                <div class="shift-info">Carlos • Security</div>
                                <div class="shift-time">6PM-10PM</div>
                            </div>
                        </div>
                    </div>

                    <div class="day-column">
                        <div class="day-header">
                            <div class="day-name">THU</div>
                            <div class="day-number">23</div>
                        </div>
                        <div class="day-schedule">
                            <div class="shift-block cashier" style="top: 300px; height: 300px;" onclick="editShift('mike-thu-11-4')">
                                <div class="shift-info">Mike • Cashier</div>
                                <div class="shift-time">11AM-4PM</div>
                            </div>
                            <div class="shift-block sales" style="top: 360px; height: 360px;" onclick="editShift('jessica-thu-12-6')">
                                <div class="shift-info">Jessica • Sales</div>
                                <div class="shift-time">12PM-6PM</div>
                            </div>
                        </div>
                    </div>

                    <div class="day-column">
                        <div class="day-header">
                            <div class="day-name">FRI</div>
                            <div class="day-number">24</div>
                        </div>
                        <div class="day-schedule">
                            <div class="shift-block manager" style="top: 180px; height: 360px;" onclick="editShift('sarah-fri-9-3')">
                                <div class="shift-info">Sarah • Manager</div>
                                <div class="shift-time">9AM-3PM</div>
                            </div>
                            <div class="shift-block assistant" style="top: 420px; height: 420px;" onclick="editShift('emma-fri-1-8')">
                                <div class="shift-info">Emma • Assistant</div>
                                <div class="shift-time">1PM-8PM</div>
                            </div>
                            <div class="shift-block security" style="top: 720px; height: 300px;" onclick="editShift('carlos-fri-6-11')">
                                <div class="shift-info">Carlos • Security</div>
                                <div class="shift-time">6PM-11PM</div>
                            </div>
                        </div>
                    </div>

                    <div class="day-column">
                        <div class="day-header">
                            <div class="day-name">SAT</div>
                            <div class="day-number">25</div>
                        </div>
                        <div class="day-schedule">
                            <div class="shift-block stock" style="top: 60px; height: 300px;" onclick="editShift('david-sat-7-12')">
                                <div class="shift-info">David • Stock</div>
                                <div class="shift-time">7AM-12PM</div>
                            </div>
                            <div class="shift-block sales" style="top: 240px; height: 480px;" onclick="editShift('jessica-sat-10-6')">
                                <div class="shift-info">Jessica • Sales</div>
                                <div class="shift-time">10AM-6PM</div>
                            </div>
                        </div>
                    </div>

                    <div class="day-column">
                        <div class="day-header">
                            <div class="day-name">SUN</div>
                            <div class="day-number">26</div>
                        </div>
                        <div class="day-schedule">
                            <div class="shift-block cashier" style="top: 360px; height: 240px;" onclick="editShift('mike-sun-12-4')">
                                <div class="shift-info">Mike • Cashier</div>
                                <div class="shift-time">12PM-4PM</div>
                            </div>
                            <div class="shift-block assistant" style="top: 480px; height: 300px;" onclick="editShift('emma-sun-2-7')">
                                <div class="shift-info">Emma • Assistant</div>
                                <div class="shift-time">2PM-7PM</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Scale Selector & Quick Actions Panel -->
            <div class="scale-selector-panel">
                <div class="panel-header">
                    <div class="panel-title">Event Scale & Quick Actions</div>
                    <div class="panel-subtitle">Optimize interface for your event size</div>
                </div>
                
                <div class="scale-options">
                    <button class="scale-btn active" data-scale="small" onclick="setEventScale('small')">
                        <div class="scale-icon">🏪</div>
                        <div class="scale-label">Small Business</div>
                        <div class="scale-count">5-20 people</div>
                    </button>
                    <button class="scale-btn" data-scale="medium" onclick="setEventScale('medium')">
                        <div class="scale-icon">🏢</div>
                        <div class="scale-label">Medium Event</div>
                        <div class="scale-count">20-100 people</div>
                    </button>
                    <button class="scale-btn" data-scale="large" onclick="setEventScale('large')">
                        <div class="scale-icon">🎪</div>
                        <div class="scale-label">Large Festival</div>
                        <div class="scale-count">100-500+ people</div>
                    </button>
                </div>
                
                <div class="bulk-actions" id="bulk-actions" style="display: none;">
                    <div class="bulk-title">Bulk Scheduling Actions</div>
                    <div class="bulk-buttons">
                        <button class="bulk-btn" onclick="bulkScheduleByRole()">Schedule by Role</button>
                        <button class="bulk-btn" onclick="bulkScheduleByDepartment()">Schedule by Department</button>
                        <button class="bulk-btn" onclick="autoFillShifts()">Auto-Fill Shifts</button>
                        <button class="bulk-btn" onclick="importSchedule()">Import Schedule</button>
                    </div>
                </div>
            </div>

            <!-- Smart Employee Management Panel -->
            <div class="smart-employee-panel" id="employee-panel">
                <div class="panel-header">
                    <div class="panel-title">Smart Employee Management</div>
                    <div class="panel-subtitle">
                        <span id="employee-count">6 employees</span> | 
                        <span id="filtered-count">6 visible</span>
                    </div>
                </div>
                
                <div class="employee-filters">
                    <input type="text" class="filter-input" id="employee-search" placeholder="Search employees..." onkeyup="filterEmployees()">
                    <select class="filter-select" id="role-filter" onchange="filterEmployees()">
                        <option value="">All Roles</option>
                        <option value="manager">Managers</option>
                        <option value="cashier">Cashiers</option>
                        <option value="sales">Sales</option>
                        <option value="stock">Stock</option>
                        <option value="assistant">Assistants</option>
                        <option value="security">Security</option>
                    </select>
                    <select class="filter-select" id="availability-filter" onchange="filterEmployees()">
                        <option value="">All Availability</option>
                        <option value="available">Available Now</option>
                        <option value="scheduled">Already Scheduled</option>
                        <option value="unavailable">Unavailable</option>
                    </select>
                </div>
                
                <div class="employee-roster" id="employee-roster">
                    <!-- Employees will be populated by JavaScript -->
                </div>
                
                <div class="roster-pagination" id="roster-pagination" style="display: none;">
                    <button class="page-btn" onclick="previousPage()">← Previous</button>
                    <span class="page-info" id="page-info">Page 1 of 25</span>
                    <button class="page-btn" onclick="nextPage()">Next →</button>
                </div>
            </div>

            <!-- Schedule Summary Bar -->
            <div class="schedule-summary-bar">
                <div class="summary-item">
                    <div class="summary-label">Total Hours</div>
                    <div class="summary-value">156h</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">Employees</div>
                    <div class="summary-value">6 Active</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">Labor Cost</div>
                    <div class="summary-value">$2,496</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">Coverage</div>
                    <div class="summary-value">98%</div>
                </div>
            </div>

            <!-- List View (Hidden by default) -->
            <div id="list-view" class="list-container" style="display: none;">
                <div class="employee-list">
                    <div class="employee-item">
                        <div class="employee-avatar manager">S</div>
                        <div class="employee-details">
                            <div class="employee-name">Sarah Johnson</div>
                            <div class="employee-shifts">Mon 7AM-12PM • Wed 8AM-4PM • Fri 9AM-3PM</div>
                        </div>
                        <div class="hours-total">24h</div>
                    </div>
                    <div class="employee-item">
                        <div class="employee-avatar cashier">M</div>
                        <div class="employee-details">
                            <div class="employee-name">Mike Chen</div>
                            <div class="employee-shifts">Mon 9AM-2PM • Thu 11AM-4PM • Sun 12PM-4PM</div>
                        </div>
                        <div class="hours-total">18h</div>
                    </div>
                    <div class="employee-item">
                        <div class="employee-avatar sales">J</div>
                        <div class="employee-details">
                            <div class="employee-name">Jessica Martinez</div>
                            <div class="employee-shifts">Mon 10AM-7PM • Thu 12PM-6PM • Sat 10AM-6PM</div>
                        </div>
                        <div class="hours-total">25h</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Employees Tab -->
        <div id="employees" class="tab-content">
            <!-- Smart Employee Management Section - PROMINENT AT TOP -->
            <div class="card" style="margin-bottom: 20px; border: 2px solid rgba(255, 215, 0, 0.3); background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(65, 105, 225, 0.1));">
                <div class="card-header">
                    <h2 class="card-title" style="color: #ffd700; font-size: 24px;">⚡ Smart Employee Management System</h2>
                    <div style="display: flex; gap: 12px;">
                        <button class="btn btn-primary" onclick="showCreateShiftTemplates()" style="background: linear-gradient(135deg, #ffd700, #4169e1); border: none; padding: 12px 20px; color: #000;">Create Shift Templates</button>
                        <button class="btn" onclick="showAddEmployeeModal()" style="background: linear-gradient(135deg, #4169e1, #8a2be2); border: none; padding: 12px 20px;">Add Employee</button>
                    </div>
                </div>

                <!-- Quick Stats Bar -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 12px; margin-bottom: 20px;">
                    <div style="background: rgba(255,215,0,0.1); border: 1px solid rgba(255,215,0,0.3); border-radius: 12px; padding: 12px; text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; color: #ffd700;" id="totalEmployeesCount">6</div>
                        <div style="color: #94a3b8; font-size: 12px;">Total Employees</div>
                    </div>
                    <div style="background: rgba(0,255,255,0.1); border: 1px solid rgba(0,255,255,0.3); border-radius: 12px; padding: 12px; text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; color: #00ffff;" id="scheduledToday">4</div>
                        <div style="color: #94a3b8; font-size: 12px;">Scheduled Today</div>
                    </div>
                    <div style="background: rgba(255,107,157,0.1); border: 1px solid rgba(255,107,157,0.3); border-radius: 12px; padding: 12px; text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; color: #ff6b9d;" id="weeklyHours">156</div>
                        <div style="color: #94a3b8; font-size: 12px;">Weekly Hours</div>
                    </div>
                    <div style="background: rgba(0,255,136,0.1); border: 1px solid rgba(0,255,136,0.3); border-radius: 12px; padding: 12px; text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; color: #00ff88;" id="avgWage">$18.75</div>
                        <div style="color: #94a3b8; font-size: 12px;">Avg Hourly</div>
                    </div>
                </div>

                <!-- Search and Filter -->
                <div style="display: flex; flex-direction: column; gap: 12px; margin-bottom: 20px;">
                    <input type="text" id="employeeSearch" placeholder="Search employees..." style="width: 100%; padding: 10px; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; background: rgba(0,0,0,0.3); color: white;" onkeyup="filterEmployees()">
                    <div style="display: flex; gap: 8px;">
                        <select id="roleFilter" style="flex: 1; padding: 10px; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; background: rgba(0,0,0,0.3); color: white; font-size: 14px;" onchange="filterEmployees()">
                            <option value="">All Roles</option>
                            <option value="Manager">Managers</option>
                            <option value="Cashier">Cashiers</option>
                            <option value="Sales">Sales</option>
                            <option value="Stock">Stock</option>
                            <option value="Assistant">Assistants</option>
                            <option value="Security">Security</option>
                        </select>
                        <select id="availabilityFilter" style="flex: 1; padding: 10px; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; background: rgba(0,0,0,0.3); color: white; font-size: 14px;" onchange="filterEmployees()">
                            <option value="">All Status</option>
                            <option value="Available">Available Now</option>
                            <option value="Scheduled">Currently Scheduled</option>
                            <option value="Off">Off Today</option>
                        </select>
                    </div>
                </div>

                <!-- Employee Grid Cards -->
                <div id="smartEmployeeGrid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 16px; margin-bottom: 20px;">
                    <!-- Employee Cards will be dynamically generated -->
                </div>

                <!-- Comprehensive Employee Scheduling Calendar -->
                <div id="selectedEmployeeScheduling" style="display: none; background: rgba(0,0,0,0.4); border: 2px solid #00ffff; border-radius: 16px; padding: 24px; margin-top: 24px;">
                    <!-- Header -->
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <div>
                            <h3 id="selectedEmployeeName" style="color: #00ffff; margin: 0; font-size: 24px;"></h3>
                            <p id="selectedEmployeeRole" style="color: #94a3b8; margin: 4px 0 0 0;"></p>
                        </div>
                        <div style="display: flex; gap: 8px;">
                            <button onclick="switchSchedulingView('shifts')" id="shiftsViewBtn" style="background: rgba(0,255,255,0.2); border: 1px solid rgba(0,255,255,0.5); color: #00ffff; padding: 8px 16px; border-radius: 6px; cursor: pointer;">All Shifts</button>
                            <button onclick="switchSchedulingView('coverage')" id="coverageViewBtn" style="background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 8px 16px; border-radius: 6px; cursor: pointer;">Coverage</button>
                            <button onclick="closeEmployeeScheduling()" style="background: rgba(255,0,0,0.2); border: 1px solid rgba(255,0,0,0.5); color: #ff4444; padding: 8px 16px; border-radius: 6px; cursor: pointer;">Close</button>
                        </div>
                    </div>

                    <!-- Week Navigation -->
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; background: rgba(0,0,0,0.3); padding: 12px; border-radius: 8px;">
                        <button onclick="navigateSchedulingWeek(-1)" style="background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 8px 12px; border-radius: 6px; cursor: pointer;">← Previous</button>
                        <h4 id="schedulingWeekRange" style="color: #ffd700; margin: 0; font-size: 18px;">January 21-27, 2025</h4>
                        <button onclick="navigateSchedulingWeek(1)" style="background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 8px 12px; border-radius: 6px; cursor: pointer;">Next →</button>
                    </div>

                    <!-- Shift Templates Quick Selection -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="color: #ffd700; margin-bottom: 12px; font-size: 16px;">Quick Shift Templates</h4>
                        <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                            <button class="shift-template" data-start="06:00" data-end="14:00" onclick="selectShiftTemplate(this)" style="background: rgba(255,215,0,0.2); border: 1px solid rgba(255,215,0,0.5); color: #ffd700; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px;">Morning<br>6AM-2PM</button>
                            <button class="shift-template" data-start="14:00" data-end="22:00" onclick="selectShiftTemplate(this)" style="background: rgba(0,255,255,0.2); border: 1px solid rgba(0,255,255,0.5); color: #00ffff; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px;">Afternoon<br>2PM-10PM</button>
                            <button class="shift-template" data-start="22:00" data-end="06:00" onclick="selectShiftTemplate(this)" style="background: rgba(255,107,157,0.2); border: 1px solid rgba(255,107,157,0.5); color: #ff6b9d; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px;">Night<br>10PM-6AM</button>
                            <button class="shift-template" data-start="09:00" data-end="17:00" onclick="selectShiftTemplate(this)" style="background: rgba(0,255,136,0.2); border: 1px solid rgba(0,255,136,0.5); color: #00ff88; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px;">Day<br>9AM-5PM</button>
                            <button onclick="showCustomTimeModal()" style="background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px;">Custom</button>
                        </div>
                    </div>

                    <!-- Full Schedule Calendar with All Shifts -->
                    <div id="fullScheduleCalendar" style="background: rgba(0,0,0,0.3); border-radius: 12px; padding: 16px; margin-bottom: 20px;">
                        <!-- Calendar Header -->
                        <div style="display: grid; grid-template-columns: 80px repeat(7, 1fr); gap: 8px; margin-bottom: 12px;">
                            <div style="color: #94a3b8; font-size: 12px; font-weight: bold; text-align: center;">Time</div>
                            <div style="color: #94a3b8; font-size: 12px; font-weight: bold; text-align: center;">Mon</div>
                            <div style="color: #94a3b8; font-size: 12px; font-weight: bold; text-align: center;">Tue</div>
                            <div style="color: #94a3b8; font-size: 12px; font-weight: bold; text-align: center;">Wed</div>
                            <div style="color: #94a3b8; font-size: 12px; font-weight: bold; text-align: center;">Thu</div>
                            <div style="color: #94a3b8; font-size: 12px; font-weight: bold; text-align: center;">Fri</div>
                            <div style="color: #94a3b8; font-size: 12px; font-weight: bold; text-align: center;">Sat</div>
                            <div style="color: #94a3b8; font-size: 12px; font-weight: bold; text-align: center;">Sun</div>
                        </div>
                        
                        <!-- Time Slots with Existing Shifts -->
                        <div id="scheduleTimeSlots" style="display: grid; grid-template-columns: 80px repeat(7, 1fr); gap: 8px;">
                            <!-- Time slots will be generated dynamically -->
                        </div>
                    </div>

                    <!-- Coverage Analysis -->
                    <div id="coverageAnalysis" style="display: none; background: rgba(0,0,0,0.3); border-radius: 12px; padding: 16px; margin-bottom: 20px;">
                        <h4 style="color: #ffd700; margin-bottom: 12px;">Staffing Coverage Analysis</h4>
                        <div id="coverageChart" style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px;">
                            <!-- Coverage analysis will be generated -->
                        </div>
                    </div>

                    <!-- Schedule Actions -->
                    <div style="display: flex; gap: 12px; justify-content: center; flex-wrap: wrap;">
                        <button id="addShiftBtn" onclick="addShiftToCalendar()" style="background: linear-gradient(135deg, #00ffff, #0066ff); border: none; color: white; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: bold;">Add Shift</button>
                        <button onclick="replaceShift()" style="background: rgba(255,215,0,0.2); border: 1px solid rgba(255,215,0,0.5); color: #ffd700; padding: 12px 24px; border-radius: 8px; cursor: pointer;">Replace Shift</button>
                        <button onclick="swapShifts()" style="background: rgba(255,107,157,0.2); border: 1px solid rgba(255,107,157,0.5); color: #ff6b9d; padding: 12px 24px; border-radius: 8px; cursor: pointer;">Swap Shifts</button>
                        <button onclick="viewEmployeeStats()" style="background: rgba(0,255,136,0.2); border: 1px solid rgba(0,255,136,0.5); color: #00ff88; padding: 12px 24px; border-radius: 8px; cursor: pointer;">View Stats</button>
                    </div>
                </div>

                <!-- Employee Summary Panel - MOVED BELOW MANAGEMENT SECTION -->
                <div class="summary-panel" style="margin-top: 30px;">
                    <div class="summary-card">
                        <div class="summary-title">Shift Summary</div>
                        <div class="summary-content">
                            <div class="shift-summary-item">
                                <div>
                                    <div class="shift-time">5AM - 11AM</div>
                                    <div class="shift-employees">Stock/Inventory</div>
                                </div>
                                <div class="employee-count">1</div>
                            </div>
                            <div class="shift-summary-item">
                                <div>
                                    <div class="shift-time">7AM - 2PM</div>
                                    <div class="shift-employees">Management + Sales</div>
                                </div>
                                <div class="employee-count">3</div>
                            </div>
                            <div class="shift-summary-item">
                                <div>
                                    <div class="shift-time">2PM - 7PM</div>
                                    <div class="shift-employees">Peak Hours</div>
                                </div>
                                <div class="employee-count">3</div>
                            </div>
                            <div class="shift-summary-item">
                                <div>
                                    <div class="shift-time">6PM - 2AM</div>
                                    <div class="shift-employees">Evening/Security</div>
                                </div>
                                <div class="employee-count">2</div>
                            </div>
                        </div>
                    </div>

                    <div class="summary-card">
                        <div class="summary-title">Overlap Analysis</div>
                        <div class="summary-content">
                            <div class="shift-summary-item">
                                <div>
                                    <div class="shift-time">10AM - 12PM</div>
                                    <div class="shift-employees">Sarah, Mike, Jessica</div>
                                </div>
                                <div class="employee-count">3</div>
                            </div>
                            <div class="shift-summary-item">
                                <div>
                                    <div class="shift-time">12PM - 1PM</div>
                                    <div class="shift-employees">Sarah, Jessica</div>
                                </div>
                                <div class="employee-count">2</div>
                            </div>
                            <div class="shift-summary-item">
                                <div>
                                    <div class="shift-time">2PM - 6PM</div>
                                    <div class="shift-employees">Sarah, Jessica, Emma</div>
                                </div>
                                <div class="employee-count">3</div>
                            </div>
                            <div class="shift-summary-item">
                                <div>
                                    <div class="shift-time">6PM - 10PM</div>
                                    <div class="shift-employees">Emma, Carlos</div>
                                </div>
                                <div class="employee-count">2</div>
                            </div>
                        </div>
                    </div>

                    <div class="summary-card">
                        <div class="summary-title">Coverage Stats</div>
                        <div class="summary-content">
                            <div class="shift-summary-item">
                                <div>
                                    <div class="shift-time">Total Hours</div>
                                    <div class="shift-employees">Scheduled today</div>
                                </div>
                                <div class="employee-count">47</div>
                            </div>
                            <div class="shift-summary-item">
                                <div>
                                    <div class="shift-time">Peak Coverage</div>
                                    <div class="shift-employees">2PM - 6PM</div>
                                </div>
                                <div class="employee-count">3</div>
                            </div>
                            <div class="shift-summary-item">
                                <div>
                                    <div class="shift-time">Minimum Coverage</div>
                                    <div class="shift-employees">5AM - 7AM, 10PM - 2AM</div>
                                </div>
                                <div class="employee-count">1</div>
                            </div>
                            <div class="shift-summary-item">
                                <div>
                                    <div class="shift-time">Break Periods</div>
                                    <div class="shift-employees">Scheduled breaks</div>
                                </div>
                                <div class="employee-count">1</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Shift Template Creator Modal -->
        <div id="shiftTemplateModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; padding: 20px; box-sizing: border-box;">
            <div style="background: linear-gradient(135deg, #1a1a2e, #16213e); border: 2px solid #00ffff; border-radius: 16px; max-width: 500px; margin: 50px auto; padding: 24px; position: relative;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 style="color: #00ffff; margin: 0;">Create Custom Shift Template</h3>
                    <button onclick="closeShiftTemplateModal()" style="background: rgba(255,0,0,0.2); border: 1px solid rgba(255,0,0,0.5); color: #ff4444; padding: 8px 12px; border-radius: 6px; cursor: pointer;">✕</button>
                </div>

                <form onsubmit="createShiftTemplate(event)" style="display: flex; flex-direction: column; gap: 16px;">
                    <div>
                        <label style="display: block; color: #94a3b8; margin-bottom: 8px; font-weight: 500;">Template Name</label>
                        <input type="text" id="templateName" placeholder="e.g., Opening Shift, Closing Shift" style="width: 100%; padding: 12px; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; background: rgba(0,0,0,0.3); color: white;" required>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                        <div>
                            <label style="display: block; color: #94a3b8; margin-bottom: 8px; font-weight: 500;">Start Time</label>
                            <input type="time" id="templateStartTime" style="width: 100%; padding: 12px; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; background: rgba(0,0,0,0.3); color: white;" required>
                        </div>
                        <div>
                            <label style="display: block; color: #94a3b8; margin-bottom: 8px; font-weight: 500;">End Time</label>
                            <input type="time" id="templateEndTime" style="width: 100%; padding: 12px; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; background: rgba(0,0,0,0.3); color: white;" required>
                        </div>
                    </div>

                    <div>
                        <label style="display: block; color: #94a3b8; margin-bottom: 8px; font-weight: 500;">Template Color</label>
                        <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                            <button type="button" onclick="selectTemplateColor('#ffd700')" class="color-option" data-color="#ffd700" style="width: 40px; height: 40px; border: 2px solid rgba(255,255,255,0.2); border-radius: 8px; background: #ffd700; cursor: pointer;"></button>
                            <button type="button" onclick="selectTemplateColor('#00ffff')" class="color-option" data-color="#00ffff" style="width: 40px; height: 40px; border: 2px solid rgba(255,255,255,0.2); border-radius: 8px; background: #00ffff; cursor: pointer;"></button>
                            <button type="button" onclick="selectTemplateColor('#ff6b9d')" class="color-option" data-color="#ff6b9d" style="width: 40px; height: 40px; border: 2px solid rgba(255,255,255,0.2); border-radius: 8px; background: #ff6b9d; cursor: pointer;"></button>
                            <button type="button" onclick="selectTemplateColor('#00ff88')" class="color-option" data-color="#00ff88" style="width: 40px; height: 40px; border: 2px solid rgba(255,255,255,0.2); border-radius: 8px; background: #00ff88; cursor: pointer;"></button>
                            <button type="button" onclick="selectTemplateColor('#9b59b6')" class="color-option" data-color="#9b59b6" style="width: 40px; height: 40px; border: 2px solid rgba(255,255,255,0.2); border-radius: 8px; background: #9b59b6; cursor: pointer;"></button>
                            <button type="button" onclick="selectTemplateColor('#e74c3c')" class="color-option" data-color="#e74c3c" style="width: 40px; height: 40px; border: 2px solid rgba(255,255,255,0.2); border-radius: 8px; background: #e74c3c; cursor: pointer;"></button>
                        </div>
                        <input type="hidden" id="selectedTemplateColor" value="#ffd700">
                    </div>

                    <div>
                        <label style="display: block; color: #94a3b8; margin-bottom: 8px; font-weight: 500;">Description (Optional)</label>
                        <textarea id="templateDescription" placeholder="Brief description of this shift..." style="width: 100%; padding: 12px; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; background: rgba(0,0,0,0.3); color: white; resize: vertical; min-height: 60px;"></textarea>
                    </div>

                    <div style="display: flex; gap: 12px; justify-content: center; margin-top: 8px;">
                        <button type="button" onclick="closeShiftTemplateModal()" style="background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 12px 24px; border-radius: 8px; cursor: pointer;">Cancel</button>
                        <button type="submit" style="background: linear-gradient(135deg, #00ffff, #0066ff); border: none; color: white; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: bold;">Create Template</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Mobile-Responsive CSS -->
        <style>
            @media (min-width: 768px) {
                .modal-main-grid {
                    grid-template-columns: 1fr 1fr !important;
                    gap: 24px !important;
                }
                #comprehensiveSchedulingModal .modal-container {
                    padding: 24px !important;
                }
                #comprehensiveSchedulingModal h2 {
                    font-size: 24px !important;
                }
                #comprehensiveSchedulingModal h3 {
                    font-size: 18px !important;
                }
            }
            @media (max-width: 480px) {
                #modalEmployeeGrid {
                    grid-template-columns: 1fr !important;
                }
                #modalShiftTemplates {
                    grid-template-columns: 1fr !important;
                }
                .modal-calendar-day {
                    padding: 8px 4px !important;
                    font-size: 12px !important;
                }
            }
        </style>

        <!-- Comprehensive Shift Template and Employee Scheduling Modal -->
        <div id="comprehensiveSchedulingModal" style="display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.9); z-index: 2000; padding: 10px; box-sizing: border-box; overflow-y: auto;">
            <div class="modal-container" style="background: linear-gradient(135deg, #1a1a2e, #16213e); border: 2px solid #00ffff; border-radius: 16px; max-width: 1200px; width: 100%; margin: 0 auto; padding: 16px; position: relative; min-height: calc(100vh - 20px); display: flex; flex-direction: column;">
                
                <!-- Header -->
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; flex-shrink: 0;">
                    <h2 style="color: #00ffff; margin: 0; font-size: 18px; line-height: 1.2;">Create Shift Template and Add Employees</h2>
                    <button onclick="closeComprehensiveSchedulingModal()" style="background: rgba(255,0,0,0.3); border: 2px solid #ff4444; color: #ff4444; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 14px; min-width: 60px;">✕</button>
                </div>

                <!-- Step Progress Indicator -->
                <div style="display: flex; gap: 8px; margin-bottom: 16px; align-items: center; justify-content: center; flex-shrink: 0; flex-wrap: nowrap; overflow-x: auto;">
                    <div id="step1Indicator" style="display: flex; flex-direction: column; align-items: center; min-width: 80px; flex-shrink: 0;">
                        <div style="width: 32px; height: 32px; border-radius: 50%; background: linear-gradient(135deg, #ffd700, #4169e1); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; margin-bottom: 4px; font-size: 14px;">1</div>
                        <span style="color: #ffd700; font-size: 10px; font-weight: bold; text-align: center;">Employees</span>
                    </div>
                    <div style="width: 30px; height: 2px; background: linear-gradient(90deg, #ffd700, #00ffff); margin: 8px 4px; flex-shrink: 0;"></div>
                    <div id="step2Indicator" style="display: flex; flex-direction: column; align-items: center; min-width: 80px; flex-shrink: 0;">
                        <div style="width: 32px; height: 32px; border-radius: 50%; background: rgba(0,255,255,0.3); border: 2px solid #00ffff; display: flex; align-items: center; justify-content: center; color: #00ffff; font-weight: bold; margin-bottom: 4px; font-size: 14px;">2</div>
                        <span style="color: #00ffff; font-size: 10px; text-align: center;">Shifts</span>
                    </div>
                    <div style="width: 30px; height: 2px; background: linear-gradient(90deg, #00ffff, #8a2be2); margin: 8px 4px; flex-shrink: 0;"></div>
                    <div id="step3Indicator" style="display: flex; flex-direction: column; align-items: center; min-width: 80px; flex-shrink: 0;">
                        <div style="width: 32px; height: 32px; border-radius: 50%; background: rgba(138,43,226,0.3); border: 2px solid #8a2be2; display: flex; align-items: center; justify-content: center; color: #8a2be2; font-weight: bold; margin-bottom: 4px; font-size: 14px;">3</div>
                        <span style="color: #8a2be2; font-size: 10px; text-align: center;">Days</span>
                    </div>
                </div>

                <!-- Main Content Grid -->
                <div class="modal-main-grid" style="display: grid; grid-template-columns: 1fr; gap: 16px; margin-bottom: 16px; flex: 1; overflow-y: auto;">
                    
                    <!-- Left Column: Employee Selection -->
                    <div style="background: rgba(0,0,0,0.4); border-radius: 12px; padding: 16px; border: 2px solid rgba(255,215,0,0.3);">
                        <h3 style="color: #ffd700; margin-bottom: 12px; font-size: 16px; display: flex; align-items: center; gap: 8px;">
                            <span style="width: 24px; height: 24px; border-radius: 50%; background: #ffd700; color: black; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 12px;">1</span>
                            Select Employees
                        </h3>
                        
                        <!-- Employee Search and Filter -->
                        <div style="margin-bottom: 12px;">
                            <input type="text" id="modalEmployeeSearch" placeholder="Search employees..." style="width: 100%; padding: 8px; border: 1px solid rgba(255,255,255,0.2); border-radius: 6px; background: rgba(0,0,0,0.3); color: white; margin-bottom: 8px; font-size: 14px;" onkeyup="filterModalEmployees()">
                            <select id="modalRoleFilter" style="width: 100%; padding: 8px; border: 1px solid rgba(255,255,255,0.2); border-radius: 6px; background: rgba(0,0,0,0.3); color: white; font-size: 14px;" onchange="filterModalEmployees()">
                                <option value="">All Roles</option>
                                <option value="Manager">Managers</option>
                                <option value="Cashier">Cashiers</option>
                                <option value="Sales">Sales</option>
                                <option value="Stock">Stock</option>
                                <option value="Assistant">Assistants</option>
                                <option value="Security">Security</option>
                                <!-- Custom roles will be populated here -->
                            </select>
                        </div>
                        
                        <!-- Employee Selection Grid -->
                        <div id="modalEmployeeGrid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 8px; max-height: 200px; overflow-y: auto;">
                            <!-- Employees will be populated here -->
                        </div>
                        
                        <!-- Selected Employees Display -->
                        <div style="margin-top: 12px;">
                            <h4 style="color: #00ffff; margin-bottom: 8px; font-size: 14px;">Selected (<span id="selectedEmployeeCount">0</span>)</h4>
                            <div id="selectedEmployeesList" style="display: flex; flex-wrap: wrap; gap: 6px; min-height: 30px; padding: 8px; background: rgba(0,0,0,0.3); border-radius: 6px; border: 1px solid rgba(255,255,255,0.1);">
                                <span style="color: #94a3b8; font-style: italic; font-size: 12px;">No employees selected</span>
                            </div>
                        </div>
                    </div>

                    <!-- Right Column: Shift Selection -->
                    <div style="background: rgba(0,0,0,0.4); border-radius: 12px; padding: 16px; border: 2px solid rgba(0,255,255,0.3);">
                        <h3 style="color: #00ffff; margin-bottom: 12px; font-size: 16px; display: flex; align-items: center; gap: 8px;">
                            <span style="width: 24px; height: 24px; border-radius: 50%; background: #00ffff; color: black; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 12px;">2</span>
                            Choose Shifts
                        </h3>
                        
                        <!-- Custom Schedule Titles -->
                        <div style="margin-bottom: 16px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                <h4 style="color: #94a3b8; font-size: 14px; margin: 0;">Custom Schedule Titles</h4>
                                <div style="display: flex; gap: 6px;">
                                    <button onclick="clearCustomTitleSelection()" style="background: rgba(255,0,0,0.2); border: 1px solid rgba(255,0,0,0.5); color: #ff4444; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 12px;">Clear</button>
                                    <button onclick="showCustomTitleModal()" style="background: rgba(255,215,0,0.2); border: 1px solid rgba(255,215,0,0.5); color: #ffd700; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 12px;">+ Add Title</button>
                                </div>
                            </div>
                            <div id="customScheduleTitles" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 6px; margin-bottom: 12px; min-height: 40px; background: rgba(0,0,0,0.2); border-radius: 6px; padding: 8px; border: 1px dashed rgba(255,255,255,0.2);">
                                <!-- Custom titles will be populated here -->
                            </div>
                        </div>

                        <!-- Custom Role Management Section -->
                        <div style="margin-bottom: 16px; padding: 16px; background: rgba(138,43,226,0.1); border: 1px solid rgba(138,43,226,0.3); border-radius: 8px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                                <h4 style="color: #8a2be2; font-size: 14px; margin: 0;">Festival & Event Roles</h4>
                                <button onclick="showCustomRoleModal()" style="background: rgba(138,43,226,0.2); border: 1px solid rgba(138,43,226,0.5); color: #8a2be2; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 12px;">+ Add Role</button>
                            </div>
                            <div id="customRolesList" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 6px; margin-bottom: 8px; min-height: 40px; background: rgba(0,0,0,0.2); border-radius: 6px; padding: 8px; border: 1px dashed rgba(138,43,226,0.2);">
                                <!-- Custom roles will be populated here -->
                            </div>
                            <small style="color: #94a3b8; font-style: italic;">Add custom roles for festivals, events, artists, vendors, and more</small>
                        </div>

                        <!-- Preset Shift Templates -->
                        <div style="margin-bottom: 16px;">
                            <h4 style="color: #94a3b8; margin-bottom: 8px; font-size: 14px;">Quick Time Templates</h4>
                            <div id="modalShiftTemplates" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px;">
                                <button class="modal-shift-template" data-start="06:00" data-end="14:00" onclick="selectModalShiftTemplate(this)" style="background: rgba(255,215,0,0.2); border: 2px solid rgba(255,215,0,0.5); color: #ffd700; padding: 8px; border-radius: 6px; cursor: pointer; text-align: center; font-weight: bold; transition: all 0.3s ease; font-size: 12px;">
                                    Morning<br><small style="font-weight: normal;">6AM - 2PM</small>
                                </button>
                                <button class="modal-shift-template" data-start="14:00" data-end="22:00" onclick="selectModalShiftTemplate(this)" style="background: rgba(0,255,255,0.2); border: 2px solid rgba(0,255,255,0.5); color: #00ffff; padding: 8px; border-radius: 6px; cursor: pointer; text-align: center; font-weight: bold; transition: all 0.3s ease; font-size: 12px;">
                                    Afternoon<br><small style="font-weight: normal;">2PM - 10PM</small>
                                </button>
                                <button class="modal-shift-template" data-start="22:00" data-end="06:00" onclick="selectModalShiftTemplate(this)" style="background: rgba(255,107,157,0.2); border: 2px solid rgba(255,107,157,0.5); color: #ff6b9d; padding: 8px; border-radius: 6px; cursor: pointer; text-align: center; font-weight: bold; transition: all 0.3s ease; font-size: 12px;">
                                    Night<br><small style="font-weight: normal;">10PM - 6AM</small>
                                </button>
                                <button class="modal-shift-template" data-start="09:00" data-end="17:00" onclick="selectModalShiftTemplate(this)" style="background: rgba(0,255,136,0.2); border: 2px solid rgba(0,255,136,0.5); color: #00ff88; padding: 8px; border-radius: 6px; cursor: pointer; text-align: center; font-weight: bold; transition: all 0.3s ease; font-size: 12px;">
                                    Day<br><small style="font-weight: normal;">9AM - 5PM</small>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Custom Time Selection -->
                        <div style="margin-bottom: 24px;">
                            <h4 style="color: #94a3b8; margin-bottom: 12px; font-size: 16px;">Custom Times</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                                <div>
                                    <label style="display: block; color: #94a3b8; margin-bottom: 6px; font-size: 14px;">Start Time</label>
                                    <input type="time" id="modalCustomStartTime" style="width: 100%; padding: 10px; border: 1px solid rgba(255,255,255,0.2); border-radius: 6px; background: rgba(0,0,0,0.3); color: white;" onchange="updateCustomShiftTemplate()">
                                </div>
                                <div>
                                    <label style="display: block; color: #94a3b8; margin-bottom: 6px; font-size: 14px;">End Time</label>
                                    <input type="time" id="modalCustomEndTime" style="width: 100%; padding: 10px; border: 1px solid rgba(255,255,255,0.2); border-radius: 6px; background: rgba(0,0,0,0.3); color: white;" onchange="updateCustomShiftTemplate()">
                                </div>
                            </div>
                        </div>

                        <!-- Selected Custom Title Display -->
                        <div id="selectedCustomTitleDisplay" style="padding: 16px; background: rgba(255,215,0,0.1); border-radius: 8px; border: 1px solid rgba(255,215,0,0.3); margin-bottom: 16px; display: none;">
                            <h4 style="color: #ffd700; margin: 0 0 8px 0; font-size: 16px;">Custom Schedule Title</h4>
                            <div id="selectedCustomTitleInfo" style="color: #ffd700; font-weight: bold; font-size: 14px;"></div>
                            <small style="color: #94a3b8; font-style: italic;">This will be the primary title for your scheduled shifts</small>
                        </div>

                        <!-- Selected Shift Display -->
                        <div style="padding: 16px; background: rgba(0,0,0,0.3); border-radius: 8px; border: 1px solid rgba(255,255,255,0.1);">
                            <h4 style="color: #00ffff; margin: 0 0 8px 0; font-size: 16px;">Selected Shift Template</h4>
                            <div id="selectedShiftDisplay" style="color: #94a3b8; font-style: italic;">No shift template selected</div>
                        </div>
                    </div>
                </div>

                <!-- Bottom Section: Multi-Day Calendar -->
                <div style="background: rgba(0,0,0,0.4); border-radius: 12px; padding: 16px; border: 2px solid rgba(138,43,226,0.3); margin-bottom: 16px; flex-shrink: 0;">
                    <h3 style="color: #8a2be2; margin-bottom: 12px; font-size: 16px; display: flex; align-items: center; gap: 8px;">
                        <span style="width: 24px; height: 24px; border-radius: 50%; background: #8a2be2; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 12px;">3</span>
                        Select Days
                    </h3>
                    
                    <!-- Quick Day Selection Buttons -->
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 6px; margin-bottom: 12px;">
                        <button onclick="selectModalCalendarRange('thisWeek')" style="background: rgba(255,215,0,0.2); border: 2px solid rgba(255,215,0,0.5); color: #ffd700; padding: 6px 8px; border-radius: 6px; cursor: pointer; font-weight: bold; transition: all 0.3s ease; font-size: 11px;">This Week</button>
                        <button onclick="selectModalCalendarRange('nextWeek')" style="background: rgba(0,255,255,0.2); border: 2px solid rgba(0,255,255,0.5); color: #00ffff; padding: 6px 8px; border-radius: 6px; cursor: pointer; font-weight: bold; transition: all 0.3s ease; font-size: 11px;">Next Week</button>
                        <button onclick="selectModalCalendarRange('weekends')" style="background: rgba(255,107,157,0.2); border: 2px solid rgba(255,107,157,0.5); color: #ff6b9d; padding: 6px 8px; border-radius: 6px; cursor: pointer; font-weight: bold; transition: all 0.3s ease; font-size: 11px;">Weekends</button>
                        <button onclick="clearModalCalendarSelection()" style="background: rgba(255,0,0,0.2); border: 2px solid rgba(255,0,0,0.5); color: #ff4444; padding: 6px 8px; border-radius: 6px; cursor: pointer; font-weight: bold; transition: all 0.3s ease; font-size: 11px;">Clear</button>
                    </div>

                    <!-- Calendar Grid -->
                    <div id="multiDayCalendar" style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; padding: 12px; background: rgba(0,0,0,0.3); border-radius: 8px; border: 1px solid rgba(255,255,255,0.1); max-height: 200px; overflow-y: auto;">
                        <!-- Calendar will be populated by JavaScript -->
                    </div>
                    
                    <!-- Selected Days Display -->
                    <div style="margin-top: 12px;">
                        <h4 style="color: #00ffff; margin-bottom: 8px; font-size: 14px;">Selected Days (<span id="selectedDaysCount">0</span>)</h4>
                        <div id="selectedDaysList" style="display: flex; flex-wrap: wrap; gap: 4px; min-height: 30px; padding: 8px; background: rgba(0,0,0,0.3); border-radius: 6px; border: 1px solid rgba(255,255,255,0.1);">
                            <span style="color: #94a3b8; font-style: italic; font-size: 12px;">No days selected</span>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 8px; flex-shrink: 0;">
                    <button onclick="closeComprehensiveSchedulingModal()" style="background: rgba(255,255,255,0.1); border: 2px solid rgba(255,255,255,0.3); color: white; padding: 12px 16px; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 14px;">Cancel</button>
                    <button id="bulkScheduleBtn" onclick="executeBulkScheduling()" disabled style="background: linear-gradient(135deg, #00ffff, #8a2be2); border: none; color: white; padding: 12px 16px; border-radius: 6px; cursor: pointer; font-weight: bold; opacity: 0.5; transition: all 0.3s ease; font-size: 14px;">
                        Schedule Employees
                    </button>
                </div>
            </div>
        </div>

        <!-- Volunteers Tab -->
        <div id="volunteers" class="tab-content">
            <!-- Volunteer Management Section - MOVED TO TOP -->
            <div class="card" style="margin-bottom: 20px; border: 2px solid rgba(138, 43, 226, 0.3); background: linear-gradient(135deg, rgba(138, 43, 226, 0.1), rgba(65, 105, 225, 0.1));">
                <div class="card-header">
                    <h2 class="card-title" style="color: #8a2be2; font-size: 24px;">🎯 Volunteer Management System</h2>
                    <button class="btn btn-primary" onclick="addVolunteer()" style="background: linear-gradient(135deg, #8a2be2, #4169e1); border: none; padding: 12px 20px;">Add New Volunteer</button>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 12px;">
                        <h3 style="color: #8a2be2; margin-bottom: 16px;">Quick Add Volunteer</h3>
                        <form onsubmit="submitVolunteerForm(event)">
                            <div style="margin-bottom: 12px;">
                                <label style="display: block; color: #94a3b8; margin-bottom: 4px;">Volunteer Name</label>
                                <input type="text" id="volunteerName" style="width: 100%; padding: 8px; border: 1px solid rgba(255,255,255,0.2); border-radius: 6px; background: rgba(0,0,0,0.2); color: white;" placeholder="Enter full name" required>
                            </div>
                            <div style="margin-bottom: 12px;">
                                <label style="display: block; color: #94a3b8; margin-bottom: 4px;">Skills/Interests</label>
                                <select id="volunteerSkills" style="width: 100%; padding: 8px; border: 1px solid rgba(255,255,255,0.2); border-radius: 6px; background: rgba(0,0,0,0.2); color: white;">
                                    <option value="Event Setup">Event Setup</option>
                                    <option value="Customer Service">Customer Service</option>
                                    <option value="Social Media">Social Media</option>
                                    <option value="Photography">Photography</option>
                                    <option value="Cleanup">Cleanup</option>
                                    <option value="Food Service">Food Service</option>
                                </select>
                            </div>
                            <div style="margin-bottom: 12px;">
                                <label style="display: block; color: #94a3b8; margin-bottom: 4px;">Availability</label>
                                <select id="volunteerAvailability" style="width: 100%; padding: 8px; border: 1px solid rgba(255,255,255,0.2); border-radius: 6px; background: rgba(0,0,0,0.2); color: white;">
                                    <option value="Weekends Only">Weekends Only</option>
                                    <option value="Weekdays Only">Weekdays Only</option>
                                    <option value="Flexible">Flexible</option>
                                    <option value="Events Only">Events Only</option>
                                </select>
                            </div>
                            <button type="submit" class="btn btn-primary" style="width: 100%;">Add Volunteer</button>
                        </form>
                    </div>

                    <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 12px;">
                        <h3 style="color: #00ffff; margin-bottom: 16px;">Volunteer Stats</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                            <div style="text-align: center;">
                                <div style="font-size: 24px; font-weight: bold; color: #ffd700;" id="totalVolunteers">12</div>
                                <div style="color: #94a3b8; font-size: 14px;">Total Volunteers</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 24px; font-weight: bold; color: #00ffff;" id="activeVolunteers">8</div>
                                <div style="color: #94a3b8; font-size: 14px;">Active This Week</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 24px; font-weight: bold; color: #ff6b9d;" id="volunteerHours">156</div>
                                <div style="color: #94a3b8; font-size: 14px;">Hours This Month</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 24px; font-weight: bold; color: #00ff88;" id="upcomingEvents">3</div>
                                <div style="color: #94a3b8; font-size: 14px;">Upcoming Events</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 12px;">
                    <h3 style="color: #00ffff; margin-bottom: 16px;">Current Volunteers</h3>
                    <div id="volunteerList" style="display: grid; gap: 12px;">
                        <div class="volunteer-item" style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                            <div>
                                <div style="font-weight: bold; color: white;">Alex Rivera</div>
                                <div style="color: #94a3b8; font-size: 14px;">Event Setup • Weekends Only</div>
                            </div>
                            <div style="display: flex; gap: 8px;">
                                <button class="btn" style="padding: 6px 12px; font-size: 12px;" onclick="editVolunteer('Alex Rivera')">Edit</button>
                                <button class="btn" style="padding: 6px 12px; font-size: 12px; background: rgba(255,0,0,0.2);" onclick="removeVolunteer('Alex Rivera')">Remove</button>
                            </div>
                        </div>
                        <div class="volunteer-item" style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                            <div>
                                <div style="font-weight: bold; color: white;">Maria Santos</div>
                                <div style="color: #94a3b8; font-size: 14px;">Customer Service • Flexible</div>
                            </div>
                            <div style="display: flex; gap: 8px;">
                                <button class="btn" style="padding: 6px 12px; font-size: 12px;" onclick="editVolunteer('Maria Santos')">Edit</button>
                                <button class="btn" style="padding: 6px 12px; font-size: 12px; background: rgba(255,0,0,0.2);" onclick="removeVolunteer('Maria Santos')">Remove</button>
                            </div>
                        </div>
                        <div class="volunteer-item" style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                            <div>
                                <div style="font-weight: bold; color: white;">James Kim</div>
                                <div style="color: #94a3b8; font-size: 14px;">Photography • Events Only</div>
                            </div>
                            <div style="display: flex; gap: 8px;">
                                <button class="btn" style="padding: 6px 12px; font-size: 12px;" onclick="editVolunteer('James Kim')">Edit</button>
                                <button class="btn" style="padding: 6px 12px; font-size: 12px; background: rgba(255,0,0,0.2);" onclick="removeVolunteer('James Kim')">Remove</button>
                            </div>
                        </div>
                        <div class="volunteer-item" style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                            <div>
                                <div style="font-weight: bold; color: white;">Sophie Chen</div>
                                <div style="color: #94a3b8; font-size: 14px;">Social Media • Weekdays Only</div>
                            </div>
                            <div style="display: flex; gap: 8px;">
                                <button class="btn" style="padding: 6px 12px; font-size: 12px;" onclick="editVolunteer('Sophie Chen')">Edit</button>
                                <button class="btn" style="padding: 6px 12px; font-size: 12px; background: rgba(255,0,0,0.2);" onclick="removeVolunteer('Sophie Chen')">Remove</button>
                            </div>
                        </div>
                        <div class="volunteer-item" style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                            <div>
                                <div style="font-weight: bold; color: white;">Carlos Rodriguez</div>
                                <div style="color: #94a3b8; font-size: 14px;">Food Service • Flexible</div>
                            </div>
                            <div style="display: flex; gap: 8px;">
                                <button class="btn" style="padding: 6px 12px; font-size: 12px;" onclick="editVolunteer('Carlos Rodriguez')">Edit</button>
                                <button class="btn" style="padding: 6px 12px; font-size: 12px; background: rgba(255,0,0,0.2);" onclick="removeVolunteer('Carlos Rodriguez')">Remove</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- QR System Tab -->
        <div id="qr-system" class="tab-content">
            <!-- Employee QR System - PROMINENT AT TOP -->
            <div class="card" style="margin-bottom: 20px; border: 2px solid rgba(0, 255, 255, 0.3); background: linear-gradient(135deg, rgba(0, 255, 255, 0.1), rgba(65, 105, 225, 0.1));">
                <div class="card-header">
                    <h2 class="card-title" style="color: #00ffff; font-size: 24px;">🔳 Employee QR Check-In System</h2>
                    <div style="display: flex; gap: 12px;">
                        <button class="btn btn-primary" onclick="window.open('/employee-geo-qr-system.html', '_blank')" style="background: linear-gradient(135deg, #00ffff, #4169e1); border: none; padding: 12px 20px; color: #000;">Generate QR Codes</button>
                        <button class="btn" onclick="window.open('/scan-employee-qr.html', '_blank')" style="background: linear-gradient(135deg, #4169e1, #8a2be2); border: none; padding: 12px 20px;">QR Scanner</button>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 12px;">
                        <h3 style="color: #00ffff; margin-bottom: 16px;">Employee Check-In</h3>
                        <p style="color: #94a3b8; margin-bottom: 16px;">Generate QR codes for employees to check in and out of shifts with GPS verification.</p>
                        <button class="btn" onclick="window.open('/employee-geo-qr-system.html', '_blank')">Generate QR Codes</button>
                    </div>
                    
                    <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 12px;">
                        <h3 style="color: #00ffff; margin-bottom: 16px;">QR Scanner</h3>
                        <p style="color: #94a3b8; margin-bottom: 16px;">Scan employee QR codes to verify check-ins and process automatic payments.</p>
                        <button class="btn" onclick="window.open('/scan-employee-qr.html', '_blank')">Open Scanner</button>
                    </div>
                    
                    <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 12px;">
                        <h3 style="color: #00ffff; margin-bottom: 16px;">Payment Processing</h3>
                        <p style="color: #94a3b8; margin-bottom: 16px;">Automatic payment calculation based on hourly rates and custom schedules.</p>
                        <button class="btn" onclick="showNotification('Payment system is operational', 'success')">Test Payment System</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function showTab(tabName) {
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => content.classList.remove('active'));
            
            // Remove active class from all nav chips
            const navChips = document.querySelectorAll('.nav-chip');
            navChips.forEach(chip => chip.classList.remove('active'));
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            
            // Find and activate the correct nav chip
            const activeChip = document.querySelector(`[data-tab="${tabName}"]`);
            if (activeChip) {
                activeChip.classList.add('active');
            }
            
            // Move management sections to top based on tab
            moveManagementToTop(tabName);
        }

        function moveManagementToTop(tabName) {
            const tabContent = document.getElementById(tabName);
            
            if (tabName === 'employees') {
                // Smart Employee Management is already at the top in employees tab
                console.log('Smart Employee Management positioned at top of Employees tab');
            } else if (tabName === 'volunteers') {
                // Volunteer Management is already at the top in volunteers tab  
                console.log('Volunteer Management positioned at top of Volunteers tab');
            } else if (tabName === 'qr-system') {
                // Employee QR System is already at the top in QR System tab
                console.log('Employee QR System positioned at top of QR System tab');
            }
        }

        function addNewShift() {
            showNotification('Shift creation modal would open here', 'success');
        }

        function generateQRCodes() {
            window.open('/employee-geo-qr-system.html', '_blank');
        }

        // Calendar View Functions
        function switchToView(viewType) {
            // Update active toggle button
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Show/hide appropriate view
            const calendarView = document.getElementById('calendar-view');
            const listView = document.getElementById('list-view');
            
            if (viewType === 'calendar') {
                calendarView.style.display = 'block';
                listView.style.display = 'none';
            } else {
                calendarView.style.display = 'none';
                listView.style.display = 'block';
            }
            
            showNotification(`Switched to ${viewType} view`, 'success');
        }

        function navigateWeek(direction) {
            const weekRange = document.querySelector('.week-range');
            const direction_text = direction > 0 ? 'next' : 'previous';
            
            // Get current week dates
            const currentText = weekRange.textContent;
            const [startDate, endDate, year] = currentText.split(/[-,\s]+/);
            
            // Calculate new week
            let newStart = parseInt(startDate) + (direction * 7);
            let newEnd = parseInt(endDate) + (direction * 7);
            
            // Handle month boundaries (simplified)
            if (newStart < 1) {
                newStart = 28 + newStart;
                newEnd = newStart + 6;
            } else if (newStart > 31) {
                newStart = newStart - 31;
                newEnd = newStart + 6;
            }
            
            // Animate the change
            weekRange.style.transform = 'scale(0.95)';
            weekRange.style.opacity = '0.7';
            
            setTimeout(() => {
                weekRange.textContent = `July ${newStart} - ${newEnd}, ${year}`;
                weekRange.style.transform = 'scale(1)';
                weekRange.style.opacity = '1';
                showNotification(`Navigated to ${direction_text} week`, 'success');
            }, 200);
        }

        function editShift(shiftId) {
            // Parse shift ID to get details
            const [employee, day, startTime, endTime] = shiftId.split('-');
            const employeeNames = {
                'sarah': 'Sarah Johnson',
                'mike': 'Mike Chen',
                'jessica': 'Jessica Martinez',
                'david': 'David Wilson',
                'emma': 'Emma Davis',
                'carlos': 'Carlos Rodriguez'
            };
            
            const employeeName = employeeNames[employee] || employee;
            const dayName = day.toUpperCase();
            
            showNotification(`Editing ${employeeName}'s shift on ${dayName}`, 'success');
        }

        function editEmployee(employeeId) {
            const employeeNames = {
                'sarah': 'Sarah Johnson',
                'mike': 'Mike Chen',
                'jessica': 'Jessica Martinez',
                'david': 'David Wilson',
                'emma': 'Emma Davis',
                'carlos': 'Carlos Rodriguez'
            };
            
            const employeeName = employeeNames[employeeId] || 'Employee';
            showNotification(`Opening edit form for ${employeeName}`, 'success');
        }

        function addEmployee() {
            showAddEmployeeModal();
        }

        function addVolunteer() {
            showNotification('Add new volunteer using the form above', 'success');
        }

        // Smart Employee Management System
        let selectedEmployee = null;
        let selectedShiftTemplate = null;
        let selectedCalendarDays = [];
        
        const employees = [
            { id: 1, name: 'Riley Thompson', role: 'Cashier', rate: 16.50, status: 'Available', avatar: 'R', color: '#10b981' },
            { id: 2, name: 'Morgan Casey', role: 'Cashier', rate: 17.00, status: 'Available', avatar: 'M', color: '#10b981' },
            { id: 3, name: 'Alex Rivera', role: 'Cashier', rate: 15.75, status: 'Off', avatar: 'A', color: '#10b981' },
            { id: 4, name: 'Jordan Kim', role: 'Cashier', rate: 16.25, status: 'Scheduled', avatar: 'J', color: '#10b981' },
            { id: 5, name: 'Casey Morgan', role: 'Cashier', rate: 18.00, status: 'Available', avatar: 'C', color: '#ffd700' },
            { id: 6, name: 'Sarah Johnson', role: 'Manager', rate: 22.00, status: 'Scheduled', avatar: 'S', color: '#ff6b9d' }
        ];

        function initializeSmartEmployeeManagement() {
            generateEmployeeCards();
            generateMultiDayCalendar();
        }

        function generateEmployeeCards() {
            const grid = document.getElementById('smartEmployeeGrid');
            grid.innerHTML = '';

            employees.forEach(employee => {
                const statusColor = {
                    'Available': '#00ff88',
                    'Scheduled': '#00ffff', 
                    'Off': '#ff6b9d'
                }[employee.status];

                const card = document.createElement('div');
                card.className = 'employee-card';
                card.dataset.employeeId = employee.id;
                card.style.cssText = `
                    background: rgba(0,0,0,0.4);
                    border: 2px solid rgba(255,255,255,0.1);
                    border-radius: 16px;
                    padding: 16px;
                    cursor: pointer;
                    transition: all 0.3s ease;
                    position: relative;
                    min-height: 120px;
                `;

                card.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 16px;">
                        <div style="width: 60px; height: 60px; background: ${employee.color}; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: bold; color: white;">
                            ${employee.avatar}
                        </div>
                        <div style="flex: 1;">
                            <div style="font-size: 18px; font-weight: bold; color: white; margin-bottom: 4px;">${employee.name}</div>
                            <div style="color: #94a3b8; font-size: 14px;">${employee.role} • $${employee.rate}/hr</div>
                        </div>
                        <div style="width: 12px; height: 12px; background: ${statusColor}; border-radius: 50%; box-shadow: 0 0 8px ${statusColor};"></div>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="color: ${statusColor}; font-size: 14px; font-weight: 500;">${employee.status}</div>
                        <div style="display: flex; gap: 8px;">
                            <button onclick="viewEmployeeDetails(${employee.id}); event.stopPropagation();" style="background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px;">View</button>
                            <button onclick="selectEmployeeForScheduling(${employee.id}); event.stopPropagation();" style="background: linear-gradient(135deg, #00ffff, #0066ff); border: none; color: white; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: bold;">Schedule</button>
                        </div>
                    </div>
                `;

                card.addEventListener('click', () => selectEmployeeForScheduling(employee.id));
                card.addEventListener('mouseenter', () => {
                    card.style.border = '2px solid #00ffff';
                    card.style.transform = 'translateY(-2px)';
                    card.style.boxShadow = '0 8px 32px rgba(0,255,255,0.3)';
                });
                card.addEventListener('mouseleave', () => {
                    if (selectedEmployee?.id !== employee.id) {
                        card.style.border = '2px solid rgba(255,255,255,0.1)';
                        card.style.transform = 'translateY(0)';
                        card.style.boxShadow = 'none';
                    }
                });

                grid.appendChild(card);
            });
        }

        function selectEmployeeForScheduling(employeeId) {
            selectedEmployee = employees.find(emp => emp.id === employeeId);
            
            // Update card styling
            document.querySelectorAll('.employee-card').forEach(card => {
                if (parseInt(card.dataset.employeeId) === employeeId) {
                    card.style.border = '2px solid #ffd700';
                    card.style.background = 'rgba(255,215,0,0.1)';
                    card.style.transform = 'translateY(-2px)';
                } else {
                    card.style.border = '2px solid rgba(255,255,255,0.1)';
                    card.style.background = 'rgba(0,0,0,0.4)';
                    card.style.transform = 'translateY(0)';
                }
            });

            // Show scheduling interface
            document.getElementById('selectedEmployeeScheduling').style.display = 'block';
            document.getElementById('selectedEmployeeName').textContent = selectedEmployee.name;
            document.getElementById('selectedEmployeeRole').textContent = `${selectedEmployee.role} • $${selectedEmployee.rate}/hr • ${selectedEmployee.status}`;

            // Initialize comprehensive scheduling calendar
            generateFullScheduleCalendar();
            generateCoverageAnalysis();

            // Reset selections
            selectedShiftTemplate = null;
            selectedCalendarDays = [];
            updateShiftTemplateSelection();

            showNotification(`Selected ${selectedEmployee.name} for scheduling`, 'success');
        }

        function closeEmployeeScheduling() {
            selectedEmployee = null;
            selectedShiftTemplate = null;
            selectedCalendarDays = [];
            
            document.getElementById('selectedEmployeeScheduling').style.display = 'none';
            
            // Reset card styling
            document.querySelectorAll('.employee-card').forEach(card => {
                card.style.border = '2px solid rgba(255,255,255,0.1)';
                card.style.background = 'rgba(0,0,0,0.4)';
                card.style.transform = 'translateY(0)';
            });
        }

        function selectShiftTemplate(button) {
            selectedShiftTemplate = {
                start: button.dataset.start,
                end: button.dataset.end,
                name: button.textContent.split('\n')[0]
            };
            updateShiftTemplateSelection();
            showNotification(`Selected ${selectedShiftTemplate.name}`, 'success');
        }

        function updateShiftTemplateSelection() {
            document.querySelectorAll('.shift-template').forEach(btn => {
                if (selectedShiftTemplate && btn.dataset.start === selectedShiftTemplate.start) {
                    btn.style.background = 'rgba(255,215,0,0.4)';
                    btn.style.borderColor = '#ffd700';
                    btn.style.transform = 'scale(1.05)';
                } else {
                    btn.style.transform = 'scale(1)';
                }
            });
        }

        function generateMultiDayCalendar() {
            const calendar = document.getElementById('multiDayCalendar');
            if (!calendar) return;
            const today = new Date();
            const firstDay = new Date(today);
            firstDay.setDate(today.getDate() - today.getDay()); // Start of week

            // Day headers
            const dayHeaders = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            dayHeaders.forEach(day => {
                const header = document.createElement('div');
                header.style.cssText = 'text-align: center; color: #94a3b8; font-weight: bold; padding: 8px; font-size: 12px;';
                header.textContent = day;
                calendar.appendChild(header);
            });

            // Generate 4 weeks of calendar days
            for (let week = 0; week < 4; week++) {
                for (let day = 0; day < 7; day++) {
                    const currentDate = new Date(firstDay);
                    currentDate.setDate(firstDay.getDate() + (week * 7) + day);
                    
                    const dayElement = document.createElement('div');
                    dayElement.className = 'calendar-day';
                    dayElement.dataset.date = currentDate.toISOString().split('T')[0];
                    
                    const isToday = currentDate.toDateString() === today.toDateString();
                    const isPast = currentDate < today;
                    
                    dayElement.style.cssText = `
                        text-align: center;
                        padding: 12px 8px;
                        border-radius: 8px;
                        cursor: pointer;
                        border: 1px solid rgba(255,255,255,0.1);
                        transition: all 0.2s ease;
                        background: ${isPast ? 'rgba(255,255,255,0.05)' : 'rgba(255,255,255,0.08)'};
                        color: ${isPast ? '#666' : 'white'};
                        ${isToday ? 'border-color: #00ffff; background: rgba(0,255,255,0.1);' : ''}
                    `;
                    
                    dayElement.innerHTML = `
                        <div style="font-size: 14px; font-weight: bold;">${currentDate.getDate()}</div>
                        <div style="font-size: 10px; opacity: 0.7;">${currentDate.toLocaleDateString('en', {month: 'short'})}</div>
                    `;
                    
                    if (!isPast) {
                        dayElement.addEventListener('click', () => toggleCalendarDay(dayElement));
                    }
                    
                    calendar.appendChild(dayElement);
                }
            }
        }

        function toggleCalendarDay(dayElement) {
            const date = dayElement.dataset.date;
            const index = selectedCalendarDays.indexOf(date);
            
            if (index === -1) {
                selectedCalendarDays.push(date);
                dayElement.style.background = 'rgba(255,215,0,0.3)';
                dayElement.style.borderColor = '#ffd700';
                dayElement.style.transform = 'scale(1.05)';
            } else {
                selectedCalendarDays.splice(index, 1);
                dayElement.style.background = 'rgba(255,255,255,0.08)';
                dayElement.style.borderColor = 'rgba(255,255,255,0.1)';
                dayElement.style.transform = 'scale(1)';
            }
            
            updateScheduleButton();
        }

        function selectCalendarRange(range) {
            const today = new Date();
            clearCalendarSelection();
            
            if (range === 'thisWeek') {
                for (let i = 0; i < 7; i++) {
                    const date = new Date(today);
                    date.setDate(today.getDate() - today.getDay() + i);
                    if (date >= today) {
                        const dateStr = date.toISOString().split('T')[0];
                        selectedCalendarDays.push(dateStr);
                    }
                }
            } else if (range === 'nextWeek') {
                for (let i = 7; i < 14; i++) {
                    const date = new Date(today);
                    date.setDate(today.getDate() - today.getDay() + i);
                    const dateStr = date.toISOString().split('T')[0];
                    selectedCalendarDays.push(dateStr);
                }
            } else if (range === 'weekends') {
                for (let week = 0; week < 4; week++) {
                    // Saturday
                    const saturday = new Date(today);
                    saturday.setDate(today.getDate() - today.getDay() + 6 + (week * 7));
                    if (saturday >= today) {
                        selectedCalendarDays.push(saturday.toISOString().split('T')[0]);
                    }
                    
                    // Sunday
                    const sunday = new Date(today);
                    sunday.setDate(today.getDate() - today.getDay() + 7 + (week * 7));
                    if (sunday >= today) {
                        selectedCalendarDays.push(sunday.toISOString().split('T')[0]);
                    }
                }
            }
            
            updateCalendarSelection();
            updateScheduleButton();
        }

        function clearCalendarSelection() {
            selectedCalendarDays = [];
            updateCalendarSelection();
            updateScheduleButton();
        }

        function updateCalendarSelection() {
            document.querySelectorAll('.calendar-day').forEach(day => {
                const date = day.dataset.date;
                if (selectedCalendarDays.includes(date)) {
                    day.style.background = 'rgba(255,215,0,0.3)';
                    day.style.borderColor = '#ffd700';
                    day.style.transform = 'scale(1.05)';
                } else {
                    const isToday = new Date(date).toDateString() === new Date().toDateString();
                    day.style.background = isToday ? 'rgba(0,255,255,0.1)' : 'rgba(255,255,255,0.08)';
                    day.style.borderColor = isToday ? '#00ffff' : 'rgba(255,255,255,0.1)';
                    day.style.transform = 'scale(1)';
                }
            });
        }

        function updateScheduleButton() {
            const btn = document.getElementById('scheduleEmployeeBtn');
            if (selectedCalendarDays.length > 0 && selectedShiftTemplate) {
                btn.disabled = false;
                btn.style.opacity = '1';
                btn.textContent = `Schedule ${selectedCalendarDays.length} Day${selectedCalendarDays.length > 1 ? 's' : ''}`;
            } else {
                btn.disabled = true;
                btn.style.opacity = '0.5';
                btn.textContent = 'Select Days & Shift Template';
            }
        }

        function scheduleSelectedEmployee() {
            if (!selectedEmployee || selectedCalendarDays.length === 0 || !selectedShiftTemplate) {
                showNotification('Please select employee, days, and shift template', 'error');
                return;
            }

            const employeeName = selectedEmployee.name;
            const shiftName = selectedShiftTemplate.name;
            const dayCount = selectedCalendarDays.length;
            
            // Simulate scheduling (in real app, this would save to database)
            showNotification(`Successfully scheduled ${employeeName} for ${dayCount} day${dayCount > 1 ? 's' : ''} on ${shiftName}`, 'success');
            
            // Update employee status
            selectedEmployee.status = 'Scheduled';
            generateEmployeeCards();
            
            // Update stats
            const scheduledToday = document.getElementById('scheduledToday');
            scheduledToday.textContent = parseInt(scheduledToday.textContent) + 1;
            
            const weeklyHours = document.getElementById('weeklyHours');
            const hoursPerShift = calculateShiftHours(selectedShiftTemplate.start, selectedShiftTemplate.end);
            weeklyHours.textContent = parseInt(weeklyHours.textContent) + (dayCount * hoursPerShift);
            
            // Reset selections
            closeEmployeeScheduling();
        }

        function calculateShiftHours(startTime, endTime) {
            const start = new Date(`2000-01-01T${startTime}:00`);
            const end = new Date(`2000-01-01T${endTime}:00`);
            if (end < start) end.setDate(end.getDate() + 1); // Handle overnight shifts
            return (end - start) / (1000 * 60 * 60); // Convert to hours
        }

        function filterEmployees() {
            const search = document.getElementById('employeeSearch').value.toLowerCase();
            const roleFilter = document.getElementById('roleFilter').value;
            const statusFilter = document.getElementById('availabilityFilter').value;
            
            document.querySelectorAll('.employee-card').forEach(card => {
                const employeeId = parseInt(card.dataset.employeeId);
                const employee = employees.find(emp => emp.id === employeeId);
                
                const matchesSearch = employee.name.toLowerCase().includes(search);
                const matchesRole = !roleFilter || employee.role === roleFilter;
                const matchesStatus = !statusFilter || employee.status === statusFilter;
                
                if (matchesSearch && matchesRole && matchesStatus) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        function viewEmployeeDetails(employeeId) {
            const employee = employees.find(emp => emp.id === employeeId);
            showNotification(`Viewing details for ${employee.name}`, 'success');
            // In a real app, this would open a detailed modal
        }

        function viewEmployeeStats() {
            if (!selectedEmployee) return;
            showNotification(`Viewing stats for ${selectedEmployee.name}`, 'success');
            // In a real app, this would show detailed analytics
        }

        // Comprehensive Scheduling Calendar Functions
        let currentSchedulingWeek = new Date();
        let existingShifts = {
            // Sample existing shifts data for demonstration
            'monday': [
                { employee: 'Sarah Johnson', role: 'Manager', start: '06:00', end: '14:00', color: '#ff6b9d' },
                { employee: 'Morgan Casey', role: 'Cashier', start: '14:00', end: '22:00', color: '#10b981' }
            ],
            'tuesday': [
                { employee: 'Riley Thompson', role: 'Cashier', start: '09:00', end: '17:00', color: '#10b981' },
                { employee: 'Alex Rivera', role: 'Cashier', start: '17:00', end: '23:00', color: '#10b981' }
            ],
            'wednesday': [
                { employee: 'Jordan Kim', role: 'Cashier', start: '06:00', end: '14:00', color: '#10b981' },
                { employee: 'Sarah Johnson', role: 'Manager', start: '12:00', end: '20:00', color: '#ff6b9d' }
            ],
            'thursday': [
                { employee: 'Casey Morgan', role: 'Cashier', start: '08:00', end: '16:00', color: '#ffd700' },
                { employee: 'Morgan Casey', role: 'Cashier', start: '16:00', end: '24:00', color: '#10b981' }
            ],
            'friday': [
                { employee: 'Riley Thompson', role: 'Cashier', start: '10:00', end: '18:00', color: '#10b981' },
                { employee: 'Alex Rivera', role: 'Cashier', start: '18:00', end: '02:00', color: '#10b981' }
            ],
            'saturday': [
                { employee: 'Jordan Kim', role: 'Cashier', start: '09:00', end: '17:00', color: '#10b981' },
                { employee: 'Sarah Johnson', role: 'Manager', start: '15:00', end: '23:00', color: '#ff6b9d' }
            ],
            'sunday': [
                { employee: 'Casey Morgan', role: 'Cashier', start: '11:00', end: '19:00', color: '#ffd700' }
            ]
        };

        function generateFullScheduleCalendar() {
            const container = document.getElementById('scheduleTimeSlots');
            container.innerHTML = '';
            
            // Generate time slots from 6 AM to 11 PM (17 hours)
            const timeSlots = [];
            for (let hour = 6; hour <= 23; hour++) {
                timeSlots.push(formatHour(hour));
            }
            
            const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
            
            timeSlots.forEach(time => {
                // Time label
                const timeLabel = document.createElement('div');
                timeLabel.style.cssText = `
                    color: #94a3b8;
                    font-size: 11px;
                    text-align: center;
                    padding: 6px 4px;
                    border-bottom: 1px solid rgba(255,255,255,0.1);
                `;
                timeLabel.textContent = time;
                container.appendChild(timeLabel);
                
                // Day slots
                days.forEach(day => {
                    const slot = document.createElement('div');
                    slot.className = 'schedule-slot';
                    slot.dataset.day = day;
                    slot.dataset.time = time;
                    slot.style.cssText = `
                        border: 1px solid rgba(255,255,255,0.1);
                        border-radius: 4px;
                        min-height: 35px;
                        position: relative;
                        cursor: pointer;
                        transition: all 0.2s ease;
                    `;
                    
                    // Check for existing shifts
                    const dayShifts = existingShifts[day] || [];
                    const currentHour = parseInt(time.split(':')[0]) || parseInt(time.split('M')[0]);
                    const shift = dayShifts.find(s => {
                        const startHour = parseInt(s.start.split(':')[0]);
                        const endHour = parseInt(s.end.split(':')[0]);
                        return currentHour >= startHour && currentHour < endHour;
                    });
                    
                    if (shift) {
                        slot.style.background = `linear-gradient(135deg, ${shift.color}20, ${shift.color}40)`;
                        slot.style.border = `1px solid ${shift.color}`;
                        slot.innerHTML = `
                            <div style="font-size: 9px; color: ${shift.color}; font-weight: bold; padding: 2px;">${shift.employee.split(' ')[0]}</div>
                            <div style="font-size: 8px; color: #94a3b8; padding: 0 2px;">${shift.role}</div>
                        `;
                    }
                    
                    slot.addEventListener('click', () => selectScheduleSlot(day, time, shift));
                    slot.addEventListener('mouseenter', () => {
                        if (!shift) {
                            slot.style.background = 'rgba(0,255,255,0.1)';
                            slot.style.border = '1px solid rgba(0,255,255,0.5)';
                        }
                    });
                    slot.addEventListener('mouseleave', () => {
                        if (!shift) {
                            slot.style.background = 'transparent';
                            slot.style.border = '1px solid rgba(255,255,255,0.1)';
                        }
                    });
                    
                    container.appendChild(slot);
                });
            });
        }

        function generateCoverageAnalysis() {
            const container = document.getElementById('coverageChart');
            container.innerHTML = '';
            
            const days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
            const dayKeys = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
            
            days.forEach((day, index) => {
                const dayKey = dayKeys[index];
                const shifts = existingShifts[dayKey] || [];
                const coverage = calculateDayCoverage(shifts);
                
                const coverageCard = document.createElement('div');
                coverageCard.style.cssText = `
                    background: rgba(0,0,0,0.3);
                    border-radius: 8px;
                    padding: 12px;
                    text-align: center;
                `;
                
                const coverageLevel = coverage.total > 24 ? 'high' : coverage.total > 16 ? 'medium' : 'low';
                const coverageColor = coverageLevel === 'high' ? '#00ff88' : coverageLevel === 'medium' ? '#ffd700' : '#ff6b9d';
                
                coverageCard.innerHTML = `
                    <div style="color: #94a3b8; font-size: 12px; margin-bottom: 4px;">${day}</div>
                    <div style="color: ${coverageColor}; font-size: 18px; font-weight: bold;">${coverage.total}h</div>
                    <div style="color: #94a3b8; font-size: 10px;">${shifts.length} shifts</div>
                    <div style="margin-top: 4px; font-size: 9px; color: ${coverageColor};">${coverageLevel.toUpperCase()}</div>
                `;
                
                container.appendChild(coverageCard);
            });
        }

        function calculateDayCoverage(shifts) {
            let totalHours = 0;
            shifts.forEach(shift => {
                const start = parseInt(shift.start.split(':')[0]);
                const end = parseInt(shift.end.split(':')[0]);
                const hours = end > start ? end - start : (24 - start) + end;
                totalHours += hours;
            });
            return { total: totalHours, shifts: shifts.length };
        }

        function formatHour(hour) {
            if (hour === 0) return '12AM';
            if (hour < 12) return `${hour}AM`;
            if (hour === 12) return '12PM';
            return `${hour - 12}PM`;
        }

        function selectScheduleSlot(day, time, existingShift) {
            if (existingShift) {
                showShiftManagementOptions(day, time, existingShift);
            } else {
                if (selectedShiftTemplate && selectedEmployee) {
                    addShiftToSlot(day, time);
                } else {
                    showNotification('Select an employee and shift template first', 'warning');
                }
            }
        }

        function showShiftManagementOptions(day, time, shift) {
            const options = [
                `Edit ${shift.employee}'s shift`,
                `Replace ${shift.employee}`,
                `Swap with another shift`,
                `Remove this shift`
            ];
            
            showNotification(`Managing ${shift.employee}'s ${shift.role} shift on ${day.toUpperCase()}`, 'success');
        }

        function addShiftToSlot(day, time) {
            if (!selectedEmployee || !selectedShiftTemplate) return;
            
            const newShift = {
                employee: selectedEmployee.name,
                role: selectedEmployee.role,
                start: selectedShiftTemplate.start,
                end: selectedShiftTemplate.end,
                color: selectedEmployee.color
            };
            
            if (!existingShifts[day]) existingShifts[day] = [];
            existingShifts[day].push(newShift);
            
            showNotification(`Added ${selectedEmployee.name} to ${day.toUpperCase()} ${selectedShiftTemplate.name}`, 'success');
            generateFullScheduleCalendar();
            generateCoverageAnalysis();
        }

        function switchSchedulingView(view) {
            const shiftsBtn = document.getElementById('shiftsViewBtn');
            const coverageBtn = document.getElementById('coverageViewBtn');
            const shiftsView = document.getElementById('fullScheduleCalendar');
            const coverageView = document.getElementById('coverageAnalysis');
            
            if (view === 'shifts') {
                shiftsBtn.style.background = 'rgba(0,255,255,0.2)';
                shiftsBtn.style.borderColor = 'rgba(0,255,255,0.5)';
                shiftsBtn.style.color = '#00ffff';
                coverageBtn.style.background = 'rgba(255,255,255,0.1)';
                coverageBtn.style.borderColor = 'rgba(255,255,255,0.3)';
                coverageBtn.style.color = 'white';
                shiftsView.style.display = 'block';
                coverageView.style.display = 'none';
            } else {
                coverageBtn.style.background = 'rgba(255,215,0,0.2)';
                coverageBtn.style.borderColor = 'rgba(255,215,0,0.5)';
                coverageBtn.style.color = '#ffd700';
                shiftsBtn.style.background = 'rgba(255,255,255,0.1)';
                shiftsBtn.style.borderColor = 'rgba(255,255,255,0.3)';
                shiftsBtn.style.color = 'white';
                shiftsView.style.display = 'none';
                coverageView.style.display = 'block';
            }
        }

        function navigateSchedulingWeek(direction) {
            currentSchedulingWeek.setDate(currentSchedulingWeek.getDate() + (direction * 7));
            updateSchedulingWeekDisplay();
            generateFullScheduleCalendar();
        }

        function updateSchedulingWeekDisplay() {
            const start = new Date(currentSchedulingWeek);
            start.setDate(currentSchedulingWeek.getDate() - currentSchedulingWeek.getDay() + 1);
            const end = new Date(start);
            end.setDate(start.getDate() + 6);
            
            const formatDate = (date) => {
                return date.toLocaleDateString('en-US', { month: 'long', day: 'numeric' });
            };
            
            document.getElementById('schedulingWeekRange').textContent = 
                `${formatDate(start)} - ${formatDate(end)}, ${start.getFullYear()}`;
        }

        function addShiftToCalendar() {
            if (!selectedEmployee) {
                showNotification('Please select an employee first', 'warning');
                return;
            }
            if (!selectedShiftTemplate) {
                showNotification('Please select a shift template', 'warning');
                return;
            }
            showNotification('Click on any empty time slot to add the shift', 'info');
        }

        function replaceShift() {
            showNotification('Click on an existing shift to replace it with the selected employee', 'info');
        }

        function swapShifts() {
            showNotification('Shift swapping feature - click two shifts to swap employees', 'info');
        }

        function showCreateShiftTemplates() {
            // Show the comprehensive shift template and employee scheduling modal
            const modal = document.getElementById('comprehensiveSchedulingModal');
            if (modal) {
                modal.style.display = 'block';
                
                // Initialize all modal components
                generateEmployeeSelectionGrid();
                generateShiftTemplateSelection();
                generateMultiDayCalendar();
                updateBulkScheduleButton();
                generateShiftTemplateSelection();
                generateEmployeeSelectionGrid();
            } else {
                // Fallback to existing template modal
                document.getElementById('shiftTemplateModal').style.display = 'block';
            }
        }

        function closeShiftTemplateModal() {
            document.getElementById('shiftTemplateModal').style.display = 'none';
            // Reset form
            document.getElementById('templateName').value = '';
            document.getElementById('templateStartTime').value = '';
            document.getElementById('templateEndTime').value = '';
            document.getElementById('templateDescription').value = '';
            document.getElementById('selectedTemplateColor').value = '#ffd700';
            
            // Reset color selection
            document.querySelectorAll('.color-option').forEach(btn => {
                btn.style.borderColor = 'rgba(255,255,255,0.2)';
                btn.style.transform = 'scale(1)';
            });
        }

        function selectTemplateColor(color) {
            document.getElementById('selectedTemplateColor').value = color;
            
            // Update visual selection
            document.querySelectorAll('.color-option').forEach(btn => {
                if (btn.dataset.color === color) {
                    btn.style.borderColor = '#ffffff';
                    btn.style.transform = 'scale(1.1)';
                } else {
                    btn.style.borderColor = 'rgba(255,255,255,0.2)';
                    btn.style.transform = 'scale(1)';
                }
            });
        }

        function createShiftTemplate(event) {
            event.preventDefault();
            
            const name = document.getElementById('templateName').value;
            const startTime = document.getElementById('templateStartTime').value;
            const endTime = document.getElementById('templateEndTime').value;
            const color = document.getElementById('selectedTemplateColor').value;
            const description = document.getElementById('templateDescription').value;
            
            // Create new shift template button
            const templatesContainer = document.getElementById('shiftTemplates');
            const newTemplate = document.createElement('button');
            newTemplate.className = 'shift-template';
            newTemplate.dataset.start = startTime;
            newTemplate.dataset.end = endTime;
            newTemplate.onclick = () => selectShiftTemplate(newTemplate);
            
            const startFormatted = formatTime(startTime);
            const endFormatted = formatTime(endTime);
            
            newTemplate.style.cssText = `
                background: rgba(${hexToRgb(color)}, 0.2);
                border: 1px solid rgba(${hexToRgb(color)}, 0.5);
                color: ${color};
                padding: 8px 16px;
                border-radius: 6px;
                cursor: pointer;
                font-size: 12px;
            `;
            
            newTemplate.innerHTML = `${name}<br><small>${startFormatted} - ${endFormatted}</small>`;
            
            // Insert before the "Custom Times" button
            const customButton = templatesContainer.lastElementChild;
            templatesContainer.insertBefore(newTemplate, customButton);
            
            closeShiftTemplateModal();
            showNotification(`Created new shift template: ${name}`, 'success');
        }

        function formatTime(time24) {
            const [hours, minutes] = time24.split(':');
            const hour = parseInt(hours);
            const ampm = hour >= 12 ? 'PM' : 'AM';
            const hour12 = hour % 12 || 12;
            return `${hour12}:${minutes} ${ampm}`;
        }

        function hexToRgb(hex) {
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            return `${r}, ${g}, ${b}`;
        }

        // Comprehensive Scheduling Modal Functions
        let modalSelectedEmployees = [];
        let modalSelectedShift = null;
        let modalSelectedDays = [];

        function closeComprehensiveSchedulingModal() {
            document.getElementById('comprehensiveSchedulingModal').style.display = 'none';
            
            // Reset all selections
            modalSelectedEmployees = [];
            modalSelectedShift = null;
            modalSelectedDays = [];
            
            // Reset visual states
            updateModalEmployeeSelection();
            updateModalShiftSelection();
            updateModalCalendarSelection();
            updateBulkScheduleButton();
        }

        function generateEmployeeSelectionGrid() {
            // Get existing employees from localStorage or use defaults
            let modalEmployees = JSON.parse(localStorage.getItem('marketpace_employees') || '[]');
            
            if (modalEmployees.length === 0) {
                // Default employees
                modalEmployees = [
                    { id: 1, name: 'Sarah Johnson', role: 'Manager', status: 'Available', avatar: 'S', color: '#8B4513' },
                    { id: 2, name: 'Mike Chen', role: 'Cashier', status: 'Available', avatar: 'M', color: '#228B22' },
                    { id: 3, name: 'Jessica Martinez', role: 'Sales', status: 'Scheduled', avatar: 'J', color: '#FF8C00' },
                    { id: 4, name: 'David Wilson', role: 'Stock', status: 'Available', avatar: 'D', color: '#4682B4' },
                    { id: 5, name: 'Emma Davis', role: 'Assistant', status: 'Off', avatar: 'E', color: '#9370DB' },
                    { id: 6, name: 'Carlos Rodriguez', role: 'Security', status: 'Available', avatar: 'C', color: '#DC143C' }
            ];

            const grid = document.getElementById('modalEmployeeGrid');
            grid.innerHTML = '';

            modalEmployees.forEach(employee => {
                const card = document.createElement('div');
                card.className = 'modal-employee-card';
                card.dataset.employeeId = employee.id;
                card.dataset.role = employee.role;
                card.dataset.status = employee.status;
                
                const isSelected = modalSelectedEmployees.some(emp => emp.id === employee.id);
                
                card.style.cssText = `
                    background: ${isSelected ? 'rgba(255,215,0,0.2)' : 'rgba(255,255,255,0.1)'};
                    border: 2px solid ${isSelected ? '#ffd700' : 'rgba(255,255,255,0.2)'};
                    border-radius: 12px;
                    padding: 16px;
                    cursor: pointer;
                    transition: all 0.3s ease;
                    transform: ${isSelected ? 'translateY(-2px)' : 'translateY(0)'};
                `;

                let statusColor = '#00ff88'; // Available
                if (employee.status === 'Scheduled') statusColor = '#ffd700';
                if (employee.status === 'Off') statusColor = '#ff6b9d';

                card.innerHTML = `
                    <div style="display: flex; align-items: center; margin-bottom: 12px;">
                        <div style="width: 40px; height: 40px; border-radius: 50%; background: ${employee.color}; display: flex; align-items: center; justify-content: center; font-weight: bold; color: white; margin-right: 12px;">${employee.avatar}</div>
                        <div style="flex: 1;">
                            <div style="font-weight: bold; color: white; font-size: 14px;">${employee.name}</div>
                            <div style="color: #94a3b8; font-size: 12px;">${employee.role}</div>
                        </div>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="color: ${statusColor}; font-size: 12px; font-weight: bold;">${employee.status}</span>
                        ${isSelected ? '<span style="color: #ffd700; font-size: 12px;">✓ Selected</span>' : ''}
                    </div>
                `;

                card.onclick = function() {
                    toggleModalEmployeeSelection(employee);
                };

                card.onmouseenter = function() {
                    if (!isSelected) {
                        this.style.background = 'rgba(255,255,255,0.15)';
                        this.style.borderColor = '#00ffff';
                        this.style.transform = 'translateY(-2px)';
                    }
                };

                card.onmouseleave = function() {
                    if (!isSelected) {
                        this.style.background = 'rgba(255,255,255,0.1)';
                        this.style.borderColor = 'rgba(255,255,255,0.2)';
                        this.style.transform = 'translateY(0)';
                    }
                };

                grid.appendChild(card);
            });
        }

        function toggleModalEmployeeSelection(employee) {
            const index = modalSelectedEmployees.findIndex(emp => emp.id === employee.id);
            
            if (index === -1) {
                // Add employee
                modalSelectedEmployees.push(employee);
            } else {
                // Remove employee
                modalSelectedEmployees.splice(index, 1);
            }
            
            updateModalEmployeeSelection();
            updateBulkScheduleButton();
            showNotification(`${employee.name} ${index === -1 ? 'added to' : 'removed from'} selection`, 'success');
        }

        function updateModalEmployeeSelection() {
            // Update employee cards
            const cards = document.querySelectorAll('.modal-employee-card');
            cards.forEach(card => {
                const employeeId = parseInt(card.dataset.employeeId);
                const isSelected = modalSelectedEmployees.some(emp => emp.id === employeeId);
                
                if (isSelected) {
                    card.style.background = 'rgba(255,215,0,0.2)';
                    card.style.borderColor = '#ffd700';
                    card.style.transform = 'translateY(-2px)';
                    card.querySelector('div:last-child').innerHTML = card.querySelector('div:last-child').innerHTML.replace('✓ Selected', '') + '<span style="color: #ffd700; font-size: 12px;">✓ Selected</span>';
                } else {
                    card.style.background = 'rgba(255,255,255,0.1)';
                    card.style.borderColor = 'rgba(255,255,255,0.2)';
                    card.style.transform = 'translateY(0)';
                    card.querySelector('div:last-child').innerHTML = card.querySelector('div:last-child').innerHTML.replace('<span style="color: #ffd700; font-size: 12px;">✓ Selected</span>', '');
                }
            });

            // Update selected employees list
            const selectedList = document.getElementById('selectedEmployeesList');
            const selectedCount = document.getElementById('selectedEmployeeCount');
            
            selectedCount.textContent = modalSelectedEmployees.length;
            
            if (modalSelectedEmployees.length === 0) {
                selectedList.innerHTML = '<span style="color: #94a3b8; font-style: italic;">No employees selected</span>';
            } else {
                selectedList.innerHTML = modalSelectedEmployees.map(emp => 
                    `<span style="background: rgba(255,215,0,0.2); border: 1px solid #ffd700; color: #ffd700; padding: 4px 8px; border-radius: 6px; font-size: 12px; display: flex; align-items: center; gap: 6px;">
                        <span style="width: 16px; height: 16px; border-radius: 50%; background: ${emp.color}; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: bold; color: white;">${emp.avatar}</span>
                        ${emp.name}
                        <button onclick="removeModalEmployee(${emp.id})" style="background: none; border: none; color: #ff6b9d; cursor: pointer; font-size: 12px; padding: 0;">✕</button>
                    </span>`
                ).join('');
            }
        }

        function removeModalEmployee(employeeId) {
            modalSelectedEmployees = modalSelectedEmployees.filter(emp => emp.id !== employeeId);
            updateModalEmployeeSelection();
            updateBulkScheduleButton();
        }

        function filterModalEmployees() {
            const searchTerm = document.getElementById('modalEmployeeSearch').value.toLowerCase();
            const roleFilter = document.getElementById('modalRoleFilter').value;
            
            const cards = document.querySelectorAll('.modal-employee-card');
            cards.forEach(card => {
                const employeeName = card.querySelector('div:first-child div:nth-child(2) div:first-child').textContent.toLowerCase();
                const employeeRole = card.dataset.role;
                
                const matchesSearch = employeeName.includes(searchTerm);
                const matchesRole = !roleFilter || employeeRole === roleFilter;
                
                if (matchesSearch && matchesRole) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        function generateShiftTemplateSelection() {
            // Reset shift selection
            modalSelectedShift = null;
            updateModalShiftSelection();
        }

        function selectModalShiftTemplate(button) {
            modalSelectedShift = {
                start: button.dataset.start,
                end: button.dataset.end,
                name: button.textContent.split('\n')[0].trim()
            };
            updateModalShiftSelection();
            updateBulkScheduleButton();
            showNotification(`Selected ${modalSelectedShift.name} shift template`, 'success');
        }

        function updateCustomShiftTemplate() {
            const startTime = document.getElementById('modalCustomStartTime').value;
            const endTime = document.getElementById('modalCustomEndTime').value;
            
            if (startTime && endTime) {
                modalSelectedShift = {
                    start: startTime,
                    end: endTime,
                    name: 'Custom Shift'
                };
                
                // Clear preset selections
                document.querySelectorAll('.modal-shift-template').forEach(btn => {
                    btn.style.background = btn.style.background.replace('0.4', '0.2');
                    btn.style.transform = 'scale(1)';
                });
                
                updateModalShiftSelection();
                updateBulkScheduleButton();
                showNotification('Custom shift template created', 'success');
            }
        }

        function updateModalShiftSelection() {
            // Update shift template buttons
            document.querySelectorAll('.modal-shift-template').forEach(btn => {
                if (modalSelectedShift && btn.dataset.start === modalSelectedShift.start && btn.dataset.end === modalSelectedShift.end) {
                    btn.style.background = btn.style.background.replace('0.2', '0.4');
                    btn.style.transform = 'scale(1.05)';
                } else {
                    btn.style.background = btn.style.background.replace('0.4', '0.2');
                    btn.style.transform = 'scale(1)';
                }
            });

            // Update selected shift display
            const shiftDisplay = document.getElementById('selectedShiftDisplay');
            if (modalSelectedShift) {
                const startFormatted = formatTime24To12(modalSelectedShift.start);
                const endFormatted = formatTime24To12(modalSelectedShift.end);
                shiftDisplay.innerHTML = `<span style="color: #00ffff; font-weight: bold;">${modalSelectedShift.name}</span><br><small style="color: #94a3b8;">${startFormatted} - ${endFormatted}</small>`;
            } else {
                shiftDisplay.innerHTML = '<span style="color: #94a3b8; font-style: italic;">No shift template selected</span>';
            }
        }

        function formatTime24To12(time24) {
            const [hours, minutes] = time24.split(':');
            const hour = parseInt(hours);
            const ampm = hour >= 12 ? 'PM' : 'AM';
            const hour12 = hour % 12 || 12;
            return `${hour12}:${minutes} ${ampm}`;
        }

        function generateMultiDayCalendar() {
            const calendar = document.getElementById('multiDayCalendar');
            calendar.innerHTML = '';
            
            const today = new Date();
            const firstDay = new Date(today);
            firstDay.setDate(today.getDate() - today.getDay()); // Start of current week

            // Day headers
            const dayHeaders = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            dayHeaders.forEach(day => {
                const header = document.createElement('div');
                header.style.cssText = 'text-align: center; color: #94a3b8; font-weight: bold; padding: 8px; font-size: 14px; border-bottom: 1px solid rgba(255,255,255,0.1);';
                header.textContent = day;
                calendar.appendChild(header);
            });

            // Generate 4 weeks of calendar days
            for (let week = 0; week < 4; week++) {
                for (let day = 0; day < 7; day++) {
                    const currentDate = new Date(firstDay);
                    currentDate.setDate(firstDay.getDate() + (week * 7) + day);
                    
                    const dayElement = document.createElement('div');
                    dayElement.className = 'modal-calendar-day';
                    dayElement.dataset.date = currentDate.toISOString().split('T')[0];
                    
                    const isToday = currentDate.toDateString() === today.toDateString();
                    const isPast = currentDate < today;
                    const isSelected = modalSelectedDays.includes(dayElement.dataset.date);
                    
                    dayElement.style.cssText = `
                        text-align: center;
                        padding: 16px 8px;
                        border-radius: 8px;
                        cursor: ${isPast ? 'not-allowed' : 'pointer'};
                        border: 2px solid ${isSelected ? '#ffd700' : (isToday ? '#00ffff' : 'rgba(255,255,255,0.1)')};
                        transition: all 0.3s ease;
                        background: ${isSelected ? 'rgba(255,215,0,0.3)' : (isPast ? 'rgba(255,255,255,0.05)' : (isToday ? 'rgba(0,255,255,0.1)' : 'rgba(255,255,255,0.08)'))};
                        color: ${isPast ? '#666' : 'white'};
                        opacity: ${isPast ? '0.5' : '1'};
                        transform: ${isSelected ? 'scale(1.05)' : 'scale(1)'};
                    `;
                    
                    dayElement.innerHTML = `
                        <div style="font-size: 18px; font-weight: bold; margin-bottom: 4px;">${currentDate.getDate()}</div>
                        <div style="font-size: 12px; opacity: 0.8;">${currentDate.toLocaleDateString('en', {month: 'short'})}</div>
                        ${isSelected ? '<div style="color: #ffd700; font-size: 10px; margin-top: 4px;">✓ SELECTED</div>' : ''}
                    `;
                    
                    if (!isPast) {
                        dayElement.addEventListener('click', () => toggleModalCalendarDay(dayElement));
                        dayElement.addEventListener('mouseenter', () => {
                            if (!isSelected) {
                                dayElement.style.background = 'rgba(0,255,255,0.2)';
                                dayElement.style.borderColor = '#00ffff';
                                dayElement.style.transform = 'scale(1.05)';
                            }
                        });
                        dayElement.addEventListener('mouseleave', () => {
                            if (!isSelected) {
                                dayElement.style.background = isToday ? 'rgba(0,255,255,0.1)' : 'rgba(255,255,255,0.08)';
                                dayElement.style.borderColor = isToday ? '#00ffff' : 'rgba(255,255,255,0.1)';
                                dayElement.style.transform = 'scale(1)';
                            }
                        });
                    }
                    
                    calendar.appendChild(dayElement);
                }
            }
        }

        function toggleModalCalendarDay(dayElement) {
            const date = dayElement.dataset.date;
            const index = modalSelectedDays.indexOf(date);
            
            if (index === -1) {
                modalSelectedDays.push(date);
            } else {
                modalSelectedDays.splice(index, 1);
            }
            
            updateModalCalendarSelection();
            updateBulkScheduleButton();
        }

        function selectModalCalendarRange(range) {
            const today = new Date();
            modalSelectedDays = [];
            
            if (range === 'thisWeek') {
                for (let i = 0; i < 7; i++) {
                    const date = new Date(today);
                    date.setDate(today.getDate() - today.getDay() + i);
                    if (date >= today) {
                        modalSelectedDays.push(date.toISOString().split('T')[0]);
                    }
                }
            } else if (range === 'nextWeek') {
                for (let i = 7; i < 14; i++) {
                    const date = new Date(today);
                    date.setDate(today.getDate() - today.getDay() + i);
                    modalSelectedDays.push(date.toISOString().split('T')[0]);
                }
            } else if (range === 'weekends') {
                for (let week = 0; week < 4; week++) {
                    // Saturday
                    const saturday = new Date(today);
                    saturday.setDate(today.getDate() - today.getDay() + 6 + (week * 7));
                    if (saturday >= today) {
                        modalSelectedDays.push(saturday.toISOString().split('T')[0]);
                    }
                    
                    // Sunday
                    const sunday = new Date(today);
                    sunday.setDate(today.getDate() - today.getDay() + 7 + (week * 7));
                    if (sunday >= today) {
                        modalSelectedDays.push(sunday.toISOString().split('T')[0]);
                    }
                }
            }
            
            updateModalCalendarSelection();
            updateBulkScheduleButton();
            showNotification(`Selected ${modalSelectedDays.length} days for ${range}`, 'success');
        }

        function clearModalCalendarSelection() {
            modalSelectedDays = [];
            updateModalCalendarSelection();
            updateBulkScheduleButton();
            showNotification('Calendar selection cleared', 'success');
        }

        function updateModalCalendarSelection() {
            // Update calendar days
            const calendarDays = document.querySelectorAll('.modal-calendar-day');
            calendarDays.forEach(day => {
                const date = day.dataset.date;
                const isSelected = modalSelectedDays.includes(date);
                const isToday = new Date(date).toDateString() === new Date().toDateString();
                
                if (isSelected) {
                    day.style.background = 'rgba(255,215,0,0.3)';
                    day.style.borderColor = '#ffd700';
                    day.style.transform = 'scale(1.05)';
                    if (!day.innerHTML.includes('✓ SELECTED')) {
                        day.innerHTML += '<div style="color: #ffd700; font-size: 10px; margin-top: 4px;">✓ SELECTED</div>';
                    }
                } else {
                    day.style.background = isToday ? 'rgba(0,255,255,0.1)' : 'rgba(255,255,255,0.08)';
                    day.style.borderColor = isToday ? '#00ffff' : 'rgba(255,255,255,0.1)';
                    day.style.transform = 'scale(1)';
                    day.innerHTML = day.innerHTML.replace('<div style="color: #ffd700; font-size: 10px; margin-top: 4px;">✓ SELECTED</div>', '');
                }
            });

            // Update selected days list
            const selectedDaysList = document.getElementById('selectedDaysList');
            const selectedDaysCount = document.getElementById('selectedDaysCount');
            
            selectedDaysCount.textContent = modalSelectedDays.length;
            
            if (modalSelectedDays.length === 0) {
                selectedDaysList.innerHTML = '<span style="color: #94a3b8; font-style: italic;">No days selected</span>';
            } else {
                selectedDaysList.innerHTML = modalSelectedDays.map(dateStr => {
                    const date = new Date(dateStr);
                    const dayName = date.toLocaleDateString('en', { weekday: 'short' });
                    const dateFormatted = date.toLocaleDateString('en', { month: 'short', day: 'numeric' });
                    return `<span style="background: rgba(138,43,226,0.2); border: 1px solid #8a2be2; color: #8a2be2; padding: 6px 12px; border-radius: 6px; font-size: 12px; font-weight: bold;">
                        ${dayName}, ${dateFormatted}
                        <button onclick="removeModalDay('${dateStr}')" style="background: none; border: none; color: #ff6b9d; cursor: pointer; font-size: 12px; padding: 0; margin-left: 6px;">✕</button>
                    </span>`;
                }).join('');
            }
        }

        function removeModalDay(dateStr) {
            modalSelectedDays = modalSelectedDays.filter(date => date !== dateStr);
            updateModalCalendarSelection();
            updateBulkScheduleButton();
        }

        function updateBulkScheduleButton() {
            const btn = document.getElementById('bulkScheduleBtn');
            const canSchedule = modalSelectedEmployees.length > 0 && modalSelectedShift && modalSelectedDays.length > 0;
            
            if (canSchedule) {
                btn.disabled = false;
                btn.style.opacity = '1';
                btn.textContent = `Schedule ${modalSelectedEmployees.length} Employee${modalSelectedEmployees.length > 1 ? 's' : ''} for ${modalSelectedDays.length} Day${modalSelectedDays.length > 1 ? 's' : ''}`;
            } else {
                btn.disabled = true;
                btn.style.opacity = '0.5';
                btn.textContent = 'Complete All Steps to Schedule';
            }
        }

        function executeBulkScheduling() {
            if (!modalSelectedEmployees.length || !modalSelectedShift || !modalSelectedDays.length) {
                showNotification('Please complete all steps before scheduling', 'error');
                return;
            }

            // Use selected custom title or default shift name
            const scheduleTitle = selectedCustomTitle ? selectedCustomTitle.name : modalSelectedShift.name;
            const titleColor = selectedCustomTitle ? selectedCustomTitle.color : '#ffd700';

            const employeeNames = modalSelectedEmployees.map(emp => emp.name).join(', ');
            const shiftInfo = `${modalSelectedShift.name} (${formatTime24To12(modalSelectedShift.start)} - ${formatTime24To12(modalSelectedShift.end)})`;
            const dayCount = modalSelectedDays.length;
            const totalSchedules = modalSelectedEmployees.length * modalSelectedDays.length;

            // Create schedule entries for each employee on each selected day
            const scheduleEntries = [];
            modalSelectedEmployees.forEach(employee => {
                modalSelectedDays.forEach(date => {
                    const scheduleEntry = {
                        employeeId: employee.id,
                        employeeName: employee.name,
                        date: date,
                        startTime: modalSelectedShift.start,
                        endTime: modalSelectedShift.end,
                        shiftName: modalSelectedShift.name,
                        scheduleTitle: scheduleTitle,
                        titleColor: titleColor,
                        customTitleId: selectedCustomTitle ? selectedCustomTitle.id : null,
                        positionCategory: employee.positionCategory || 'Employee',
                        created: new Date().toISOString()
                    };
                    scheduleEntries.push(scheduleEntry);
                });
            });

            // Save to localStorage (in a real app, this would go to a server)
            let existingSchedules = JSON.parse(localStorage.getItem('marketpace_schedules') || '[]');
            existingSchedules.push(...scheduleEntries);
            localStorage.setItem('marketpace_schedules', JSON.stringify(existingSchedules));

            // Show success notification
            const titleNotification = selectedCustomTitle ? ` with title "${scheduleTitle}"` : '';
            showNotification(`Successfully scheduled ${modalSelectedEmployees.length} employee${modalSelectedEmployees.length > 1 ? 's' : ''} for ${dayCount} day${dayCount > 1 ? 's' : ''} (${totalSchedules} total shifts)${titleNotification}`, 'success');

            // Update voice console with detailed information
            updateVoiceConsole(`🎯 BULK SCHEDULING COMPLETED
📋 Employees: ${employeeNames}
⏰ Shift: ${shiftInfo}
${selectedCustomTitle ? `📝 Custom Title: ${scheduleTitle}` : ''}
📅 Days: ${dayCount} selected
✅ Total Shifts Created: ${totalSchedules}
💡 All shifts have been added to the main schedule`);

            // Simulate updating the main schedule (in real app, this would save to database)
            console.log('Bulk scheduling executed:', {
                employees: modalSelectedEmployees,
                shift: modalSelectedShift,
                days: modalSelectedDays,
                totalSchedules: totalSchedules
            });

            // Close modal
            closeComprehensiveSchedulingModal();
        }

        function showAddEmployeeModal() {
            document.getElementById('addEmployeeModal').style.display = 'flex';
            populateRoleDropdown(); // Ensure latest custom roles are loaded
            document.getElementById('newEmployeeName').focus();
        }

        function closeAddEmployeeModal() {
            document.getElementById('addEmployeeModal').style.display = 'none';
            document.getElementById('addEmployeeForm').reset();
        }

        function populateRoleDropdown() {
            const roleSelect = document.getElementById('newEmployeeRole');
            if (!roleSelect) return;
            
            const customRoles = JSON.parse(localStorage.getItem('marketpace_custom_roles') || '[]');
            
            // Clear existing custom options
            const existingCustomOptions = roleSelect.querySelectorAll('.custom-role-option');
            existingCustomOptions.forEach(option => option.remove());
            
            // Add custom roles
            customRoles.forEach(role => {
                const option = document.createElement('option');
                option.value = role.name;
                option.textContent = role.name;
                option.className = 'custom-role-option';
                option.dataset.color = role.color;
                roleSelect.appendChild(option);
            });
        }

        function addNewEmployee(event) {
            event.preventDefault();
            
            const name = document.getElementById('newEmployeeName').value.trim();
            const role = document.getElementById('newEmployeeRole').value;
            const category = document.getElementById('newEmployeeCategory').value;
            const email = document.getElementById('newEmployeeEmail').value.trim();
            const phone = document.getElementById('newEmployeePhone').value.trim();
            
            if (!name || !role || !category) {
                showNotification('Please fill in all required fields', 'error');
                return;
            }

            // Get role color
            const customRoles = JSON.parse(localStorage.getItem('marketpace_custom_roles') || '[]');
            const customRole = customRoles.find(r => r.name === role);
            
            let roleColor = '#228B22'; // Default color
            if (customRole) {
                roleColor = customRole.color;
            } else {
                // Default role colors
                const defaultColors = {
                    'Manager': '#8B4513',
                    'Cashier': '#228B22',
                    'Sales': '#FF8C00',
                    'Stock': '#4682B4',
                    'Assistant': '#9370DB',
                    'Security': '#DC143C'
                };
                roleColor = defaultColors[role] || '#228B22';
            }

            // Create new employee
            const newEmployee = {
                id: Date.now(),
                name: name,
                role: role,
                positionCategory: category,
                status: 'Available',
                avatar: name.charAt(0).toUpperCase(),
                color: roleColor,
                email: email,
                phone: phone,
                created: new Date().toISOString()
            };

            // Add to storage
            let employees = JSON.parse(localStorage.getItem('marketpace_employees') || '[]');
            employees.push(newEmployee);
            localStorage.setItem('marketpace_employees', JSON.stringify(employees));

            // Refresh displays
            generateEmployeeSelectionGrid();
            initializeSmartEmployeeManagement();
            
            // Close modal and show success
            closeAddEmployeeModal();
            showNotification(`Employee "${name}" added successfully as ${role}`, 'success');
        }

        function createTestEmployee() {
            console.log('Opening Add Employee Modal');
            
            // Create modal HTML
            const modalHTML = `
                <div id="addEmployeeModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10000; display: flex; align-items: center; justify-content: center;">
                    <div style="background: linear-gradient(135deg, #1a1a2e 0%, #2d1b69 100%); border: 2px solid #00ffff; border-radius: 16px; padding: 32px; width: 90%; max-width: 500px; color: white;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                            <h2 id="modalTitle" style="color: #00ffff; margin: 0; font-size: 24px;">Add New Team Member</h2>
                            <button onclick="closeAddEmployeeModal()" style="background: transparent; border: none; color: #00ffff; font-size: 24px; cursor: pointer; padding: 0; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center;">×</button>
                        </div>
                        
                        <form id="addEmployeeForm" onsubmit="submitNewEmployee(event)">
                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; color: #e2e8f0; font-weight: 500;">Position Category</label>
                                <select id="positionCategory" required onchange="updateModalTitle(); togglePaymentVisibility();" style="width: 100%; padding: 12px; border: 2px solid rgba(255,215,0,0.4); border-radius: 8px; background: rgba(0,0,0,0.3); color: white; font-size: 16px;">
                                    <option value="">Select Category</option>
                                    <option value="employee">Employee (W-2 Worker)</option>
                                    <option value="volunteer">Volunteer (Unpaid Helper)</option>
                                    <option value="independent_contractor">Independent Contractor (1099 Worker)</option>
                                </select>
                                <div style="margin-top: 8px; padding: 8px; border-radius: 6px; background: rgba(255,215,0,0.1); border: 1px solid rgba(255,215,0,0.3);">
                                    <span style="color: #ffd700; font-size: 12px; font-weight: 500;">💡 This determines how they appear in schedules and tax classification</span>
                                </div>
                            </div>
                            
                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; color: #e2e8f0; font-weight: 500;">Full Name</label>
                                <input type="text" id="employeeName" required style="width: 100%; padding: 12px; border: 2px solid rgba(0,255,255,0.3); border-radius: 8px; background: rgba(0,0,0,0.3); color: white; font-size: 16px;" placeholder="Enter name">
                            </div>
                            
                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; color: #e2e8f0; font-weight: 500;">Role</label>
                                <select id="employeeRole" required style="width: 100%; padding: 12px; border: 2px solid rgba(0,255,255,0.3); border-radius: 8px; background: rgba(0,0,0,0.3); color: white; font-size: 16px;">
                                    <option value="">Select Role</option>
                                    <option value="Manager">Manager</option>
                                    <option value="Cashier">Cashier</option>
                                    <option value="Sales">Sales Associate</option>
                                    <option value="Stock">Stock Clerk</option>
                                    <option value="Assistant">Assistant</option>
                                    <option value="Security">Security</option>
                                </select>
                            </div>
                            
                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; color: #e2e8f0; font-weight: 500;">Email Address</label>
                                <input type="email" id="employeeEmail" required style="width: 100%; padding: 12px; border: 2px solid rgba(0,255,255,0.3); border-radius: 8px; background: rgba(0,0,0,0.3); color: white; font-size: 16px;" placeholder="employee@example.com">
                            </div>
                            
                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; color: #e2e8f0; font-weight: 500;">Phone Number</label>
                                <input type="tel" id="employeePhone" required style="width: 100%; padding: 12px; border: 2px solid rgba(0,255,255,0.3); border-radius: 8px; background: rgba(0,0,0,0.3); color: white; font-size: 16px;" placeholder="(555) 123-4567">
                            </div>
                            
                            <div id="paymentTypeSection" style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; color: #e2e8f0; font-weight: 500;">Payment Type</label>
                                <select id="paymentType" onchange="togglePaymentFields()" style="width: 100%; padding: 12px; border: 2px solid rgba(0,255,255,0.3); border-radius: 8px; background: rgba(0,0,0,0.3); color: white; font-size: 16px;">
                                    <option value="">Select Payment Type</option>
                                    <option value="hourly">Hourly Rate</option>
                                    <option value="per_job">Per Job Base Pay</option>
                                </select>
                            </div>
                            
                            <div id="hourlyRateField" style="margin-bottom: 20px; display: none;">
                                <label style="display: block; margin-bottom: 8px; color: #e2e8f0; font-weight: 500;">Hourly Rate ($)</label>
                                <input type="number" id="employeeHourlyRate" min="7.25" step="0.25" style="width: 100%; padding: 12px; border: 2px solid rgba(0,255,255,0.3); border-radius: 8px; background: rgba(0,0,0,0.3); color: white; font-size: 16px;" placeholder="15.00">
                            </div>
                            
                            <div id="perJobField" style="margin-bottom: 20px; display: none;">
                                <label style="display: block; margin-bottom: 8px; color: #e2e8f0; font-weight: 500;">Per Job Base Pay ($)</label>
                                <input type="number" id="employeeJobPay" min="10.00" step="5.00" style="width: 100%; padding: 12px; border: 2px solid rgba(0,255,255,0.3); border-radius: 8px; background: rgba(0,0,0,0.3); color: white; font-size: 16px;" placeholder="50.00">
                            </div>
                            
                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; color: #e2e8f0; font-weight: 500;">Status</label>
                                <select id="employeeStatus" required style="width: 100%; padding: 12px; border: 2px solid rgba(0,255,255,0.3); border-radius: 8px; background: rgba(0,0,0,0.3); color: white; font-size: 16px;">
                                    <option value="Available">Available</option>
                                    <option value="Scheduled">Scheduled</option>
                                    <option value="Off">Off Duty</option>
                                </select>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 12px; margin-top: 32px;">
                                <button type="button" onclick="closeAddEmployeeModal()" style="background: rgba(255,255,255,0.1); border: 2px solid rgba(255,255,255,0.3); color: white; padding: 12px; border-radius: 8px; cursor: pointer; font-weight: bold;">Cancel</button>
                                <button type="button" id="submitButton" onclick="submitNewEmployee(event)" style="background: linear-gradient(135deg, #00ffff, #0066ff); border: none; color: white; padding: 12px; border-radius: 8px; cursor: pointer; font-weight: bold;">Add Team Member</button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
        }
        
        function closeAddEmployeeModal() {
            const modal = document.getElementById('addEmployeeModal');
            if (modal) {
                modal.remove();
            }
        }
        
        function updateModalTitle() {
            const category = document.getElementById('positionCategory').value;
            const titleElement = document.getElementById('modalTitle');
            const submitButton = document.getElementById('submitButton');
            
            switch(category) {
                case 'employee':
                    titleElement.textContent = 'Add New Employee';
                    titleElement.style.color = '#00ffff';
                    if (submitButton) submitButton.textContent = 'Add Employee';
                    break;
                case 'volunteer':
                    titleElement.textContent = 'Add New Volunteer';
                    titleElement.style.color = '#ffd700';
                    if (submitButton) submitButton.textContent = 'Add Volunteer';
                    break;
                case 'independent_contractor':
                    titleElement.textContent = 'Add New Independent Contractor';
                    titleElement.style.color = '#ff6b9d';
                    if (submitButton) submitButton.textContent = 'Add Contractor';
                    break;
                default:
                    titleElement.textContent = 'Add New Team Member';
                    titleElement.style.color = '#00ffff';
                    if (submitButton) submitButton.textContent = 'Add Team Member';
            }
        }

        function togglePaymentVisibility() {
            const category = document.getElementById('positionCategory').value;
            const paymentSection = document.getElementById('paymentTypeSection');
            const hourlyField = document.getElementById('hourlyRateField');
            const perJobField = document.getElementById('perJobField');
            const paymentTypeSelect = document.getElementById('paymentType');
            
            if (category === 'volunteer') {
                paymentSection.style.display = 'none';
                hourlyField.style.display = 'none';
                perJobField.style.display = 'none';
                paymentTypeSelect.required = false;
                document.getElementById('employeeHourlyRate').required = false;
                document.getElementById('employeeJobPay').required = false;
            } else {
                paymentSection.style.display = 'block';
                paymentTypeSelect.required = true;
                togglePaymentFields();
            }
        }

        function togglePaymentFields() {
            const paymentType = document.getElementById('paymentType').value;
            const hourlyField = document.getElementById('hourlyRateField');
            const perJobField = document.getElementById('perJobField');
            
            if (paymentType === 'hourly') {
                hourlyField.style.display = 'block';
                perJobField.style.display = 'none';
                document.getElementById('employeeHourlyRate').required = true;
                document.getElementById('employeeJobPay').required = false;
            } else if (paymentType === 'per_job') {
                hourlyField.style.display = 'none';
                perJobField.style.display = 'block';
                document.getElementById('employeeHourlyRate').required = false;
                document.getElementById('employeeJobPay').required = true;
            } else {
                hourlyField.style.display = 'none';
                perJobField.style.display = 'none';
                document.getElementById('employeeHourlyRate').required = false;
                document.getElementById('employeeJobPay').required = false;
            }
        }
        
        function submitNewEmployee(event) {
            event.preventDefault();
            event.stopPropagation();
            
            const positionCategory = document.getElementById('positionCategory').value;
            const name = document.getElementById('employeeName').value.trim();
            const role = document.getElementById('employeeRole').value;
            const email = document.getElementById('employeeEmail').value.trim();
            const phone = document.getElementById('employeePhone').value.trim();
            const paymentType = document.getElementById('paymentType').value;
            const status = document.getElementById('employeeStatus').value;
            
            let rate = 0;
            let paymentInfo = '';
            
            if (positionCategory === 'volunteer') {
                paymentInfo = 'Volunteer (Unpaid)';
            } else if (paymentType === 'hourly') {
                rate = document.getElementById('employeeHourlyRate').value;
                paymentInfo = `$${rate}/hour`;
            } else if (paymentType === 'per_job') {
                rate = document.getElementById('employeeJobPay').value;
                paymentInfo = `$${rate}/job`;
            }
            
            if (!positionCategory || !name || !role || !email || !phone) {
                showNotification('Please fill in all required fields', 'error');
                return;
            }
            
            if (positionCategory !== 'volunteer' && (!paymentType || !rate)) {
                showNotification('Please set payment information for paid positions', 'error');
                return;
            }
            
            // Create new team member object
            const newEmployee = {
                id: Date.now().toString(),
                name: name,
                role: role,
                email: email,
                phone: phone,
                rate: parseFloat(rate),
                paymentType: paymentType,
                paymentInfo: paymentInfo,
                status: status,
                avatar: name.charAt(0).toUpperCase(),
                color: getRoleColor(role),
                positionCategory: positionCategory,
                categoryDisplay: getCategoryDisplay(positionCategory),
                dateAdded: new Date().toISOString()
            };
            
            // Get existing employees from localStorage or create new array
            let employees = JSON.parse(localStorage.getItem('marketpace_employees') || '[]');
            
            // Add new employee
            employees.push(newEmployee);
            
            // Save to localStorage
            localStorage.setItem('marketpace_employees', JSON.stringify(employees));
            
            // Refresh employee grid
            generateEmployeeCards();
            
            // Close modal
            closeAddEmployeeModal();
            
            // Send invitation via SMS and email
            sendEmployeeInvitation(newEmployee);
            
            // Show success message
            const categoryDisplay = getCategoryDisplay(positionCategory);
            showNotification(`${categoryDisplay} ${name} added successfully! Invitation sent via SMS and email.`, 'success');
            
            console.log('New employee added:', newEmployee);
        }
        
        function getRoleColor(role) {
            const roleColors = {
                'Manager': 'manager',
                'Cashier': 'cashier',
                'Sales': 'sales',
                'Stock': 'stock',
                'Assistant': 'assistant',
                'Security': 'security'
            };
            return roleColors[role] || 'cashier';
        }
        
        function getCategoryDisplay(category) {
            const categoryDisplays = {
                'employee': 'Employee',
                'volunteer': 'Volunteer', 
                'independent_contractor': 'Independent Contractor'
            };
            return categoryDisplays[category] || 'Team Member';
        }
        
        async function sendEmployeeInvitation(employee) {
            try {
                console.log('Sending invitation to:', employee.name);
                
                const invitationData = {
                    name: employee.name,
                    role: employee.role,
                    email: employee.email,
                    phone: employee.phone,
                    paymentInfo: employee.paymentInfo,
                    employeeId: employee.id
                };
                
                const response = await fetch('/api/employee/send-invitation', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(invitationData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    console.log('✅ Invitation sent successfully:', result);
                } else {
                    console.error('❌ Failed to send invitation:', result.error);
                    showNotification('Employee added but invitation failed to send', 'warning');
                }
                
            } catch (error) {
                console.error('❌ Error sending invitation:', error);
                showNotification('Employee added but invitation failed to send', 'warning');
            }
        }

        function showCustomTimeModal() {
            showNotification('Opening custom time selector', 'success');
            // In a real app, this would open a modal for custom time selection
        }

        // Initialize smart employee management
        function initializeSmartEmployeeManagement() {
            console.log('Smart Employee Management positioned at top of Employees tab');
            
            // Generate employee cards
            const smartEmployeeGrid = document.getElementById('smartEmployeeGrid');
            if (smartEmployeeGrid) {
                generateEmployeeCards();
            }
        }

        function generateEmployeeCards() {
            // Get employees from localStorage, fallback to default employees
            let employees = JSON.parse(localStorage.getItem('marketpace_employees') || '[]');
            
            // If no saved employees, use default demo employees
            if (employees.length === 0) {
                employees = [
                    { id: 'sarah', name: 'Sarah Johnson', role: 'Manager', status: 'Available', avatar: 'S', color: 'manager', email: 'sarah@example.com', phone: '(555) 123-4567', rate: 25.00, paymentType: 'hourly', paymentInfo: '$25.00/hour', positionCategory: 'employee', categoryDisplay: 'Employee' },
                    { id: 'mike', name: 'Mike Chen', role: 'Cashier', status: 'Available', avatar: 'M', color: 'cashier', email: 'mike@example.com', phone: '(555) 234-5678', rate: 15.00, paymentType: 'hourly', paymentInfo: '$15.00/hour', positionCategory: 'employee', categoryDisplay: 'Employee' },
                    { id: 'jessica', name: 'Jessica Martinez', role: 'Sales', status: 'Scheduled', avatar: 'J', color: 'sales', email: 'jessica@example.com', phone: '(555) 345-6789', rate: 75.00, paymentType: 'per_job', paymentInfo: '$75.00/job', positionCategory: 'independent_contractor', categoryDisplay: 'Independent Contractor' },
                    { id: 'david', name: 'David Wilson', role: 'Stock', status: 'Available', avatar: 'D', color: 'stock', email: 'david@example.com', phone: '(555) 456-7890', rate: 16.00, paymentType: 'hourly', paymentInfo: '$16.00/hour', positionCategory: 'employee', categoryDisplay: 'Employee' },
                    { id: 'emma', name: 'Emma Davis', role: 'Assistant', status: 'Off', avatar: 'E', color: 'assistant', email: 'emma@example.com', phone: '(555) 567-8901', rate: 50.00, paymentType: 'per_job', paymentInfo: '$50.00/job', positionCategory: 'volunteer', categoryDisplay: 'Volunteer' },
                    { id: 'carlos', name: 'Carlos Rodriguez', role: 'Security', status: 'Available', avatar: 'C', color: 'security', email: 'carlos@example.com', phone: '(555) 678-9012', rate: 20.00, paymentType: 'hourly', paymentInfo: '$20.00/hour', positionCategory: 'employee', categoryDisplay: 'Employee' }
                ];
                // Save default employees to localStorage
                localStorage.setItem('marketpace_employees', JSON.stringify(employees));
            }

            const smartEmployeeGrid = document.getElementById('smartEmployeeGrid');
            smartEmployeeGrid.innerHTML = '';

            employees.forEach(employee => {
                const card = document.createElement('div');
                card.className = 'employee-card';
                card.style.cssText = `
                    background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
                    border: 1px solid rgba(255,255,255,0.2);
                    border-radius: 12px;
                    padding: 16px;
                    cursor: pointer;
                    transition: all 0.3s ease;
                    position: relative;
                `;

                // Add status indicator colors
                let statusColor = '#00ff88'; // Available
                if (employee.status === 'Scheduled') statusColor = '#ffd700';
                if (employee.status === 'Off') statusColor = '#ff6b9d';

                card.innerHTML = `
                    <div style="display: flex; align-items: center; margin-bottom: 12px;">
                        <div class="employee-avatar ${employee.color}" style="width: 48px; height: 48px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 18px; margin-right: 12px;">${employee.avatar}</div>
                        <div style="flex: 1;">
                            <div style="font-weight: bold; color: white; font-size: 16px;">${employee.name}</div>
                            <div style="color: #94a3b8; font-size: 14px;">${employee.role}</div>
                            <div style="color: #ffd700; font-size: 12px; margin-top: 2px;">${employee.categoryDisplay || employee.positionCategory || 'Employee'}</div>
                        </div>
                    </div>
                    <div style="margin-bottom: 12px;">
                        <div style="color: #00ffff; font-size: 12px; margin-bottom: 4px;">
                            ${employee.paymentInfo || (employee.positionCategory === 'volunteer' ? 'Volunteer (Unpaid)' : `$${employee.rate}/hour`)}
                        </div>
                        <div style="color: #888; font-size: 12px;">
                            ${employee.phone}
                        </div>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div class="status-widget">
                            <button class="status-button ${employee.status.toLowerCase()}" onclick="toggleStatusDropdown('${employee.id}')" id="status-btn-${employee.id}">
                                ${employee.status}
                            </button>
                            <div class="status-dropdown" id="status-dropdown-${employee.id}">
                                <button class="status-option available" onclick="updateEmployeeStatus('${employee.id}', 'Available')">Available</button>
                                <button class="status-option scheduled" onclick="updateEmployeeStatus('${employee.id}', 'Scheduled')">Scheduled</button>
                                <button class="status-option break" onclick="updateEmployeeStatus('${employee.id}', 'Break')">Break</button>
                                <button class="status-option off" onclick="updateEmployeeStatus('${employee.id}', 'Off')">Off</button>
                            </div>
                        </div>
                        <button style="background: linear-gradient(135deg, #00ffff, #4169e1); border: none; color: white; padding: 6px 12px; border-radius: 6px; font-size: 12px; cursor: pointer;" onclick="openEmployeeScheduling(${JSON.stringify(employee).replace(/"/g, '&quot;')})">Schedule</button>
                    </div>
                `;

                // Add click handler to open scheduling interface
                card.onclick = function() {
                    openEmployeeScheduling(employee);
                };

                // Add hover effects
                card.onmouseenter = function() {
                    this.style.transform = 'translateY(-2px)';
                    this.style.boxShadow = '0 8px 25px rgba(0,255,255,0.3)';
                    this.style.borderColor = '#00ffff';
                };

                card.onmouseleave = function() {
                    this.style.transform = 'translateY(0)';
                    this.style.boxShadow = 'none';
                    this.style.borderColor = 'rgba(255,255,255,0.2)';
                };

                smartEmployeeGrid.appendChild(card);
            });
        }

        function openEmployeeScheduling(employee) {
            // Set employee details in the scheduling interface
            document.getElementById('selectedEmployeeName').textContent = employee.name;
            document.getElementById('selectedEmployeeRole').textContent = employee.role;
            
            // Show the scheduling interface
            document.getElementById('selectedEmployeeScheduling').style.display = 'block';
            
            // Scroll to the scheduling interface
            document.getElementById('selectedEmployeeScheduling').scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            });

            showNotification(`Opening schedule for ${employee.name}`, 'success');
        }

        function closeEmployeeScheduling() {
            document.getElementById('selectedEmployeeScheduling').style.display = 'none';
            showNotification('Closed employee scheduling interface', 'success');
        }

        // One-Click Status Update Functions
        function toggleStatusDropdown(employeeId) {
            // Close all other dropdowns first
            document.querySelectorAll('.status-dropdown').forEach(dropdown => {
                if (dropdown.id !== `status-dropdown-${employeeId}`) {
                    dropdown.classList.remove('show');
                }
            });

            // Toggle the clicked dropdown
            const dropdown = document.getElementById(`status-dropdown-${employeeId}`);
            if (dropdown) {
                dropdown.classList.toggle('show');
            }

            // Close dropdown when clicking outside
            setTimeout(() => {
                document.addEventListener('click', function closeDropdown(e) {
                    if (!e.target.closest('.status-widget')) {
                        document.querySelectorAll('.status-dropdown').forEach(dropdown => {
                            dropdown.classList.remove('show');
                        });
                        document.removeEventListener('click', closeDropdown);
                    }
                });
            }, 100);
        }

        function updateEmployeeStatus(employeeId, newStatus) {
            const statusButton = document.getElementById(`status-btn-${employeeId}`);
            const dropdown = document.getElementById(`status-dropdown-${employeeId}`);
            
            if (statusButton && dropdown) {
                // Update button text and styling
                statusButton.textContent = newStatus;
                statusButton.className = `status-button ${newStatus.toLowerCase()}`;
                
                // Close dropdown
                dropdown.classList.remove('show');
                
                // Update employee data
                const employees = [
                    { id: 'sarah', name: 'Sarah Johnson', role: 'Manager', status: 'Available', avatar: 'S', color: 'manager' },
                    { id: 'mike', name: 'Mike Chen', role: 'Cashier', status: 'Available', avatar: 'M', color: 'cashier' },
                    { id: 'jessica', name: 'Jessica Martinez', role: 'Sales', status: 'Scheduled', avatar: 'J', color: 'sales' },
                    { id: 'david', name: 'David Wilson', role: 'Stock', status: 'Available', avatar: 'D', color: 'stock' },
                    { id: 'emma', name: 'Emma Davis', role: 'Assistant', status: 'Off', avatar: 'E', color: 'assistant' },
                    { id: 'carlos', name: 'Carlos Rodriguez', role: 'Security', status: 'Available', avatar: 'C', color: 'security' }
                ];
                
                const employee = employees.find(emp => emp.id === employeeId);
                if (employee) {
                    employee.status = newStatus;
                    
                    // Show success notification with employee name
                    showNotification(`Updated ${employee.name} status to ${newStatus}`, 'success');
                    
                    // Update schedule view if visible
                    updateScheduleView();
                    
                    // Update statistics
                    updateEmployeeStats();
                }
            }
        }

        function updateScheduleView() {
            // Update any schedule displays that show employee status
            console.log('Schedule view updated with new employee status');
        }

        function updateEmployeeStats() {
            // Update employee statistics counters
            const employees = document.querySelectorAll('.status-button');
            let availableCount = 0;
            let scheduledCount = 0;
            let offCount = 0;
            let breakCount = 0;
            
            employees.forEach(button => {
                const status = button.textContent.toLowerCase();
                switch(status) {
                    case 'available': availableCount++; break;
                    case 'scheduled': scheduledCount++; break;
                    case 'off': offCount++; break;
                    case 'break': breakCount++; break;
                }
            });
            
            console.log(`Employee Status Stats: Available: ${availableCount}, Scheduled: ${scheduledCount}, Off: ${offCount}, Break: ${breakCount}`);
        }

        // Smooth Tab Switching Function - Simple and Effective
        function showTab(tabId) {
            // Remove active class from all nav chips
            document.querySelectorAll('.nav-chip').forEach(chip => {
                chip.classList.remove('active');
            });

            // Add active class to clicked nav chip
            const activeChip = document.querySelector(`[data-tab="${tabId}"]`);
            if (activeChip) {
                activeChip.classList.add('active');
            }

            // Hide all tabs immediately
            document.querySelectorAll('.tab-content').forEach(content => {
                content.style.display = 'none';
                content.classList.remove('active');
            });

            // Show the selected tab
            const targetTab = document.getElementById(tabId);
            if (targetTab) {
                targetTab.style.display = 'block';
                targetTab.classList.add('active');
            }

            // Initialize tab-specific functionality
            if (tabId === 'employees') {
                initializeSmartEmployeeManagement();
            } else if (tabId === 'volunteers') {
                console.log('Volunteer Management positioned at top of Volunteers tab');
            } else if (tabId === 'qr-system') {
                console.log('Employee QR System positioned at top of QR System tab');
            }
        }

        // Initialize smart employee management when the tab is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize the first tab
            showTab('schedule');
            
            // Small delay to ensure DOM is fully loaded
            setTimeout(initializeSmartEmployeeManagement, 100);
        });

        // Employee Management Functions
        function submitEmployeeForm(event) {
            event.preventDefault();
            
            const name = document.getElementById('employeeName').value;
            const role = document.getElementById('employeeRole').value;
            const rate = document.getElementById('employeeRate').value;
            
            // Add employee to the list
            const employeeList = document.getElementById('employeeList');
            const newEmployee = document.createElement('div');
            newEmployee.className = 'employee-item';
            newEmployee.style.cssText = 'display: flex; justify-content: space-between; align-items: center; padding: 12px; background: rgba(255,255,255,0.05); border-radius: 8px;';
            
            newEmployee.innerHTML = `
                <div>
                    <div style="font-weight: bold; color: white;">${name}</div>
                    <div style="color: #94a3b8; font-size: 14px;">${role} - $${parseFloat(rate).toFixed(2)}/hr</div>
                </div>
                <div style="display: flex; gap: 8px;">
                    <button class="btn" style="padding: 6px 12px; font-size: 12px;" onclick="editEmployee('${name}')">Edit</button>
                    <button class="btn" style="padding: 6px 12px; font-size: 12px; background: rgba(255,0,0,0.2);" onclick="removeEmployee('${name}')">Remove</button>
                </div>
            `;
            
            employeeList.appendChild(newEmployee);
            
            // Update stats
            const totalEmployees = document.getElementById('totalEmployees');
            totalEmployees.textContent = parseInt(totalEmployees.textContent) + 1;
            
            // Clear form
            document.getElementById('employeeName').value = '';
            document.getElementById('employeeRate').value = '';
            
            showNotification(`Added ${name} as ${role}`, 'success');
        }

        function editEmployee(name) {
            showNotification(`Opening edit form for ${name}`, 'success');
        }

        function removeEmployee(name) {
            const employeeItems = document.querySelectorAll('.employee-item');
            employeeItems.forEach(item => {
                if (item.textContent.includes(name)) {
                    item.remove();
                    
                    // Update stats
                    const totalEmployees = document.getElementById('totalEmployees');
                    totalEmployees.textContent = parseInt(totalEmployees.textContent) - 1;
                    
                    showNotification(`Removed ${name} from employee list`, 'success');
                }
            });
        }

        // Volunteer Management Functions
        function submitVolunteerForm(event) {
            event.preventDefault();
            
            const name = document.getElementById('volunteerName').value;
            const skills = document.getElementById('volunteerSkills').value;
            const availability = document.getElementById('volunteerAvailability').value;
            
            // Add volunteer to the list
            const volunteerList = document.getElementById('volunteerList');
            const newVolunteer = document.createElement('div');
            newVolunteer.className = 'volunteer-item';
            newVolunteer.style.cssText = 'display: flex; justify-content: space-between; align-items: center; padding: 12px; background: rgba(255,255,255,0.05); border-radius: 8px;';
            
            newVolunteer.innerHTML = `
                <div>
                    <div style="font-weight: bold; color: white;">${name}</div>
                    <div style="color: #94a3b8; font-size: 14px;">${skills} • ${availability}</div>
                </div>
                <div style="display: flex; gap: 8px;">
                    <button class="btn" style="padding: 6px 12px; font-size: 12px;" onclick="editVolunteer('${name}')">Edit</button>
                    <button class="btn" style="padding: 6px 12px; font-size: 12px; background: rgba(255,0,0,0.2);" onclick="removeVolunteer('${name}')">Remove</button>
                </div>
            `;
            
            volunteerList.appendChild(newVolunteer);
            
            // Update stats
            const totalVolunteers = document.getElementById('totalVolunteers');
            totalVolunteers.textContent = parseInt(totalVolunteers.textContent) + 1;
            
            // Clear form
            document.getElementById('volunteerName').value = '';
            
            showNotification(`Added ${name} as volunteer for ${skills}`, 'success');
        }

        function editVolunteer(name) {
            showNotification(`Opening edit form for ${name}`, 'success');
        }

        function removeVolunteer(name) {
            const volunteerItems = document.querySelectorAll('.volunteer-item');
            volunteerItems.forEach(item => {
                if (item.textContent.includes(name)) {
                    item.remove();
                    
                    // Update stats
                    const totalVolunteers = document.getElementById('totalVolunteers');
                    totalVolunteers.textContent = parseInt(totalVolunteers.textContent) - 1;
                    
                    showNotification(`Removed ${name} from volunteer list`, 'success');
                }
            });
        }

        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 16px 20px;
                border-radius: 8px;
                color: white;
                font-weight: 500;
                z-index: 1001;
                animation: slideIn 0.3s ease;
                background: ${type === 'success' ? 'linear-gradient(135deg, #10b981, #059669)' : 'linear-gradient(135deg, #ef4444, #dc2626)'};
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Voice Recognition System
        let recognition = null;
        let isListening = false;

        function initializeVoiceRecognition() {
            if ('webkitSpeechRecognition' in window) {
                recognition = new webkitSpeechRecognition();
            } else if ('SpeechRecognition' in window) {
                recognition = new SpeechRecognition();
            } else {
                console.warn('Speech recognition not supported');
                document.getElementById('start-voice').disabled = true;
                document.getElementById('voice-status').textContent = 'Voice recognition not supported';
                return false;
            }

            recognition.continuous = true;
            recognition.interimResults = true;
            recognition.lang = 'en-US';

            recognition.onstart = function() {
                isListening = true;
                document.getElementById('voice-status').textContent = 'Listening...';
                document.getElementById('start-voice').style.display = 'none';
                document.getElementById('stop-voice').style.display = 'flex';
                
                // Add pulsing animation to voice icon
                document.querySelector('.voice-icon').style.animation = 'pulse 1.5s ease-in-out infinite';
            };

            recognition.onresult = function(event) {
                let transcript = '';
                for (let i = event.resultIndex; i < event.results.length; ++i) {
                    if (event.results[i].isFinal) {
                        transcript += event.results[i][0].transcript;
                    }
                }
                
                if (transcript.trim()) {
                    processVoiceCommand(transcript.trim());
                }
            };

            recognition.onerror = function(event) {
                console.error('Voice recognition error:', event.error);
                document.getElementById('voice-status').textContent = 'Error: ' + event.error;
                stopVoiceRecognition();
            };

            recognition.onend = function() {
                stopVoiceRecognition();
            };

            return true;
        }

        function startVoiceRecognition() {
            if (!recognition && !initializeVoiceRecognition()) {
                showNotification('Voice recognition not available', 'error');
                return;
            }

            try {
                recognition.start();
                updateVoiceOutput('🎤 Voice recognition started. Try saying a command...');
            } catch (error) {
                console.error('Error starting voice recognition:', error);
                showNotification('Could not start voice recognition', 'error');
            }
        }

        function stopVoiceRecognition() {
            if (recognition && isListening) {
                recognition.stop();
            }
            
            isListening = false;
            document.getElementById('voice-status').textContent = 'Ready to listen';
            document.getElementById('start-voice').style.display = 'flex';
            document.getElementById('stop-voice').style.display = 'none';
            
            // Remove pulsing animation
            document.querySelector('.voice-icon').style.animation = 'none';
        }

        function processVoiceCommand(command) {
            updateVoiceOutput(`🔊 Command received: "${command}"`);
            
            const cmd = command.toLowerCase();
            
            // Employee mapping
            const employees = {
                'sarah': { name: 'Sarah Johnson', role: 'manager' },
                'mike': { name: 'Mike Chen', role: 'cashier' },
                'jessica': { name: 'Jessica Martinez', role: 'sales' },
                'david': { name: 'David Wilson', role: 'stock' },
                'emma': { name: 'Emma Davis', role: 'assistant' },
                'carlos': { name: 'Carlos Rodriguez', role: 'security' }
            };

            // Day mapping
            const days = {
                'monday': 'mon', 'tuesday': 'tue', 'wednesday': 'wed', 
                'thursday': 'thu', 'friday': 'fri', 'saturday': 'sat', 'sunday': 'sun'
            };

            // Schedule employee commands
            if (cmd.includes('schedule') || cmd.includes('add')) {
                let employeeName = null;
                let day = null;
                let startTime = null;
                let endTime = null;

                // Find employee
                for (const [key, employee] of Object.entries(employees)) {
                    if (cmd.includes(key)) {
                        employeeName = key;
                        break;
                    }
                }

                // Find day
                for (const [dayName, dayShort] of Object.entries(days)) {
                    if (cmd.includes(dayName)) {
                        day = dayShort;
                        break;
                    }
                }

                // Extract time patterns
                const timeRegex = /(\d{1,2})\s*(am|pm|AM|PM)/g;
                const times = [...cmd.matchAll(timeRegex)];
                
                if (times.length >= 2) {
                    startTime = times[0][0];
                    endTime = times[1][0];
                } else if (cmd.includes('morning')) {
                    startTime = '9AM';
                    endTime = '12PM';
                } else if (cmd.includes('afternoon')) {
                    startTime = '1PM';
                    endTime = '5PM';
                } else if (cmd.includes('evening')) {
                    startTime = '6PM';
                    endTime = '10PM';
                }

                if (employeeName && day) {
                    const employee = employees[employeeName];
                    const timeInfo = startTime && endTime ? ` from ${startTime} to ${endTime}` : '';
                    updateVoiceOutput(`✅ Scheduling ${employee.name} on ${day.toUpperCase()}${timeInfo}`);
                    addEmployeeToSchedule(employeeName, day, startTime, endTime);
                    showNotification(`Scheduled ${employee.name} for ${day.toUpperCase()}${timeInfo}`, 'success');
                } else {
                    updateVoiceOutput('❌ Could not understand the scheduling command. Please specify employee and day.');
                }
            }
            // Remove employee commands
            else if (cmd.includes('remove') || cmd.includes('delete')) {
                let employeeName = null;
                let day = null;

                for (const [key, employee] of Object.entries(employees)) {
                    if (cmd.includes(key)) {
                        employeeName = key;
                        break;
                    }
                }

                for (const [dayName, dayShort] of Object.entries(days)) {
                    if (cmd.includes(dayName)) {
                        day = dayShort;
                        break;
                    }
                }

                if (employeeName && day) {
                    const employee = employees[employeeName];
                    updateVoiceOutput(`✅ Removing ${employee.name} from ${day.toUpperCase()}`);
                    removeEmployeeFromSchedule(employeeName, day);
                    showNotification(`Removed ${employee.name} from ${day.toUpperCase()}`, 'success');
                } else {
                    updateVoiceOutput('❌ Could not understand the removal command. Please specify employee and day.');
                }
            }
            // Show availability commands
            else if (cmd.includes('availability') || cmd.includes('show') || cmd.includes('who')) {
                updateVoiceOutput('📋 Current employee roster: Sarah (Manager), Mike (Cashier), Jessica (Sales), David (Stock), Emma (Assistant), Carlos (Security)');
                showNotification('Employee availability displayed', 'success');
            }
            // Help commands
            else if (cmd.includes('help') || cmd.includes('what can')) {
                updateVoiceOutput(`🤖 Voice commands available:
• "Schedule [name] on [day] from [start] to [end]"
• "Add [name] to [day] morning/afternoon/evening"
• "Remove [name] from [day]"
• "Show me employee availability"
• "Help" - Show this help`);
            }
            else {
                updateVoiceOutput(`❓ Command not recognized: "${command}". Try saying "help" for available commands.`);
            }
        }

        function updateVoiceOutput(message) {
            const output = document.getElementById('voice-output');
            const timestamp = new Date().toLocaleTimeString();
            output.innerHTML += `<div style="margin-bottom: 8px; color: #94a3b8;"><span style="color: #8a2be2;">[${timestamp}]</span> ${message}</div>`;
            output.scrollTop = output.scrollHeight;
        }

        function addEmployeeToSchedule(employee, day, startTime, endTime) {
            // This would integrate with the actual scheduling system
            console.log(`Adding ${employee} to ${day} from ${startTime} to ${endTime}`);
        }

        function removeEmployeeFromSchedule(employee, day) {
            // This would integrate with the actual scheduling system
            console.log(`Removing ${employee} from ${day}`);
        }

        // Drag and Drop Functionality
        function initializeDragAndDrop() {
            const employeeChips = document.querySelectorAll('.employee-chip');
            const daySchedules = document.querySelectorAll('.day-schedule');

            employeeChips.forEach(chip => {
                chip.addEventListener('dragstart', function(e) {
                    e.dataTransfer.setData('text/plain', JSON.stringify({
                        employee: this.dataset.employee,
                        role: this.dataset.role,
                        name: this.querySelector('.chip-name').textContent
                    }));
                    this.style.opacity = '0.5';
                });

                chip.addEventListener('dragend', function(e) {
                    this.style.opacity = '1';
                });
            });

            daySchedules.forEach(schedule => {
                schedule.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    this.style.backgroundColor = 'rgba(0, 255, 255, 0.1)';
                });

                schedule.addEventListener('dragleave', function(e) {
                    this.style.backgroundColor = '';
                });

                schedule.addEventListener('drop', function(e) {
                    e.preventDefault();
                    this.style.backgroundColor = '';
                    
                    const data = JSON.parse(e.dataTransfer.getData('text/plain'));
                    const dayName = this.closest('.day-column').querySelector('.day-name').textContent;
                    
                    // Calculate drop position to determine time
                    const rect = this.getBoundingClientRect();
                    const y = e.clientY - rect.top;
                    const hourHeight = 65; // Height of each hour slot
                    const startHour = 6; // Start at 6 AM
                    const dropHour = Math.floor(y / hourHeight) + startHour;
                    
                    const startTime = formatTime(dropHour);
                    const endTime = formatTime(dropHour + 4); // Default 4-hour shift
                    
                    showNotification(`Added ${data.name} to ${dayName} from ${startTime} to ${endTime}`, 'success');
                    
                    // Create visual shift block
                    createShiftBlock(this, data, y, startTime, endTime);
                });
            });
        }

        function createShiftBlock(container, employeeData, yPosition, startTime, endTime) {
            const shiftBlock = document.createElement('div');
            shiftBlock.className = `shift-block ${employeeData.role}`;
            shiftBlock.style.cssText = `
                position: absolute;
                top: ${yPosition}px;
                height: 260px; /* 4 hours * 65px */
                left: 4px;
                right: 4px;
                cursor: pointer;
            `;
            
            shiftBlock.innerHTML = `
                <div class="shift-info">${employeeData.name} • ${employeeData.role.charAt(0).toUpperCase() + employeeData.role.slice(1)}</div>
                <div class="shift-time">${startTime}-${endTime}</div>
            `;
            
            shiftBlock.onclick = function() {
                editShift(`${employeeData.employee}-${startTime}-${endTime}`);
            };
            
            container.appendChild(shiftBlock);
        }

        function formatTime(hour) {
            if (hour === 0) return '12AM';
            if (hour < 12) return hour + 'AM';
            if (hour === 12) return '12PM';
            return (hour - 12) + 'PM';
        }

        // CSS for pulse animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes pulse {
                0% { transform: scale(1); opacity: 1; }
                50% { transform: scale(1.1); opacity: 0.7; }
                100% { transform: scale(1); opacity: 1; }
            }
        `;
        document.head.appendChild(style);

        // Festival Scale Management System
        let currentScale = 'small';
        let employeeDatabase = [];
        let currentPage = 1;
        let employeesPerPage = 20;
        let filteredEmployees = [];

        function generateFestivalEmployees(count) {
            const roles = ['manager', 'cashier', 'sales', 'stock', 'assistant', 'security', 'performer', 'vendor', 'tech', 'cleanup'];
            const names = ['Alex', 'Jordan', 'Casey', 'Morgan', 'Taylor', 'Jamie', 'Riley', 'Avery', 'Quinn', 'Cameron'];
            const lastNames = ['Smith', 'Johnson', 'Brown', 'Davis', 'Wilson', 'Moore', 'Taylor', 'Anderson', 'Thomas', 'Jackson'];
            
            const employees = [];
            for (let i = 0; i < count; i++) {
                const role = roles[Math.floor(Math.random() * roles.length)];
                const firstName = names[Math.floor(Math.random() * names.length)];
                const lastName = lastNames[Math.floor(Math.random() * lastNames.length)];
                
                employees.push({
                    id: `emp_${i + 1}`,
                    name: `${firstName} ${lastName}`,
                    role: role,
                    department: getDepartmentByRole(role),
                    availability: Math.random() > 0.3 ? 'available' : 'unavailable',
                    scheduled: Math.random() > 0.7,
                    avatar: firstName.charAt(0).toUpperCase()
                });
            }
            return employees;
        }

        function getDepartmentByRole(role) {
            const departments = {
                'manager': 'Operations',
                'cashier': 'Sales',
                'sales': 'Sales',
                'stock': 'Logistics',
                'assistant': 'Operations',
                'security': 'Security',
                'performer': 'Entertainment',
                'vendor': 'Food & Beverage',
                'tech': 'Technical',
                'cleanup': 'Maintenance'
            };
            return departments[role] || 'General';
        }

        function setEventScale(scale) {
            currentScale = scale;
            
            // Update active button
            document.querySelectorAll('.scale-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-scale="${scale}"]`).classList.add('active');
            
            // Generate appropriate employee count
            let employeeCount;
            switch(scale) {
                case 'small':
                    employeeCount = 6;
                    employeesPerPage = 20;
                    break;
                case 'medium':
                    employeeCount = 50;
                    employeesPerPage = 25;
                    break;
                case 'large':
                    employeeCount = 500;
                    employeesPerPage = 20;
                    break;
            }
            
            // Show/hide bulk actions for medium and large scales
            const bulkActions = document.getElementById('bulk-actions');
            if (scale === 'small') {
                bulkActions.style.display = 'none';
            } else {
                bulkActions.style.display = 'block';
            }
            
            // Generate employee database
            if (scale === 'small') {
                employeeDatabase = [
                    { id: 'sarah', name: 'Sarah Johnson', role: 'manager', department: 'Operations', availability: 'available', scheduled: false, avatar: 'S' },
                    { id: 'mike', name: 'Mike Chen', role: 'cashier', department: 'Sales', availability: 'available', scheduled: false, avatar: 'M' },
                    { id: 'jessica', name: 'Jessica Martinez', role: 'sales', department: 'Sales', availability: 'available', scheduled: false, avatar: 'J' },
                    { id: 'david', name: 'David Wilson', role: 'stock', department: 'Logistics', availability: 'available', scheduled: false, avatar: 'D' },
                    { id: 'emma', name: 'Emma Davis', role: 'assistant', department: 'Operations', availability: 'available', scheduled: false, avatar: 'E' },
                    { id: 'carlos', name: 'Carlos Rodriguez', role: 'security', department: 'Security', availability: 'available', scheduled: false, avatar: 'C' }
                ];
            } else {
                employeeDatabase = generateFestivalEmployees(employeeCount);
            }
            
            currentPage = 1;
            filterEmployees();
            
            showNotification(`Switched to ${scale} scale with ${employeeCount} employees`, 'success');
            updateVoiceConsole(`📊 Event scale set to ${scale.toUpperCase()} - Managing ${employeeCount} employees`);
        }

        function updateVoiceOutput(message) {
            updateVoiceConsole(message);
        }

        function filterEmployees() {
            const searchTerm = document.getElementById('employee-search').value.toLowerCase();
            const roleFilter = document.getElementById('role-filter').value;
            const availabilityFilter = document.getElementById('availability-filter').value;
            
            filteredEmployees = employeeDatabase.filter(employee => {
                const matchesSearch = employee.name.toLowerCase().includes(searchTerm) || 
                                    employee.role.toLowerCase().includes(searchTerm);
                const matchesRole = !roleFilter || employee.role === roleFilter;
                const matchesAvailability = !availabilityFilter || 
                    (availabilityFilter === 'available' && employee.availability === 'available') ||
                    (availabilityFilter === 'scheduled' && employee.scheduled) ||
                    (availabilityFilter === 'unavailable' && employee.availability === 'unavailable');
                
                return matchesSearch && matchesRole && matchesAvailability;
            });
            
            updateEmployeeDisplay();
        }

        function updateEmployeeDisplay() {
            const roster = document.getElementById('employee-roster');
            const startIndex = (currentPage - 1) * employeesPerPage;
            const endIndex = startIndex + employeesPerPage;
            const pageEmployees = filteredEmployees.slice(startIndex, endIndex);
            
            // Clear roster
            roster.innerHTML = '';
            
            // Add employees
            pageEmployees.forEach(employee => {
                const chip = createEmployeeChip(employee);
                roster.appendChild(chip);
            });
            
            // Update counts
            document.getElementById('employee-count').textContent = `${employeeDatabase.length} employees`;
            document.getElementById('filtered-count').textContent = `${filteredEmployees.length} visible`;
            
            // Update pagination
            updatePagination();
            
            // Apply compact styling for large scale
            if (currentScale === 'large') {
                roster.querySelectorAll('.employee-chip').forEach(chip => {
                    chip.classList.add('compact');
                });
            }
        }

        function createEmployeeChip(employee) {
            const chip = document.createElement('div');
            chip.className = `employee-chip ${employee.role}`;
            chip.draggable = true;
            chip.dataset.employee = employee.id;
            chip.dataset.role = employee.role;
            
            chip.innerHTML = `
                <div class="chip-avatar">${employee.avatar}</div>
                <div class="chip-name">${employee.name.split(' ')[0]}</div>
                <div class="chip-role">${employee.role}</div>
            `;
            
            // Add availability indicator
            if (employee.availability === 'unavailable') {
                chip.style.opacity = '0.5';
                chip.style.filter = 'grayscale(70%)';
            }
            if (employee.scheduled) {
                chip.style.border = '2px solid #ffd700';
            }
            
            return chip;
        }

        function updatePagination() {
            const pagination = document.getElementById('roster-pagination');
            const pageInfo = document.getElementById('page-info');
            
            const totalPages = Math.ceil(filteredEmployees.length / employeesPerPage);
            
            if (totalPages <= 1) {
                pagination.style.display = 'none';
            } else {
                pagination.style.display = 'flex';
                pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;
                
                const prevBtn = pagination.querySelector('.page-btn');
                const nextBtn = pagination.querySelectorAll('.page-btn')[1];
                
                prevBtn.disabled = currentPage === 1;
                nextBtn.disabled = currentPage === totalPages;
            }
        }

        function previousPage() {
            if (currentPage > 1) {
                currentPage--;
                updateEmployeeDisplay();
            }
        }

        function nextPage() {
            const totalPages = Math.ceil(filteredEmployees.length / employeesPerPage);
            if (currentPage < totalPages) {
                currentPage++;
                updateEmployeeDisplay();
            }
        }

        // Bulk Scheduling Functions
        function bulkScheduleByRole() {
            const selectedRole = document.getElementById('role-filter').value;
            if (!selectedRole) {
                showNotification('Please select a role filter first', 'error');
                return;
            }
            
            const roleEmployees = employeeDatabase.filter(emp => emp.role === selectedRole);
            showNotification(`Bulk scheduling ${roleEmployees.length} ${selectedRole}s`, 'success');
            updateVoiceOutput(`📋 Bulk scheduling initiated for ${roleEmployees.length} ${selectedRole}s`);
        }

        function bulkScheduleByDepartment() {
            showNotification('Department-based bulk scheduling initiated', 'success');
            updateVoiceOutput('🏢 Scheduling employees by department groups');
        }

        function autoFillShifts() {
            showNotification('Auto-filling shifts based on availability and preferences', 'success');
            updateVoiceOutput('🤖 AI auto-fill algorithm initiated - optimizing coverage');
        }

        function importSchedule() {
            showNotification('Schedule import feature activated', 'success');
            updateVoiceOutput('📥 Ready to import schedule from CSV, Excel, or other scheduling systems');
        }

        // Enhanced Voice Commands for Large Scale
        function processVoiceCommandEnhanced(command) {
            const cmd = command.toLowerCase();
            
            // Bulk scheduling commands
            if (cmd.includes('bulk schedule') || cmd.includes('schedule all')) {
                if (cmd.includes('security')) {
                    document.getElementById('role-filter').value = 'security';
                    filterEmployees();
                    bulkScheduleByRole();
                } else if (cmd.includes('manager')) {
                    document.getElementById('role-filter').value = 'manager';
                    filterEmployees();
                    bulkScheduleByRole();
                } else {
                    autoFillShifts();
                }
                return true;
            }
            
            // Filter commands
            if (cmd.includes('show only') || cmd.includes('filter')) {
                if (cmd.includes('available')) {
                    document.getElementById('availability-filter').value = 'available';
                    filterEmployees();
                    updateVoiceOutput('✅ Showing only available employees');
                } else if (cmd.includes('security')) {
                    document.getElementById('role-filter').value = 'security';
                    filterEmployees();
                    updateVoiceOutput('🛡️ Showing only security staff');
                }
                return true;
            }
            
            // Scale commands
            if (cmd.includes('switch to') || cmd.includes('change scale')) {
                if (cmd.includes('large') || cmd.includes('festival')) {
                    setEventScale('large');
                } else if (cmd.includes('medium')) {
                    setEventScale('medium');
                } else if (cmd.includes('small')) {
                    setEventScale('small');
                }
                return true;
            }
            
            return false;
        }

        // Override the original voice command processor
        const originalProcessVoiceCommand = processVoiceCommand;
        processVoiceCommand = function(command) {
            if (!processVoiceCommandEnhanced(command)) {
                originalProcessVoiceCommand(command);
            }
        };

        // Sleek Voice Control Functions
        function toggleVoiceControl() {
            const dropdown = document.getElementById('voice-commands-dropdown');
            const console = document.getElementById('voice-output-console');
            const pulse = document.getElementById('voice-pulse-effect');
            const btn = document.getElementById('voice-command-btn');
            
            if (dropdown.style.display === 'none' || !dropdown.style.display) {
                // Show dropdown and start voice
                dropdown.style.display = 'block';
                console.style.display = 'block';
                pulse.style.display = 'block';
                btn.textContent = 'LISTENING';
                btn.style.background = 'linear-gradient(135deg, #ef4444, #dc2626)';
                
                updateVoiceConsole('🎤 Voice assistant activated - speak your command');
                startVoiceRecognition();
            } else {
                // Hide dropdown and stop voice
                hideVoiceDropdown();
                stopVoiceRecognition();
            }
        }

        function hideVoiceDropdown() {
            const dropdown = document.getElementById('voice-commands-dropdown');
            const console = document.getElementById('voice-output-console');
            const pulse = document.getElementById('voice-pulse-effect');
            const btn = document.getElementById('voice-command-btn');
            
            dropdown.style.display = 'none';
            console.style.display = 'none';
            pulse.style.display = 'none';
            btn.textContent = 'COMMAND';
            btn.style.background = 'linear-gradient(135deg, #8a2be2, #4169e1)';
            
            updateVoiceConsole('Voice system ready...');
        }

        function updateVoiceConsole(message) {
            const console = document.getElementById('voice-console-text');
            if (console) {
                const timestamp = new Date().toLocaleTimeString();
                console.innerHTML = `[${timestamp}] ${message}`;
            }
        }

        // Enhanced Voice Recognition for Sleek Interface
        function startVoiceRecognition() {
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                updateVoiceConsole('❌ Speech recognition not supported in this browser');
                return;
            }

            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            const recognition = new SpeechRecognition();
            
            recognition.continuous = true;
            recognition.interimResults = true;
            recognition.lang = 'en-US';

            recognition.onstart = function() {
                updateVoiceConsole('🎙️ Listening for voice commands...');
            };

            recognition.onresult = function(event) {
                const transcript = event.results[event.results.length - 1][0].transcript.trim();
                if (event.results[event.results.length - 1].isFinal) {
                    updateVoiceConsole(`📝 Command: "${transcript}"`);
                    processVoiceCommand(transcript);
                } else {
                    updateVoiceConsole(`🔊 Hearing: "${transcript}"`);
                }
            };

            recognition.onerror = function(event) {
                updateVoiceConsole(`❌ Voice error: ${event.error}`);
            };

            recognition.onend = function() {
                updateVoiceConsole('⏹️ Voice recognition stopped');
                hideVoiceDropdown();
            };

            window.currentRecognition = recognition;
            recognition.start();
        }

        function stopVoiceRecognition() {
            if (window.currentRecognition) {
                window.currentRecognition.stop();
            }
            updateVoiceConsole('Voice system ready...');
        }

        // Custom Schedule Title Management
        let selectedCustomTitle = null;

        function showCustomTitleModal() {
            document.getElementById('customTitleModal').style.display = 'flex';
            document.getElementById('customTitleName').focus();
        }

        function closeCustomTitleModal() {
            document.getElementById('customTitleModal').style.display = 'none';
            document.getElementById('customTitleForm').reset();
            document.getElementById('selectedCustomTitleColor').value = '#ffd700';
            updateCustomTitleColorSelection();
        }

        function selectCustomTitleColor(color) {
            document.getElementById('selectedCustomTitleColor').value = color;
            updateCustomTitleColorSelection();
        }

        function updateCustomTitleColorSelection() {
            const selectedColor = document.getElementById('selectedCustomTitleColor').value;
            document.querySelectorAll('.title-color-option').forEach(btn => {
                if (btn.dataset.color === selectedColor) {
                    btn.style.border = '3px solid white';
                    btn.style.boxShadow = `0 0 15px ${selectedColor}`;
                } else {
                    btn.style.border = '2px solid rgba(255,255,255,0.2)';
                    btn.style.boxShadow = 'none';
                }
            });
        }

        function createCustomTitle(event) {
            event.preventDefault();
            
            const titleName = document.getElementById('customTitleName').value.trim();
            const titleColor = document.getElementById('selectedCustomTitleColor').value;
            const titleDescription = document.getElementById('customTitleDescription').value.trim();
            
            if (!titleName) {
                showNotification('Please enter a schedule title', 'error');
                return;
            }

            const customTitle = {
                id: Date.now().toString(),
                name: titleName,
                color: titleColor,
                description: titleDescription,
                created: new Date().toISOString()
            };

            // Save to localStorage
            let customTitles = JSON.parse(localStorage.getItem('marketpace_custom_titles') || '[]');
            customTitles.push(customTitle);
            localStorage.setItem('marketpace_custom_titles', JSON.stringify(customTitles));

            // Refresh the custom titles display
            loadCustomTitles();
            
            // Close modal and show success
            closeCustomTitleModal();
            showNotification(`Custom title "${titleName}" created successfully`, 'success');
        }

        function loadCustomTitles() {
            const customTitles = JSON.parse(localStorage.getItem('marketpace_custom_titles') || '[]');
            const container = document.getElementById('customScheduleTitles');
            
            if (customTitles.length === 0) {
                container.innerHTML = '<span style="color: #94a3b8; font-style: italic; font-size: 12px; padding: 8px; display: block; text-align: center;">No custom titles yet. Click "+ Add Title" to create one.</span>';
                return;
            }

            container.innerHTML = '';
            customTitles.forEach(title => {
                const titleButton = document.createElement('button');
                titleButton.className = 'custom-title-button';
                titleButton.onclick = () => selectCustomTitle(title);
                titleButton.style.cssText = `
                    background: rgba(${hexToRgb(title.color)}, 0.2);
                    border: 2px solid rgba(${hexToRgb(title.color)}, 0.5);
                    color: ${title.color};
                    padding: 8px 12px;
                    border-radius: 6px;
                    cursor: pointer;
                    text-align: center;
                    font-weight: bold;
                    transition: all 0.3s ease;
                    font-size: 12px;
                    position: relative;
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    gap: 2px;
                `;

                titleButton.innerHTML = `
                    <span style="font-size: 12px; font-weight: bold;">${title.name}</span>
                    ${title.description ? `<small style="font-weight: normal; opacity: 0.8; font-size: 10px;">${title.description}</small>` : ''}
                    <button onclick="deleteCustomTitle('${title.id}', event)" style="position: absolute; top: -6px; right: -6px; width: 18px; height: 18px; border-radius: 50%; background: #ff4444; border: none; color: white; font-size: 10px; cursor: pointer; display: none;">×</button>
                `;

                // Add hover effects
                titleButton.onmouseenter = function() {
                    this.style.background = `rgba(${hexToRgb(title.color)}, 0.4)`;
                    this.style.transform = 'scale(1.05)';
                    this.querySelector('button').style.display = 'flex';
                };

                titleButton.onmouseleave = function() {
                    this.style.background = `rgba(${hexToRgb(title.color)}, 0.2)`;
                    this.style.transform = 'scale(1)';
                    this.querySelector('button').style.display = 'none';
                };

                container.appendChild(titleButton);
            });
        }

        function selectCustomTitle(title) {
            selectedCustomTitle = title;
            
            // Update visual selection
            document.querySelectorAll('.custom-title-button').forEach(btn => {
                btn.style.background = btn.style.background.replace('0.4', '0.2');
                btn.style.transform = 'scale(1)';
            });

            event.target.closest('.custom-title-button').style.background = event.target.closest('.custom-title-button').style.background.replace('0.2', '0.4');
            event.target.closest('.custom-title-button').style.transform = 'scale(1.05)';

            // Show selected custom title display
            const display = document.getElementById('selectedCustomTitleDisplay');
            const info = document.getElementById('selectedCustomTitleInfo');
            
            display.style.display = 'block';
            display.style.background = `rgba(${hexToRgb(title.color)}, 0.1)`;
            display.style.border = `1px solid rgba(${hexToRgb(title.color)}, 0.3)`;
            
            info.innerHTML = `<span style="color: ${title.color};">${title.name}</span>${title.description ? `<br><small style="color: #94a3b8; font-weight: normal;">${title.description}</small>` : ''}`;
            info.style.color = title.color;

            updateBulkScheduleButton();
            showNotification(`Selected custom title: "${title.name}"`, 'success');
        }

        function deleteCustomTitle(titleId, event) {
            event.stopPropagation();
            
            if (confirm('Are you sure you want to delete this custom title?')) {
                let customTitles = JSON.parse(localStorage.getItem('marketpace_custom_titles') || '[]');
                customTitles = customTitles.filter(title => title.id !== titleId);
                localStorage.setItem('marketpace_custom_titles', JSON.stringify(customTitles));
                
                loadCustomTitles();
                showNotification('Custom title deleted', 'success');
            }
        }

        function clearCustomTitleSelection() {
            selectedCustomTitle = null;
            
            // Update visual selection
            document.querySelectorAll('.custom-title-button').forEach(btn => {
                btn.style.background = btn.style.background.replace('0.4', '0.2');
                btn.style.transform = 'scale(1)';
            });

            // Hide selected custom title display
            document.getElementById('selectedCustomTitleDisplay').style.display = 'none';
            
            updateBulkScheduleButton();
            showNotification('Custom title selection cleared', 'success');
        }

        function hexToRgb(hex) {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? `${parseInt(result[1], 16)}, ${parseInt(result[2], 16)}, ${parseInt(result[3], 16)}` : '255, 255, 255';
        }

        // Custom Role Management System
        function showCustomRoleModal() {
            document.getElementById('customRoleModal').style.display = 'flex';
            document.getElementById('customRoleName').focus();
        }

        function closeCustomRoleModal() {
            document.getElementById('customRoleModal').style.display = 'none';
            document.getElementById('customRoleForm').reset();
            document.getElementById('selectedCustomRoleColor').value = '#8a2be2';
            updateCustomRoleColorSelection();
        }

        function selectCustomRoleColor(color) {
            document.getElementById('selectedCustomRoleColor').value = color;
            updateCustomRoleColorSelection();
        }

        function updateCustomRoleColorSelection() {
            const selectedColor = document.getElementById('selectedCustomRoleColor').value;
            document.querySelectorAll('.role-color-option').forEach(btn => {
                if (btn.dataset.color === selectedColor) {
                    btn.style.border = '3px solid white';
                    btn.style.boxShadow = `0 0 15px ${selectedColor}`;
                } else {
                    btn.style.border = '2px solid rgba(255,255,255,0.2)';
                    btn.style.boxShadow = 'none';
                }
            });
        }

        function createCustomRole(event) {
            event.preventDefault();
            
            const roleName = document.getElementById('customRoleName').value.trim();
            const roleColor = document.getElementById('selectedCustomRoleColor').value;
            const roleDescription = document.getElementById('customRoleDescription').value.trim();
            
            if (!roleName) {
                showNotification('Please enter a role name', 'error');
                return;
            }

            // Check for duplicate role names
            const existingRoles = JSON.parse(localStorage.getItem('marketpace_custom_roles') || '[]');
            if (existingRoles.some(role => role.name.toLowerCase() === roleName.toLowerCase())) {
                showNotification('Role name already exists', 'error');
                return;
            }

            const customRole = {
                id: Date.now().toString(),
                name: roleName,
                color: roleColor,
                description: roleDescription,
                created: new Date().toISOString()
            };

            // Save to localStorage
            existingRoles.push(customRole);
            localStorage.setItem('marketpace_custom_roles', JSON.stringify(existingRoles));

            // Refresh displays
            loadCustomRoles();
            updateRoleFilters();
            populateRoleDropdown();
            
            // Close modal and show success
            closeCustomRoleModal();
            showNotification(`Custom role "${roleName}" created and added to role options`, 'success');
        }

        function loadCustomRoles() {
            const customRoles = JSON.parse(localStorage.getItem('marketpace_custom_roles') || '[]');
            const container = document.getElementById('customRolesList');
            
            if (customRoles.length === 0) {
                container.innerHTML = '<span style="color: #94a3b8; font-style: italic; font-size: 12px; padding: 8px; display: block; text-align: center;">No custom roles yet. Click "+ Add Role" to create one.</span>';
                return;
            }

            container.innerHTML = '';
            customRoles.forEach(role => {
                const roleButton = document.createElement('div');
                roleButton.className = 'custom-role-button';
                roleButton.style.cssText = `
                    background: rgba(${hexToRgb(role.color)}, 0.2);
                    border: 2px solid rgba(${hexToRgb(role.color)}, 0.5);
                    color: ${role.color};
                    padding: 8px 12px;
                    border-radius: 6px;
                    text-align: center;
                    font-weight: bold;
                    font-size: 12px;
                    position: relative;
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    gap: 2px;
                `;

                roleButton.innerHTML = `
                    <span style="font-size: 12px; font-weight: bold;">${role.name}</span>
                    ${role.description ? `<small style="font-weight: normal; opacity: 0.8; font-size: 10px;">${role.description}</small>` : ''}
                    <button onclick="deleteCustomRole('${role.id}', event)" style="position: absolute; top: -6px; right: -6px; width: 18px; height: 18px; border-radius: 50%; background: #ff4444; border: none; color: white; font-size: 10px; cursor: pointer; display: none;">×</button>
                `;

                // Add hover effects
                roleButton.onmouseenter = function() {
                    this.style.background = `rgba(${hexToRgb(role.color)}, 0.4)`;
                    this.style.transform = 'scale(1.05)';
                    this.querySelector('button').style.display = 'flex';
                };

                roleButton.onmouseleave = function() {
                    this.style.background = `rgba(${hexToRgb(role.color)}, 0.2)`;
                    this.style.transform = 'scale(1)';
                    this.querySelector('button').style.display = 'none';
                };

                container.appendChild(roleButton);
            });
        }

        function deleteCustomRole(roleId, event) {
            event.stopPropagation();
            
            if (confirm('Are you sure you want to delete this custom role?')) {
                let customRoles = JSON.parse(localStorage.getItem('marketpace_custom_roles') || '[]');
                customRoles = customRoles.filter(role => role.id !== roleId);
                localStorage.setItem('marketpace_custom_roles', JSON.stringify(customRoles));
                
                loadCustomRoles();
                updateRoleFilters();
                populateRoleDropdown();
                showNotification('Custom role deleted', 'success');
            }
        }

        function updateRoleFilters() {
            const customRoles = JSON.parse(localStorage.getItem('marketpace_custom_roles') || '[]');
            const filter = document.getElementById('modalRoleFilter');
            
            if (!filter) return;
            
            // Remove existing custom options
            const existingCustomOptions = filter.querySelectorAll('.custom-role-option');
            existingCustomOptions.forEach(option => option.remove());
            
            // Add custom roles to filter
            customRoles.forEach(role => {
                const option = document.createElement('option');
                option.value = role.name;
                option.textContent = role.name;
                option.className = 'custom-role-option';
                filter.appendChild(option);
            });
        }



        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Business Scheduling page loaded successfully');
            initializeVoiceRecognition();
            initializeDragAndDrop();
            initializeSmartEmployeeManagement();
            loadCustomTitles();
            loadCustomRoles();
            updateCustomTitleColorSelection();
            updateRoleFilters();
            
            // Initialize with small scale
            setEventScale('small');
            
            showNotification('Festival-scale scheduling system ready', 'success');
            
            // Welcome message
            setTimeout(() => {
                updateVoiceOutput('🚀 Sleek voice assistant ready - click "Command" to begin');
            }, 1000);
        });
    </script>

    <!-- Add Employee Modal -->
    <div id="addEmployeeModal" style="display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.8); z-index: 1000; align-items: center; justify-content: center;">
        <div style="background: linear-gradient(135deg, #1a1a2e, #16213e); border: 2px solid #00ffff; border-radius: 16px; max-width: 500px; width: 90%; padding: 24px; position: relative;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="color: #00ffff; margin: 0;">Add New Employee</h3>
                <button onclick="closeAddEmployeeModal()" style="background: transparent; border: none; color: #00ffff; font-size: 24px; cursor: pointer; padding: 0; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center;">×</button>
            </div>
            
            <form id="addEmployeeForm" onsubmit="addNewEmployee(event)">
                <div style="margin-bottom: 20px;">
                    <label style="display: block; color: #94a3b8; margin-bottom: 8px; font-weight: 500;">Full Name *</label>
                    <input type="text" id="newEmployeeName" placeholder="Enter employee name" required style="width: 100%; padding: 12px; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; background: rgba(0,0,0,0.3); color: white; font-size: 16px;">
                </div>

                <div style="margin-bottom: 20px;">
                    <label style="display: block; color: #94a3b8; margin-bottom: 8px; font-weight: 500;">Role *</label>
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <select id="newEmployeeRole" required style="flex: 1; padding: 12px; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; background: rgba(0,0,0,0.3); color: white; font-size: 16px;">
                            <option value="">Select Role</option>
                            <option value="Manager">Manager</option>
                            <option value="Cashier">Cashier</option>
                            <option value="Sales">Sales Associate</option>
                            <option value="Stock">Stock Clerk</option>
                            <option value="Assistant">Assistant</option>
                            <option value="Security">Security</option>
                            <!-- Custom roles will be added here -->
                        </select>
                        <button type="button" onclick="showCustomRoleModal()" style="background: rgba(138,43,226,0.2); border: 1px solid rgba(138,43,226,0.5); color: #8a2be2; padding: 12px; border-radius: 8px; cursor: pointer; font-size: 12px; white-space: nowrap;">+ Role</button>
                    </div>
                </div>

                <div style="margin-bottom: 20px;">
                    <label style="display: block; color: #94a3b8; margin-bottom: 8px; font-weight: 500;">Position Category *</label>
                    <select id="newEmployeeCategory" required style="width: 100%; padding: 12px; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; background: rgba(0,0,0,0.3); color: white; font-size: 16px;">
                        <option value="">Select Category</option>
                        <option value="Employee">Employee</option>
                        <option value="Volunteer">Volunteer</option>
                        <option value="Independent Contractor">Independent Contractor</option>
                    </select>
                </div>

                <div style="margin-bottom: 20px;">
                    <label style="display: block; color: #94a3b8; margin-bottom: 8px; font-weight: 500;">Email Address</label>
                    <input type="email" id="newEmployeeEmail" placeholder="employee@example.com" style="width: 100%; padding: 12px; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; background: rgba(0,0,0,0.3); color: white; font-size: 16px;">
                </div>

                <div style="margin-bottom: 20px;">
                    <label style="display: block; color: #94a3b8; margin-bottom: 8px; font-weight: 500;">Phone Number</label>
                    <input type="tel" id="newEmployeePhone" placeholder="(555) 123-4567" style="width: 100%; padding: 12px; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; background: rgba(0,0,0,0.3); color: white; font-size: 16px;">
                </div>

                <div style="display: flex; gap: 12px; justify-content: center;">
                    <button type="button" onclick="closeAddEmployeeModal()" style="background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 12px 24px; border-radius: 8px; cursor: pointer;">Cancel</button>
                    <button type="submit" style="background: linear-gradient(135deg, #00ffff, #4169e1); border: none; color: white; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: bold;">Add Employee</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Custom Role Modal -->
    <div id="customRoleModal" style="display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.8); z-index: 1000; align-items: center; justify-content: center;">
        <div style="background: linear-gradient(135deg, #1a1a2e, #16213e); border: 2px solid #8a2be2; border-radius: 16px; max-width: 500px; width: 90%; padding: 24px; position: relative;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="color: #8a2be2; margin: 0;">Create Custom Role</h3>
                <button onclick="closeCustomRoleModal()" style="background: transparent; border: none; color: #8a2be2; font-size: 24px; cursor: pointer; padding: 0; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center;">×</button>
            </div>
            
            <form id="customRoleForm" onsubmit="createCustomRole(event)">
                <div style="margin-bottom: 20px;">
                    <label style="display: block; color: #94a3b8; margin-bottom: 8px; font-weight: 500;">Role Name</label>
                    <input type="text" id="customRoleName" placeholder="e.g., Artist, Band Member, Vendor, Food Truck, Security" required style="width: 100%; padding: 12px; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; background: rgba(0,0,0,0.3); color: white; font-size: 16px;">
                    <small style="color: #94a3b8; font-style: italic; margin-top: 4px; display: block;">Perfect for festivals, events, venues, and specialized teams</small>
                </div>

                <div style="margin-bottom: 20px;">
                    <label style="display: block; color: #94a3b8; margin-bottom: 8px; font-weight: 500;">Color Theme</label>
                    <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                        <button type="button" onclick="selectCustomRoleColor('#8a2be2')" class="role-color-option" data-color="#8a2be2" style="width: 40px; height: 40px; border: 2px solid rgba(255,255,255,0.2); border-radius: 8px; background: #8a2be2; cursor: pointer;"></button>
                        <button type="button" onclick="selectCustomRoleColor('#e74c3c')" class="role-color-option" data-color="#e74c3c" style="width: 40px; height: 40px; border: 2px solid rgba(255,255,255,0.2); border-radius: 8px; background: #e74c3c; cursor: pointer;"></button>
                        <button type="button" onclick="selectCustomRoleColor('#3498db')" class="role-color-option" data-color="#3498db" style="width: 40px; height: 40px; border: 2px solid rgba(255,255,255,0.2); border-radius: 8px; background: #3498db; cursor: pointer;"></button>
                        <button type="button" onclick="selectCustomRoleColor('#2ecc71')" class="role-color-option" data-color="#2ecc71" style="width: 40px; height: 40px; border: 2px solid rgba(255,255,255,0.2); border-radius: 8px; background: #2ecc71; cursor: pointer;"></button>
                        <button type="button" onclick="selectCustomRoleColor('#f39c12')" class="role-color-option" data-color="#f39c12" style="width: 40px; height: 40px; border: 2px solid rgba(255,255,255,0.2); border-radius: 8px; background: #f39c12; cursor: pointer;"></button>
                        <button type="button" onclick="selectCustomRoleColor('#9b59b6')" class="role-color-option" data-color="#9b59b6" style="width: 40px; height: 40px; border: 2px solid rgba(255,255,255,0.2); border-radius: 8px; background: #9b59b6; cursor: pointer;"></button>
                    </div>
                    <input type="hidden" id="selectedCustomRoleColor" value="#8a2be2">
                </div>

                <div style="margin-bottom: 20px;">
                    <label style="display: block; color: #94a3b8; margin-bottom: 8px; font-weight: 500;">Description (Optional)</label>
                    <textarea id="customRoleDescription" placeholder="Brief description of this role's responsibilities..." style="width: 100%; padding: 12px; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; background: rgba(0,0,0,0.3); color: white; resize: vertical; min-height: 60px;"></textarea>
                </div>

                <div style="display: flex; gap: 12px; justify-content: center;">
                    <button type="button" onclick="closeCustomRoleModal()" style="background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 12px 24px; border-radius: 8px; cursor: pointer;">Cancel</button>
                    <button type="submit" style="background: linear-gradient(135deg, #8a2be2, #4169e1); border: none; color: white; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: bold;">Create Role</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Custom Schedule Title Modal -->
    <div id="customTitleModal" style="display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.8); z-index: 1000; align-items: center; justify-content: center;">
        <div style="background: linear-gradient(135deg, #1a1a2e, #16213e); border: 2px solid #ffd700; border-radius: 16px; max-width: 500px; width: 90%; padding: 24px; position: relative;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="color: #ffd700; margin: 0;">Create Custom Schedule Title</h3>
                <button onclick="closeCustomTitleModal()" style="background: transparent; border: none; color: #ffd700; font-size: 24px; cursor: pointer; padding: 0; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center;">×</button>
            </div>
            
            <form id="customTitleForm" onsubmit="createCustomTitle(event)">
                <div style="margin-bottom: 20px;">
                    <label style="display: block; color: #94a3b8; margin-bottom: 8px; font-weight: 500;">Schedule Title</label>
                    <input type="text" id="customTitleName" placeholder="e.g., Opening Shift, Floor Coverage, VIP Service" required style="width: 100%; padding: 12px; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; background: rgba(0,0,0,0.3); color: white; font-size: 16px;">
                    <small style="color: #94a3b8; font-style: italic; margin-top: 4px; display: block;">This will appear as the primary schedule title for your team members</small>
                </div>

                <div style="margin-bottom: 20px;">
                    <label style="display: block; color: #94a3b8; margin-bottom: 8px; font-weight: 500;">Color Theme</label>
                    <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                        <button type="button" onclick="selectCustomTitleColor('#ffd700')" class="title-color-option" data-color="#ffd700" style="width: 40px; height: 40px; border: 2px solid rgba(255,255,255,0.2); border-radius: 8px; background: #ffd700; cursor: pointer;"></button>
                        <button type="button" onclick="selectCustomTitleColor('#00ffff')" class="title-color-option" data-color="#00ffff" style="width: 40px; height: 40px; border: 2px solid rgba(255,255,255,0.2); border-radius: 8px; background: #00ffff; cursor: pointer;"></button>
                        <button type="button" onclick="selectCustomTitleColor('#ff6b9d')" class="title-color-option" data-color="#ff6b9d" style="width: 40px; height: 40px; border: 2px solid rgba(255,255,255,0.2); border-radius: 8px; background: #ff6b9d; cursor: pointer;"></button>
                        <button type="button" onclick="selectCustomTitleColor('#00ff88')" class="title-color-option" data-color="#00ff88" style="width: 40px; height: 40px; border: 2px solid rgba(255,255,255,0.2); border-radius: 8px; background: #00ff88; cursor: pointer;"></button>
                        <button type="button" onclick="selectCustomTitleColor('#9b59b6')" class="title-color-option" data-color="#9b59b6" style="width: 40px; height: 40px; border: 2px solid rgba(255,255,255,0.2); border-radius: 8px; background: #9b59b6; cursor: pointer;"></button>
                        <button type="button" onclick="selectCustomTitleColor('#e74c3c')" class="title-color-option" data-color="#e74c3c" style="width: 40px; height: 40px; border: 2px solid rgba(255,255,255,0.2); border-radius: 8px; background: #e74c3c; cursor: pointer;"></button>
                    </div>
                    <input type="hidden" id="selectedCustomTitleColor" value="#ffd700">
                </div>

                <div style="margin-bottom: 20px;">
                    <label style="display: block; color: #94a3b8; margin-bottom: 8px; font-weight: 500;">Description (Optional)</label>
                    <textarea id="customTitleDescription" placeholder="Brief description of this role or responsibility..." style="width: 100%; padding: 12px; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; background: rgba(0,0,0,0.3); color: white; resize: vertical; min-height: 60px;"></textarea>
                </div>

                <div style="display: flex; gap: 12px; justify-content: center;">
                    <button type="button" onclick="closeCustomTitleModal()" style="background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 12px 24px; border-radius: 8px; cursor: pointer;">Cancel</button>
                    <button type="submit" style="background: linear-gradient(135deg, #ffd700, #4169e1); border: none; color: white; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: bold;">Create Title</button>
                </div>
            </form>
        </div>
    </div>

        </div> <!-- Close tab-container -->
    </div> <!-- Close main container -->
</body>
</html>