<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Platform Integrations - MarketPace</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0d0221 0%, #1a0845 50%, #2d1b69 100%);
            color: white;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        /* Floating particles background */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: rgba(0, 255, 255, 0.6);
            border-radius: 50%;
            animation: float 6s infinite ease-in-out;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); opacity: 1; }
            50% { transform: translateY(-20px) rotate(180deg); opacity: 0.8; }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 2;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, #00ffff, #ff6b35);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            color: rgba(255, 255, 255, 0.8);
        }

        .integration-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .integration-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .integration-card:hover {
            transform: translateY(-5px);
            border-color: rgba(0, 255, 255, 0.3);
            box-shadow: 0 10px 30px rgba(0, 255, 255, 0.2);
        }

        .integration-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #00ffff, #ff6b35);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .integration-card:hover::before {
            opacity: 1;
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .card-icon {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
        }

        .facebook-icon { background: linear-gradient(135deg, #1877f2, #42a5f5); }
        .google-icon { background: linear-gradient(135deg, #4285f4, #34a853); }
        .etsy-icon { background: linear-gradient(135deg, #f16521, #ff8a65); }
        .doordash-icon { background: linear-gradient(135deg, #ff3008, #ff6b35); }
        .uber-icon { background: linear-gradient(135deg, #000000, #333333); }
        .ticketmaster-icon { background: linear-gradient(135deg, #026cdf, #1976d2); }

        .card-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #00ffff;
        }

        .card-description {
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .connection-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 8px;
            font-size: 14px;
        }

        .status-connected {
            background: rgba(34, 197, 94, 0.2);
            border: 1px solid rgba(34, 197, 94, 0.3);
            color: #22c55e;
        }

        .status-disconnected {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #ef4444;
        }

        .status-sandbox {
            background: rgba(251, 191, 36, 0.2);
            border: 1px solid rgba(251, 191, 36, 0.3);
            color: #fbbf24;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #00ffff, #0891b2);
            color: white;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .capabilities-list {
            margin-top: 15px;
        }

        .capabilities-list h4 {
            color: #00ffff;
            font-size: 14px;
            margin-bottom: 8px;
        }

        .capabilities-list ul {
            list-style: none;
            padding: 0;
        }

        .capabilities-list li {
            color: rgba(255, 255, 255, 0.7);
            font-size: 13px;
            margin-bottom: 4px;
            padding-left: 15px;
            position: relative;
        }

        .capabilities-list li::before {
            content: '✓';
            position: absolute;
            left: 0;
            color: #22c55e;
            font-weight: bold;
        }

        .back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            background: linear-gradient(135deg, #00ffff, #9d4edd);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 100;
        }

        .back-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 255, 0.3);
        }

        @media (max-width: 768px) {
            .integration-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .container {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="particles" id="particles"></div>
    
    <button class="back-button" onclick="window.history.back()">
        ← Back to Dashboard
    </button>

    <div class="container">
        <div class="header">
            <h1>Platform Integrations</h1>
            <p>Connect your existing accounts and platforms to expand your MarketPace presence</p>
        </div>

        <div class="integration-grid">
            <!-- Facebook Integration -->
            <div class="integration-card">
                <div class="card-header">
                    <div class="card-icon facebook-icon">f</div>
                    <div class="card-title">Facebook</div>
                </div>
                <div class="card-description">
                    Connect your Facebook account to enable social login and cross-post your MarketPace listings to Facebook Marketplace automatically.
                </div>
                <div class="connection-status status-disconnected" id="facebook-status">
                    <span>●</span> Not Connected
                </div>
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="connectFacebook()">Connect Facebook</button>
                    <button class="btn btn-secondary" onclick="testFacebookAPI()">Test Connection</button>
                </div>
                <div class="capabilities-list">
                    <h4>Features:</h4>
                    <ul>
                        <li>Social login with Facebook account</li>
                        <li>Auto-post listings to Facebook Marketplace</li>
                        <li>Sync customer messages and inquiries</li>
                    </ul>
                </div>
            </div>

            <!-- Google Integration -->
            <div class="integration-card">
                <div class="card-header">
                    <div class="card-icon google-icon">G</div>
                    <div class="card-title">Google</div>
                </div>
                <div class="card-description">
                    Connect your Google account for seamless authentication and access to Google services integration.
                </div>
                <div class="connection-status status-disconnected" id="google-status">
                    <span>●</span> Not Connected
                </div>
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="connectGoogle()">Connect Google</button>
                    <button class="btn btn-secondary" onclick="testGoogleAPI()">Test Connection</button>
                </div>
                <div class="capabilities-list">
                    <h4>Features:</h4>
                    <ul>
                        <li>Social login with Google account</li>
                        <li>Google Analytics integration</li>
                        <li>Google My Business synchronization</li>
                    </ul>
                </div>
            </div>

            <!-- Etsy Integration -->
            <div class="integration-card">
                <div class="card-header">
                    <div class="card-icon etsy-icon">E</div>
                    <div class="card-title">Etsy Shop</div>
                </div>
                <div class="card-description">
                    Sync your existing Etsy shop with MarketPace to manage inventory and orders from both platforms seamlessly.
                </div>
                <div class="connection-status status-disconnected" id="etsy-status">
                    <span>●</span> Not Connected
                </div>
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="connectEtsy()">Connect Etsy Shop</button>
                    <button class="btn btn-secondary" onclick="testEtsyAPI()">Test Connection</button>
                </div>
                <div class="capabilities-list">
                    <h4>Features:</h4>
                    <ul>
                        <li>Sync product inventory between platforms</li>
                        <li>Unified order management</li>
                        <li>Automatic pricing updates</li>
                    </ul>
                </div>
            </div>

            <!-- DoorDash Integration -->
            <div class="integration-card">
                <div class="card-header">
                    <div class="card-icon doordash-icon">DD</div>
                    <div class="card-title">DoorDash Drive</div>
                </div>
                <div class="card-description">
                    Integrate with DoorDash Drive API for enhanced delivery services and restaurant/food business integration.
                </div>
                <div class="connection-status status-sandbox" id="doordash-status">
                    <span>●</span> Sandbox Mode (Production Pending)
                </div>
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="connectDoorDash()">Connect DoorDash</button>
                    <button class="btn btn-secondary" onclick="testDoorDashAPI()">Test Sandbox</button>
                </div>
                <div class="capabilities-list">
                    <h4>Features:</h4>
                    <ul>
                        <li>Enhanced delivery tracking</li>
                        <li>Restaurant integration for food businesses</li>
                        <li>Order management and analytics</li>
                    </ul>
                </div>
            </div>

            <!-- Uber Eats Integration -->
            <div class="integration-card">
                <div class="card-header">
                    <div class="card-icon uber-icon">UE</div>
                    <div class="card-title">Uber Eats</div>
                </div>
                <div class="card-description">
                    Connect your restaurant or food business with Uber Eats for expanded delivery coverage and order management.
                </div>
                <div class="connection-status status-disconnected" id="uber-eats-status">
                    <span>●</span> Not Connected
                </div>
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="connectUberEats()">Connect Uber Eats</button>
                    <button class="btn btn-secondary" onclick="testUberEatsAPI()">Test Connection</button>
                </div>
                <div class="capabilities-list">
                    <h4>Features:</h4>
                    <ul>
                        <li>Menu management synchronization</li>
                        <li>Real-time order tracking</li>
                        <li>Revenue analytics and reporting</li>
                    </ul>
                </div>
            </div>

            <!-- Ticketmaster Integration -->
            <div class="integration-card">
                <div class="card-header">
                    <div class="card-icon ticketmaster-icon">TM</div>
                    <div class="card-title">Ticketmaster</div>
                </div>
                <div class="card-description">
                    Legal ticket sales integration for entertainers and venues. Ensure compliance with ticket resale regulations.
                </div>
                <div class="connection-status status-disconnected" id="ticketmaster-status">
                    <span>●</span> Not Connected
                </div>
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="connectTicketmaster()">Connect Venue</button>
                    <button class="btn btn-secondary" onclick="testTicketmasterAPI()">Test Connection</button>
                </div>
                <div class="capabilities-list">
                    <h4>Features:</h4>
                    <ul>
                        <li>Legal compliance for ticket sales</li>
                        <li>Venue and event management</li>
                        <li>Official ticket distribution</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Create floating particles
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            const numberOfParticles = 50;

            for (let i = 0; i < numberOfParticles; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 6 + 's';
                particle.style.animationDuration = (Math.random() * 3 + 3) + 's';
                particlesContainer.appendChild(particle);
            }
        }

        // Initialize particles
        createParticles();

        // Integration connection functions
        async function connectFacebook() {
            try {
                updateStatus('facebook-status', 'Connecting...', 'status-sandbox');
                
                // Simulate Facebook OAuth flow
                const response = await fetch('/api/integrations/facebook/connect', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        accessToken: 'demo_fb_token_' + Date.now(),
                        userID: 'demo_user_' + Date.now()
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    updateStatus('facebook-status', 'Connected Successfully', 'status-connected');
                    showNotification('Facebook connected successfully!', 'success');
                } else {
                    updateStatus('facebook-status', 'Connection Failed', 'status-disconnected');
                    showNotification('Failed to connect Facebook: ' + result.message, 'error');
                }
            } catch (error) {
                updateStatus('facebook-status', 'Connection Error', 'status-disconnected');
                showNotification('Error connecting Facebook: ' + error.message, 'error');
            }
        }

        async function connectGoogle() {
            try {
                updateStatus('google-status', 'Connecting...', 'status-sandbox');
                
                const response = await fetch('/api/integrations/google/connect', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        accessToken: 'demo_google_token_' + Date.now(),
                        idToken: 'demo_id_token_' + Date.now()
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    updateStatus('google-status', 'Connected Successfully', 'status-connected');
                    showNotification('Google connected successfully!', 'success');
                } else {
                    updateStatus('google-status', 'Connection Failed', 'status-disconnected');
                    showNotification('Failed to connect Google: ' + result.message, 'error');
                }
            } catch (error) {
                updateStatus('google-status', 'Connection Error', 'status-disconnected');
                showNotification('Error connecting Google: ' + error.message, 'error');
            }
        }

        async function connectEtsy() {
            const shopId = prompt('Enter your Etsy Shop ID:');
            const apiKey = prompt('Enter your Etsy API Key:');
            
            if (!shopId || !apiKey) return;
            
            try {
                updateStatus('etsy-status', 'Connecting...', 'status-sandbox');
                
                const response = await fetch('/api/integrations/etsy/connect', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ shopId, apiKey })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    updateStatus('etsy-status', 'Connected Successfully', 'status-connected');
                    showNotification('Etsy shop connected successfully!', 'success');
                } else {
                    updateStatus('etsy-status', 'Connection Failed', 'status-disconnected');
                    showNotification('Failed to connect Etsy: ' + result.message, 'error');
                }
            } catch (error) {
                updateStatus('etsy-status', 'Connection Error', 'status-disconnected');
                showNotification('Error connecting Etsy: ' + error.message, 'error');
            }
        }

        async function connectDoorDash() {
            const businessId = prompt('Enter your DoorDash Business ID:');
            
            if (!businessId) return;
            
            try {
                updateStatus('doordash-status', 'Connecting...', 'status-sandbox');
                
                const response = await fetch('/api/integrations/doordash/connect', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        businessId, 
                        accessToken: 'demo_doordash_token_' + Date.now() 
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    updateStatus('doordash-status', 'Connected (Sandbox)', 'status-sandbox');
                    showNotification('DoorDash connected in sandbox mode!', 'success');
                } else {
                    updateStatus('doordash-status', 'Connection Failed', 'status-disconnected');
                    showNotification('Failed to connect DoorDash: ' + result.message, 'error');
                }
            } catch (error) {
                updateStatus('doordash-status', 'Connection Error', 'status-disconnected');
                showNotification('Error connecting DoorDash: ' + error.message, 'error');
            }
        }

        async function connectUberEats() {
            try {
                showNotification('Initiating Uber Eats OAuth authentication...', 'info');
                updateStatus('uber-eats-status', 'Starting OAuth...', 'status-sandbox');
                
                // Get OAuth authorization URL from your integration steps
                const authResponse = await fetch('/api/integrations/uber-eats/auth');
                const authData = await authResponse.json();
                
                if (authData.success && authData.authUrl) {
                    showNotification('Redirecting to Uber Eats authorization...', 'info');
                    
                    // Open OAuth flow in new window - uses the exact flow from your attached steps
                    const popup = window.open(
                        authData.authUrl,
                        'uber-eats-auth',
                        'width=600,height=700,scrollbars=yes,resizable=yes'
                    );
                    
                    // Monitor for OAuth completion
                    const checkClosed = setInterval(() => {
                        if (popup.closed) {
                            clearInterval(checkClosed);
                            updateStatus('uber-eats-status', 'Checking connection...', 'status-sandbox');
                            
                            // Check if integration was successful
                            setTimeout(() => {
                                testUberEatsAPI();
                                loadConnections();
                            }, 1000);
                        }
                    }, 1000);
                } else {
                    throw new Error(authData.message || 'Failed to get authorization URL');
                }
            } catch (error) {
                console.error('Uber Eats connection error:', error);
                updateStatus('uber-eats-status', 'Connection Failed', 'status-disconnected');
                showNotification('Failed to connect Uber Eats: ' + error.message, 'error');
            }
        }

        async function connectTicketmaster() {
            const venueId = prompt('Enter your Ticketmaster Venue ID:');
            const partnerApiKey = prompt('Enter your Ticketmaster Partner API Key:');
            
            if (!venueId || !partnerApiKey) return;
            
            try {
                updateStatus('ticketmaster-status', 'Connecting...', 'status-sandbox');
                
                const response = await fetch('/api/integrations/ticketmaster/connect', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ venueId, partnerApiKey })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    updateStatus('ticketmaster-status', 'Connected Successfully', 'status-connected');
                    showNotification('Ticketmaster venue connected successfully!', 'success');
                } else {
                    updateStatus('ticketmaster-status', 'Connection Failed', 'status-disconnected');
                    showNotification('Failed to connect Ticketmaster: ' + result.message, 'error');
                }
            } catch (error) {
                updateStatus('ticketmaster-status', 'Connection Error', 'status-disconnected');
                showNotification('Error connecting Ticketmaster: ' + error.message, 'error');
            }
        }

        // Test API functions
        async function testFacebookAPI() {
            showNotification('Testing Facebook API connection...', 'info');
        }

        async function testGoogleAPI() {
            showNotification('Testing Google API connection...', 'info');
        }

        async function testEtsyAPI() {
            showNotification('Testing Etsy API connection...', 'info');
        }

        async function testDoorDashAPI() {
            showNotification('Testing DoorDash sandbox environment...', 'info');
        }

        async function testUberEatsAPI() {
            try {
                showNotification('Testing Uber Eats OAuth integration...', 'info');
                
                // Test with stored credentials or check connection status
                const token = localStorage.getItem('uber_eats_access_token');
                
                const headers = {
                    'Content-Type': 'application/json'
                };
                
                if (token) {
                    headers['Authorization'] = `Bearer ${token}`;
                }
                
                const response = await fetch('/api/integrations/uber-eats/test', {
                    method: 'GET',
                    headers
                });
                
                const result = await response.json();
                
                if (result.success && result.status === 'connected') {
                    updateStatus('uber-eats-status', 'Connected ✓', 'status-connected');
                    showNotification('Uber Eats OAuth integration working successfully!', 'success');
                    
                    if (result.user_info) {
                        showNotification(`Connected as: ${result.user_info.first_name} ${result.user_info.last_name}`, 'info');
                    }
                    
                    // Show available actions
                    console.log('Available Uber Eats actions:', result.available_actions);
                } else if (result.status === 'not_connected') {
                    updateStatus('uber-eats-status', 'OAuth Required', 'status-disconnected');
                    showNotification('Uber Eats OAuth flow needed. Click Connect to start.', 'info');
                    
                    if (result.next_steps) {
                        console.log('OAuth setup steps:', result.next_steps);
                    }
                } else {
                    updateStatus('uber-eats-status', 'Connection Failed', 'status-error');
                    showNotification('Uber Eats test failed: ' + result.error, 'error');
                }
            } catch (error) {
                console.error('Uber Eats test error:', error);
                updateStatus('uber-eats-status', 'Test Failed', 'status-error');
                showNotification('Failed to test Uber Eats connection: ' + error.message, 'error');
            }
        }

        async function testTicketmasterAPI() {
            showNotification('Testing Ticketmaster API connection...', 'info');
        }

        // Helper functions
        function updateStatus(elementId, text, statusClass) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<span>●</span> ${text}`;
            element.className = `connection-status ${statusClass}`;
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 8px;
                color: white;
                font-weight: bold;
                z-index: 1000;
                max-width: 350px;
                backdrop-filter: blur(10px);
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            `;
            
            switch (type) {
                case 'success':
                    notification.style.background = 'linear-gradient(135deg, #22c55e, #16a34a)';
                    break;
                case 'error':
                    notification.style.background = 'linear-gradient(135deg, #ef4444, #dc2626)';
                    break;
                default:
                    notification.style.background = 'linear-gradient(135deg, #3b82f6, #1d4ed8)';
            }
            
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }

        // Load existing connections on page load
        async function loadConnections() {
            try {
                const response = await fetch('/api/integrations/user/connections');
                const result = await response.json();
                
                if (result.success && result.connections) {
                    result.connections.forEach(connection => {
                        const statusId = connection.platform + '-status';
                        const statusClass = connection.status === 'active' ? 'status-connected' : 
                                          connection.status === 'sandbox' ? 'status-sandbox' : 'status-disconnected';
                        const statusText = connection.status === 'active' ? 'Connected' : 
                                         connection.status === 'sandbox' ? 'Connected (Sandbox)' : 'Not Connected';
                        
                        updateStatus(statusId, statusText, statusClass);
                    });
                }
            } catch (error) {
                console.error('Error loading connections:', error);
            }
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            loadConnections();
        });
    </script>
</body>
</html>