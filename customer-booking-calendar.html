<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Service - MarketPace Pro</title>
    <style>
        body {
            background: linear-gradient(135deg, #1a0b3d, #6b46c1);
            color: white;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .pro-badge {
            background: linear-gradient(135deg, #ffd700, #f59e0b);
            color: #1a0b3d;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            display: inline-block;
            margin-bottom: 10px;
        }

        .provider-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
        }

        .provider-info {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .provider-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, #00ffff, #10b981);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            color: #1a0b3d;
            font-weight: bold;
        }

        .rating {
            color: #ffd700;
            font-size: 18px;
        }

        .calendar-container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
        }

        .month-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .nav-btn {
            background: #10b981;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin-bottom: 30px;
        }

        .day-header {
            text-align: center;
            font-weight: bold;
            color: #00ffff;
            padding: 10px 5px;
        }

        .calendar-day {
            aspect-ratio: 1;
            border: 2px solid transparent;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            background: rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
            position: relative;
        }

        .calendar-day.available {
            background: rgba(16, 185, 129, 0.3);
            border-color: #10b981;
        }

        .calendar-day.available:hover {
            border-color: #00ffff;
            background: rgba(0, 255, 255, 0.1);
        }

        .calendar-day.unavailable {
            background: rgba(107, 114, 128, 0.3);
            cursor: not-allowed;
            opacity: 0.5;
        }

        .time-selection {
            margin-top: 20px;
            display: none;
        }

        .time-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .time-slot {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid transparent;
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .time-slot.available:hover {
            border-color: #00ffff;
        }

        .time-slot.selected {
            background: rgba(16, 185, 129, 0.3);
            border-color: #10b981;
        }

        .time-slot.booked {
            background: rgba(239, 68, 68, 0.3);
            cursor: not-allowed;
            opacity: 0.6;
        }

        .booking-summary {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
        }

        .price-breakdown {
            margin: 20px 0;
        }

        .price-row {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            padding: 8px 0;
        }

        .price-row.total {
            border-top: 2px solid #00ffff;
            font-weight: bold;
            font-size: 18px;
            color: #00ffff;
        }

        .escrow-protection {
            background: linear-gradient(135deg, #ffd700, #f59e0b);
            color: #1a0b3d;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .book-btn {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            width: 100%;
            margin-top: 20px;
        }

        .book-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(16, 185, 129, 0.3);
        }

        .book-btn:disabled {
            background: #6b7280;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .back-btn {
            background: #6b7280;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            margin-bottom: 20px;
        }

        .duration-selector {
            margin: 15px 0;
        }

        .duration-btn {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 2px solid transparent;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s ease;
        }

        .duration-btn.selected {
            background: rgba(16, 185, 129, 0.3);
            border-color: #10b981;
        }
    </style>
</head>
<body>
    <button class="back-btn" onclick="window.location.href='/services'">← Back to Services</button>

    <div class="header">
        <div class="pro-badge">⭐ PRO FEATURE - FREE Until Jan 1, 2026</div>
        <h1 style="color: #00ffff; margin: 0;">Book Service</h1>
    </div>

    <div class="provider-card">
        <div class="provider-info">
            <div class="provider-avatar" id="providerAvatar">DJ</div>
            <div>
                <h2 style="margin: 0; color: #00ffff;" id="providerName">DJ Mike Entertainment</h2>
                <p style="margin: 5px 0; color: #e2e8f0;" id="providerService">Professional DJ Services</p>
                <div class="rating">
                    ⭐⭐⭐⭐⭐ <span style="color: #9ca3af;">4.9/5 (127 reviews)</span>
                </div>
            </div>
        </div>
        
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>
                <p style="margin: 0; color: #00ffff; font-size: 24px; font-weight: bold;" id="hourlyRate">$75/hour</p>
                <p style="margin: 0; color: #9ca3af; font-size: 14px;">Minimum 3 hours</p>
            </div>
            <div id="bookingFeeDisplay" style="display: none;">
                <p style="margin: 0; color: #ffd700; font-size: 16px;">Booking Fee: $<span id="bookingFeeAmount">25</span></p>
                <p style="margin: 0; color: #9ca3af; font-size: 12px;">Secures your date</p>
            </div>
        </div>
    </div>

    <div class="calendar-container">
        <h3 style="color: #ffd700; margin-top: 0;">Select Date</h3>
        
        <div class="month-navigation">
            <button class="nav-btn" onclick="changeMonth(-1)">← Previous</button>
            <h3 id="currentMonth" style="color: #00ffff; margin: 0;"></h3>
            <button class="nav-btn" onclick="changeMonth(1)">Next →</button>
        </div>

        <div class="calendar-grid" id="calendarGrid">
            <!-- Calendar will be generated by JavaScript -->
        </div>

        <div class="time-selection" id="timeSelection">
            <h4 style="color: #00ffff;">Available Times for <span id="selectedDate"></span></h4>
            <div class="time-grid" id="timeGrid">
                <!-- Time slots will be populated here -->
            </div>
            
            <div class="duration-selector">
                <h4 style="color: #00ffff;">Service Duration</h4>
                <button class="duration-btn" onclick="selectDuration(3)" data-hours="3">3 Hours</button>
                <button class="duration-btn" onclick="selectDuration(4)" data-hours="4">4 Hours</button>
                <button class="duration-btn" onclick="selectDuration(6)" data-hours="6">6 Hours</button>
                <button class="duration-btn" onclick="selectDuration(8)" data-hours="8">8 Hours</button>
            </div>
        </div>
    </div>

    <div class="booking-summary" id="bookingSummary" style="display: none;">
        <h3 style="color: #ffd700; margin-top: 0;">Booking Summary</h3>
        
        <div class="price-breakdown">
            <div class="price-row">
                <span>Service Duration:</span>
                <span id="summaryDuration">3 hours</span>
            </div>
            <div class="price-row">
                <span>Service Rate:</span>
                <span id="summaryServiceCost">$225.00</span>
            </div>
            <div class="price-row" id="bookingFeeRow" style="display: none;">
                <span>Booking Fee:</span>
                <span id="summaryBookingFee">$25.00</span>
            </div>
            <div class="price-row">
                <span>Platform Fee (5%):</span>
                <span id="summaryPlatformFee">$11.25</span>
            </div>
            <div class="price-row total">
                <span>Total Amount:</span>
                <span id="summaryTotal">$261.25</span>
            </div>
        </div>

        <div class="escrow-protection">
            <h4 style="margin: 0 0 10px 0;">🛡️ MarketPace Escrow Protection</h4>
            <p style="margin: 0; font-size: 14px;">
                Your payment is held securely until the service provider shows up on your scheduled date. 
                Payment is released when you confirm they arrived - you're paying for their attendance, 
                not job performance. Quality issues are resolved through ratings and direct communication.
            </p>
        </div>

        <button class="book-btn" id="bookBtn" onclick="processBooking()" disabled>
            Select Date & Time to Book
        </button>
    </div>

    <script>
        let currentDate = new Date();
        let selectedDay = null;
        let selectedTime = null;
        let selectedDuration = 3;
        let providerAvailability = {};

        // Load provider data (in real app, this would come from API)
        const providerData = {
            id: 'dj-mike-001',
            name: 'DJ Mike Entertainment',
            service: 'Professional DJ Services',
            hourlyRate: 75,
            minDuration: 3,
            bookingFee: 25,
            hasBookingFee: true,
            avatar: 'DJ',
            rating: 4.9,
            reviews: 127
        };

        // Demo availability data
        function generateDemoAvailability() {
            const today = new Date();
            const availability = {};
            
            // Generate availability for next 60 days
            for (let i = 1; i <= 60; i++) {
                const date = new Date(today);
                date.setDate(today.getDate() + i);
                const dateKey = `${date.getFullYear()}-${date.getMonth() + 1}-${date.getDate()}`;
                
                // Randomly make some dates available
                if (Math.random() > 0.3) {
                    const availableTimes = [];
                    const times = ['6:00 PM', '7:00 PM', '8:00 PM', '9:00 PM'];
                    times.forEach(time => {
                        if (Math.random() > 0.4) {
                            availableTimes.push(time);
                        }
                    });
                    if (availableTimes.length > 0) {
                        availability[dateKey] = availableTimes;
                    }
                }
            }
            
            return availability;
        }

        providerAvailability = generateDemoAvailability();

        function generateCalendar() {
            const grid = document.getElementById('calendarGrid');
            const monthDisplay = document.getElementById('currentMonth');
            
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            monthDisplay.textContent = currentDate.toLocaleDateString('en-US', { 
                month: 'long', 
                year: 'numeric' 
            });

            grid.innerHTML = '';

            // Add day headers
            const dayHeaders = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            dayHeaders.forEach(day => {
                const header = document.createElement('div');
                header.className = 'day-header';
                header.textContent = day;
                grid.appendChild(header);
            });

            // Get first day of month and number of days
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const today = new Date();

            // Add empty cells for days before month starts
            for (let i = 0; i < firstDay; i++) {
                const emptyDay = document.createElement('div');
                grid.appendChild(emptyDay);
            }

            // Add days of month
            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                
                const dayNumber = document.createElement('div');
                dayNumber.className = 'day-number';
                dayNumber.textContent = day;
                
                const dayStatus = document.createElement('div');
                dayStatus.className = 'day-status';
                dayStatus.style.fontSize = '10px';
                
                const dateKey = `${year}-${month + 1}-${day}`;
                const currentDay = new Date(year, month, day);
                
                // Check availability
                if (currentDay < today) {
                    dayElement.classList.add('unavailable');
                    dayStatus.textContent = 'Past';
                } else if (providerAvailability[dateKey]) {
                    dayElement.classList.add('available');
                    dayStatus.textContent = `${providerAvailability[dateKey].length} slots`;
                    dayElement.onclick = () => selectDate(day, dateKey);
                } else {
                    dayElement.classList.add('unavailable');
                    dayStatus.textContent = 'Unavailable';
                }

                dayElement.appendChild(dayNumber);
                dayElement.appendChild(dayStatus);
                grid.appendChild(dayElement);
            }
        }

        function selectDate(day, dateKey) {
            selectedDay = dateKey;
            selectedTime = null;
            
            document.getElementById('selectedDate').textContent = 
                new Date(currentDate.getFullYear(), currentDate.getMonth(), day)
                    .toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' });
            
            document.getElementById('timeSelection').style.display = 'block';
            generateTimeSlots(dateKey);
            updateBookingButton();
        }

        function generateTimeSlots(dateKey) {
            const timeGrid = document.getElementById('timeGrid');
            timeGrid.innerHTML = '';

            const availableTimes = providerAvailability[dateKey] || [];

            availableTimes.forEach(time => {
                const slot = document.createElement('div');
                slot.className = 'time-slot available';
                slot.textContent = time;
                
                slot.onclick = () => {
                    document.querySelectorAll('.time-slot').forEach(s => s.classList.remove('selected'));
                    slot.classList.add('selected');
                    selectedTime = time;
                    updateBookingSummary();
                    updateBookingButton();
                };

                timeGrid.appendChild(slot);
            });
        }

        function selectDuration(hours) {
            selectedDuration = hours;
            document.querySelectorAll('.duration-btn').forEach(btn => btn.classList.remove('selected'));
            event.target.classList.add('selected');
            updateBookingSummary();
        }

        function updateBookingSummary() {
            if (!selectedTime) return;

            const serviceCost = providerData.hourlyRate * selectedDuration;
            const bookingFee = providerData.hasBookingFee ? providerData.bookingFee : 0;
            const platformFee = serviceCost * 0.05;
            const total = serviceCost + bookingFee + platformFee;

            document.getElementById('summaryDuration').textContent = `${selectedDuration} hours`;
            document.getElementById('summaryServiceCost').textContent = `$${serviceCost.toFixed(2)}`;
            document.getElementById('summaryPlatformFee').textContent = `$${platformFee.toFixed(2)}`;
            document.getElementById('summaryTotal').textContent = `$${total.toFixed(2)}`;

            if (providerData.hasBookingFee) {
                document.getElementById('bookingFeeRow').style.display = 'flex';
                document.getElementById('summaryBookingFee').textContent = `$${bookingFee.toFixed(2)}`;
            }

            document.getElementById('bookingSummary').style.display = 'block';
        }

        function updateBookingButton() {
            const bookBtn = document.getElementById('bookBtn');
            if (selectedDay && selectedTime) {
                bookBtn.disabled = false;
                bookBtn.textContent = 'Book Now with Escrow Protection';
            } else {
                bookBtn.disabled = true;
                bookBtn.textContent = 'Select Date & Time to Book';
            }
        }

        function processBooking() {
            if (!selectedDay || !selectedTime) return;

            const serviceCost = providerData.hourlyRate * selectedDuration;
            const bookingFee = providerData.hasBookingFee ? providerData.bookingFee : 0;
            const platformFee = serviceCost * 0.05;
            const total = serviceCost + bookingFee + platformFee;

            const booking = {
                providerId: providerData.id,
                date: selectedDay,
                time: selectedTime,
                duration: selectedDuration,
                serviceCost,
                bookingFee,
                platformFee,
                total,
                status: 'pending_payment'
            };

            // Save booking to localStorage for demo
            localStorage.setItem('currentBooking', JSON.stringify(booking));

            showNotification('Redirecting to secure payment...');
            
            setTimeout(() => {
                window.location.href = '/escrow-payment.html?booking=' + btoa(JSON.stringify(booking));
            }, 1500);
        }

        function changeMonth(direction) {
            currentDate.setMonth(currentDate.getMonth() + direction);
            generateCalendar();
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #10b981, #059669);
                color: white;
                padding: 15px 25px;
                border-radius: 10px;
                z-index: 1000;
                box-shadow: 0 10px 25px rgba(0,0,0,0.3);
            `;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Initialize
        function initializeBooking() {
            // Display provider data
            document.getElementById('providerName').textContent = providerData.name;
            document.getElementById('providerService').textContent = providerData.service;
            document.getElementById('hourlyRate').textContent = `$${providerData.hourlyRate}/hour`;
            document.getElementById('providerAvatar').textContent = providerData.avatar;

            if (providerData.hasBookingFee) {
                document.getElementById('bookingFeeDisplay').style.display = 'block';
                document.getElementById('bookingFeeAmount').textContent = providerData.bookingFee;
            }

            generateCalendar();
            
            // Select default duration
            document.querySelector('[data-hours="3"]').classList.add('selected');
        }

        initializeBooking();
    </script>
</body>
</html>