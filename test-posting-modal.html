<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Posting Modal</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #000;
            color: #fff;
            padding: 20px;
        }
        .test-btn {
            background: #00ffff;
            color: #000;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin: 10px;
        }
        .test-btn:hover {
            background: #00cccc;
        }
        .status {
            margin-top: 20px;
            padding: 20px;
            background: #111;
            border-radius: 8px;
            border: 1px solid #333;
        }
        .success { color: #4ade80; }
        .error { color: #ef4444; }
        .info { color: #60a5fa; }
    </style>
</head>
<body>
    <h1>MarketPace Posting Modal Test</h1>
    
    <button class="test-btn" onclick="testModalCreation()">Test Modal Creation</button>
    <button class="test-btn" onclick="testRentalFields()">Test Rental Fields</button>
    <button class="test-btn" onclick="checkLocalStorage()">Check Saved Posts</button>
    <button class="test-btn" onclick="clearAllData()">Clear All Data</button>
    <button class="test-btn" onclick="window.location.href='/community.html'">Go to Community Page</button>
    
    <div id="status" class="status"></div>
    
    <script>
        function log(message, type = 'info') {
            const status = document.getElementById('status');
            const timestamp = new Date().toLocaleTimeString();
            status.innerHTML += `<div class="${type}">[${timestamp}] ${message}</div>`;
            console.log(`[${type}] ${message}`);
        }
        
        function testModalCreation() {
            log('Testing modal creation...', 'info');
            
            try {
                // Test if showPostingModal function exists
                if (typeof showPostingModal === 'function') {
                    log('❌ showPostingModal function found - this page should not have it', 'error');
                } else {
                    log('✓ showPostingModal function not found on test page (expected)', 'success');
                }
                
                // Test creating a simple modal
                const modal = document.createElement('div');
                modal.className = 'test-modal';
                modal.innerHTML = '<h2>Test Modal Created</h2>';
                modal.style.cssText = 'position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #222; padding: 30px; border-radius: 10px; border: 2px solid #00ffff;';
                document.body.appendChild(modal);
                
                log('✓ Test modal created successfully', 'success');
                
                setTimeout(() => {
                    modal.remove();
                    log('✓ Test modal removed', 'success');
                }, 2000);
                
            } catch (error) {
                log('❌ Error testing modal: ' + error.message, 'error');
            }
        }
        
        function testRentalFields() {
            log('Testing rental field data structure...', 'info');
            
            try {
                // Create test rental data
                const testRental = {
                    title: 'Test Rental Item',
                    description: 'This is a test rental',
                    category: 'rent',
                    hourlyRate: 15,
                    dailyRate: 35,
                    rentalTerms: 'Handle with care, return in same condition',
                    deliveryOptions: {
                        selfPickup: true,
                        privateDelivery: true,
                        marketPaceDelivery: false
                    },
                    price: '$15/hr | $35/day'
                };
                
                log('✓ Test rental data created: ' + JSON.stringify(testRental, null, 2), 'success');
                
                // Test saving to localStorage
                const posts = JSON.parse(localStorage.getItem('communityPosts') || '[]');
                posts.unshift(testRental);
                localStorage.setItem('communityPosts', JSON.stringify(posts));
                
                log('✓ Test rental saved to localStorage', 'success');
                
            } catch (error) {
                log('❌ Error testing rental fields: ' + error.message, 'error');
            }
        }
        
        function checkLocalStorage() {
            log('Checking localStorage for saved posts...', 'info');
            
            try {
                const posts = JSON.parse(localStorage.getItem('communityPosts') || '[]');
                log(`Found ${posts.length} posts in localStorage`, 'info');
                
                // Check for rental posts
                const rentalPosts = posts.filter(p => p.category === 'rent');
                log(`Found ${rentalPosts.length} rental posts`, 'info');
                
                // Display last rental post
                if (rentalPosts.length > 0) {
                    const lastRental = rentalPosts[0];
                    log('Last rental post:', 'info');
                    log('- Title: ' + lastRental.title, 'info');
                    log('- Hourly Rate: $' + (lastRental.hourlyRate || 'Not set'), 'info');
                    log('- Daily Rate: $' + (lastRental.dailyRate || 'Not set'), 'info');
                    log('- Terms: ' + (lastRental.rentalTerms || 'Not set'), 'info');
                }
                
            } catch (error) {
                log('❌ Error checking localStorage: ' + error.message, 'error');
            }
        }
        
        function clearAllData() {
            if (confirm('Clear all posts from localStorage?')) {
                localStorage.removeItem('communityPosts');
                log('✓ All posts cleared from localStorage', 'success');
            }
        }
        
        // Check on page load
        window.addEventListener('DOMContentLoaded', () => {
            log('Test page loaded', 'info');
            checkLocalStorage();
        });
    </script>
</body>
</html>