<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MarketPace Community Feed</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0d0221 0%, #1a0845 50%, #2d1810 100%);
            min-height: 100vh;
            color: #ffffff;
            overflow-x: hidden;
            width: 100%;
            max-width: 100vw;
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        * {
            box-sizing: border-box;
        }

        /* Floating particles background */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: linear-gradient(45deg, #00ffff, #9d4edd);
            border-radius: 50%;
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }
        
        .header-logo-flow-particle {
            position: absolute;
            border-radius: 50%;
            pointer-events: none;
            z-index: 6;
            box-shadow: 0 0 6px currentColor;
            animation: headerLogoFlow linear infinite;
        }
        
        @keyframes headerLogoFlow {
            0% {
                transform: translate(var(--start-x), var(--start-y)) scale(0);
                opacity: 0;
            }
            15% {
                opacity: 1;
                transform: translate(var(--start-x), var(--start-y)) scale(1);
            }
            50% {
                opacity: 1;
                transform: translate(calc((var(--start-x) + var(--end-x)) / 2), calc((var(--start-y) + var(--end-y)) / 2)) scale(1.1);
            }
            85% {
                opacity: 0.7;
                transform: translate(var(--end-x), var(--end-y)) scale(0.8);
            }
            100% {
                opacity: 0;
                transform: translate(var(--end-x), var(--end-y)) scale(0);
            }
        }

        /* Header */
        .header {
            background: rgba(13, 2, 33, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(0, 255, 255, 0.2);
            padding: 1rem 0;
            position: relative;
            z-index: 100;
        }

        .header.hidden {
            transform: translateY(-100%);
        }

        /* Community Calendar Styles - Now in Main Menu */
        .menu-calendar-section {
            background: linear-gradient(135deg, #1a0b3d 0%, #2d1b69 100%);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 12px;
            margin-bottom: 1rem;
            overflow: hidden;
        }

        .menu-calendar-header {
            padding: 15px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, #1a0b3d 0%, #2d1b69 100%);
        }

        .menu-calendar-header:hover {
            background: linear-gradient(135deg, #2d1b69 0%, #3730a3 100%);
        }

        .menu-calendar-title {
            font-size: 16px;
            font-weight: bold;
            color: #00ffff;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        }

        .menu-calendar-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
        }

        .menu-calendar-expanded {
            background: linear-gradient(135deg, #0d0221 0%, #1a0b3d 100%);
            padding: 0;
            max-height: 0;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .menu-calendar-expanded.active {
            max-height: 400px;
            padding: 15px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .calendar-nav-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
        }

        .month-nav {
            background: linear-gradient(135deg, #1e40af, #3730a3);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s ease;
        }

        .month-nav:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(30, 64, 175, 0.4);
        }

        .current-month {
            font-size: 20px;
            font-weight: bold;
            color: #00ffff;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-bottom: 20px;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
        }

        .calendar-day {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .calendar-day:hover {
            background: rgba(0, 255, 255, 0.2);
            transform: translateY(-1px);
        }

        .calendar-day.today {
            background: linear-gradient(135deg, #1e40af, #3730a3);
            color: white;
            font-weight: bold;
        }

        .calendar-day.has-event {
            background: linear-gradient(135deg, #9d4edd, #7c3aed);
            color: white;
            position: relative;
        }

        .calendar-day.has-event::after {
            content: '•';
            position: absolute;
            bottom: 2px;
            right: 4px;
            color: #00ffff;
            font-size: 12px;
        }

        .calendar-events {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
        }

        .calendar-event {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 12px;
            padding: 15px;
            color: white;
            transition: all 0.3s ease;
        }

        .calendar-event:hover {
            background: rgba(0, 255, 255, 0.1);
            transform: translateY(-2px);
        }

        .header-content {
            display: grid;
            grid-template-columns: auto 1fr auto;
            align-items: center;
            gap: 1rem;
            padding: 0 1rem;
            width: 100%;
            max-width: none;
            margin: 0;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
            justify-self: start;
        }
        
        .header-center {
            justify-self: center;
            max-width: 500px;
            width: 100%;
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 8px;
            justify-self: end;
            flex-wrap: wrap;
        }

        .logo {
            font-size: 2rem;
            font-weight: bold;
            background: linear-gradient(45deg, #00ffff, #9d4edd);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
        }

        .search-bar {
            flex: 1;
            max-width: 500px;
            margin: 0 2rem;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 0.75rem 1rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 25px;
            color: white;
            font-size: 1rem;
            outline: none;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            border-color: #00ffff;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
        }

        .search-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .demo-badge {
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .demo-badge:hover {
            transform: scale(1.05);
        }

        /* Main content */
        .main-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            display: grid;
            grid-template-columns: 1fr 3fr 1fr;
            gap: 2rem;
            position: relative;
            z-index: 1;
        }

        /* Sidebar filters */
        .filters-sidebar {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 1.5rem;
            height: fit-content;
            position: sticky;
            top: 100px;
            border: 1px solid rgba(0, 255, 255, 0.2);
        }

        .filters-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 1rem;
            color: #00ffff;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        }

        .filter-group {
            margin-bottom: 1.5rem;
        }

        .filter-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #ffffff;
        }

        .filter-options {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .filter-btn {
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 20px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .filter-btn:hover,
        .filter-btn.active {
            background: linear-gradient(45deg, #00ffff, #9d4edd);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 255, 0.3);
        }
        
        .filter-dropdown {
            width: 100%;
            padding: 0.75rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 10px;
            color: white;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .filter-dropdown:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(0, 255, 255, 0.5);
        }
        
        .filter-dropdown option {
            background: #0d0221;
            color: white;
            padding: 0.5rem;
        }

        /* Feed content */
        .feed-content {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        /* Post composer */
        .post-composer {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 1.5rem;
            border: 1px solid rgba(0, 255, 255, 0.2);
        }

        .composer-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(45deg, #00ffff, #9d4edd);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
        }

        .composer-input {
            flex: 1;
            padding: 0.75rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 10px;
            color: white;
            resize: vertical;
            min-height: 50px;
            outline: none;
        }

        .composer-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .composer-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1rem;
        }

        .post-type-selector {
            display: flex;
            gap: 0.5rem;
        }

        .post-type-btn {
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 20px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .post-type-btn:hover,
        .post-type-btn.active {
            background: linear-gradient(45deg, #00ffff, #9d4edd);
            transform: translateY(-2px);
        }

        .post-btn {
            padding: 0.75rem 2rem;
            background: linear-gradient(45deg, #00ffff, #9d4edd);
            border: none;
            border-radius: 25px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .post-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 255, 0.3);
        }

        /* Feed posts */
        .feed-post {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 1.5rem;
            border: 1px solid rgba(0, 255, 255, 0.2);
            margin-bottom: 1rem;
        }

        .post-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .post-meta {
            flex: 1;
        }

        .post-author {
            font-weight: bold;
            color: #00ffff;
            margin-bottom: 0.25rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .member-badge {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .demo-badge {
            background: linear-gradient(135deg, #1e40af, #3730a3);
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .post-time {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
        }

        .post-category {
            background: linear-gradient(45deg, #9d4edd, #ff6b35);
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.8rem;
            color: white;
            font-weight: 600;
        }

        .post-content {
            margin-bottom: 1rem;
            line-height: 1.6;
        }

        .post-image {
            width: 100%;
            max-height: 400px;
            object-fit: cover;
            border-radius: 10px;
            margin: 1rem 0;
        }

        .post-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
            padding-top: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .action-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 20px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .action-btn:hover {
            background: rgba(0, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        /* Right sidebar */
        .right-sidebar {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 1.5rem;
            height: fit-content;
            position: sticky;
            top: 100px;
            border: 1px solid rgba(0, 255, 255, 0.2);
        }

        .sidebar-section {
            margin-bottom: 2rem;
        }

        .sidebar-title {
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 1rem;
            color: #00ffff;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        }

        .trending-item {
            padding: 0.75rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .trending-item:hover {
            background: rgba(0, 255, 255, 0.1);
            transform: translateX(5px);
        }

        /* Demo mode popup */
        .demo-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .demo-popup.hidden {
            display: none;
        }

        .popup-content {
            background: linear-gradient(135deg, #0d0221 0%, #1a0845 50%, #2d1810 100%);
            padding: 3rem;
            border-radius: 20px;
            border: 2px solid #00ffff;
            box-shadow: 0 20px 40px rgba(0, 255, 255, 0.3);
            text-align: center;
            max-width: 500px;
            margin: 2rem;
        }

        .popup-title {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 1rem;
            background: linear-gradient(45deg, #00ffff, #9d4edd);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
        }

        .popup-text {
            font-size: 1.1rem;
            margin-bottom: 2rem;
            line-height: 1.6;
            color: rgba(255, 255, 255, 0.9);
        }

        .popup-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }

        .popup-btn {
            padding: 0.75rem 2rem;
            border: none;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .popup-btn.primary {
            background: linear-gradient(45deg, #00ffff, #9d4edd);
            color: white;
        }

        .popup-btn.secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(0, 255, 255, 0.3);
        }

        .popup-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 255, 0.3);
        }

        /* Shop showcase */
        .shop-showcase {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .shop-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(0, 255, 255, 0.2);
        }

        .shop-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 255, 255, 0.2);
        }

        .shop-item-image {
            width: 80px;
            height: 80px;
            background: linear-gradient(45deg, #00ffff, #9d4edd);
            border-radius: 10px;
            margin: 0 auto 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
        }

        .shop-item-name {
            font-weight: bold;
            margin-bottom: 0.25rem;
            color: #00ffff;
        }

        .shop-item-price {
            color: #ff6b35;
            font-weight: bold;
        }

        /* Poll styles */
        .poll-container {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 1rem;
            margin-top: 1rem;
        }

        .poll-question {
            font-weight: bold;
            margin-bottom: 1rem;
            color: #00ffff;
        }

        .poll-option {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 10px;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .poll-option:hover {
            background: rgba(0, 255, 255, 0.2);
        }

        .poll-percentage {
            font-weight: bold;
            color: #ff6b35;
        }

        /* New styles for enhanced features */
        .radius-slider {
            width: 100%;
            margin: 0.5rem 0;
            appearance: none;
            height: 5px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            outline: none;
        }

        .radius-slider::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            background: linear-gradient(45deg, #00ffff, #9d4edd);
            border-radius: 50%;
            cursor: pointer;
        }

        .town-search-input {
            width: calc(100% - 80px);
            padding: 0.5rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 5px;
            color: white;
            margin-bottom: 0.5rem;
        }

        .search-town-btn {
            width: 70px;
            padding: 0.5rem;
            background: linear-gradient(45deg, #00ffff, #9d4edd);
            border: none;
            border-radius: 5px;
            color: white;
            cursor: pointer;
            margin-left: 5px;
        }

        .poll-creator {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 1rem;
            border: 1px solid rgba(0, 255, 255, 0.2);
        }

        .poll-question-input {
            margin-bottom: 1rem;
        }

        .poll-option-input {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
            gap: 0.5rem;
        }

        .poll-option-field {
            flex: 1;
            padding: 0.5rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 5px;
            color: white;
        }

        .poll-option-field::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .remove-option-btn {
            width: 25px;
            height: 25px;
            background: #ff4444;
            border: none;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            font-size: 12px;
        }

        .add-poll-option-btn {
            padding: 0.5rem 1rem;
            background: rgba(0, 255, 255, 0.2);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 5px;
            color: #00ffff;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .add-poll-option-btn:hover {
            background: rgba(0, 255, 255, 0.3);
        }

        .form-input {
            width: 100%;
            padding: 0.75rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 10px;
            color: white;
            outline: none;
        }

        .form-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        /* Floating Profile Icon */
        .floating-profile {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: linear-gradient(45deg, #00ffff, #9d4edd);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(0, 255, 255, 0.3);
            z-index: 1000;
            transition: all 0.3s ease;
        }

        .floating-profile:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(0, 255, 255, 0.5);
        }

        .profile-avatar {
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
            color: white;
        }

        /* Main Menu Button */
        .main-menu-btn {
            width: 100%;
            padding: 0.75rem;
            background: linear-gradient(45deg, #00ffff, #9d4edd);
            border: none;
            border-radius: 10px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
        }

        .main-menu-btn:hover {
            background: linear-gradient(45deg, #00cccc, #7c3aed);
            transform: translateY(-2px);
        }

        /* Main Menu Overlay */
        .main-menu {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(13, 2, 33, 0.95);
            backdrop-filter: blur(10px);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .menu-content {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 20px;
            padding: 2rem;
            max-width: 400px;
            width: 90%;
            backdrop-filter: blur(20px);
        }

        .menu-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(0, 255, 255, 0.2);
        }

        .menu-header h3 {
            color: #00ffff;
            margin: 0;
            font-size: 1.5rem;
        }

        .close-menu-btn {
            background: none;
            border: none;
            color: #ff6b35;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .close-menu-btn:hover {
            background: rgba(255, 107, 53, 0.2);
        }

        .menu-items {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .menu-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(0, 255, 255, 0.2);
            border-radius: 10px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            font-size: 1rem;
        }

        .menu-item:hover {
            background: rgba(0, 255, 255, 0.1);
            border-color: rgba(0, 255, 255, 0.4);
            transform: translateX(5px);
        }

        .menu-item span {
            font-size: 1.2rem;
            width: 20px;
        }

        /* Item Actions */
        .item-actions {
            display: flex;
            gap: 0.5rem;
            margin: 1rem 0;
            flex-wrap: wrap;
        }

        .item-action-btn {
            padding: 0.5rem 1rem;
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .item-action-btn:hover {
            background: rgba(0, 255, 255, 0.2);
            border-color: rgba(0, 255, 255, 0.5);
            transform: translateY(-1px);
        }

        .item-action-btn.counter-offer {
            border-color: rgba(255, 107, 53, 0.5);
            color: #ff6b35;
        }

        .item-action-btn.counter-offer:hover {
            background: rgba(255, 107, 53, 0.2);
        }

        .item-action-btn.add-to-cart {
            border-color: rgba(157, 78, 221, 0.5);
            color: #9d4edd;
        }

        .item-action-btn.add-to-cart:hover {
            background: rgba(157, 78, 221, 0.2);
        }

        .item-action-btn.deliver-now {
            border-color: rgba(0, 255, 255, 0.5);
            color: #00ffff;
        }

        .item-action-btn.deliver-now:hover {
            background: rgba(0, 255, 255, 0.2);
        }

        /* Service action buttons */
        .service-actions {
            display: flex;
            gap: 0.5rem;
            margin: 1rem 0;
            flex-wrap: wrap;
        }

        .service-action-btn {
            padding: 0.5rem 1rem;
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .service-action-btn:hover {
            background: rgba(0, 255, 255, 0.2);
            border-color: rgba(0, 255, 255, 0.5);
            transform: translateY(-1px);
        }

        .service-action-btn.book-now {
            border-color: rgba(6, 182, 212, 0.5);
            color: #06b6d4;
        }

        .service-action-btn.book-now:hover {
            background: rgba(6, 182, 212, 0.2);
        }

        .service-action-btn.contact-service {
            border-color: rgba(157, 78, 221, 0.5);
            color: #9d4edd;
        }

        .service-action-btn.contact-service:hover {
            background: rgba(157, 78, 221, 0.2);
        }

        .post-price {
            font-size: 1.3rem;
            font-weight: bold;
            color: #ff6b35;
            margin-bottom: 0.5rem;
        }

        /* Calendar Styles */
        /* Calendar styles completely removed */

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
            margin-bottom: 1rem;
        }

        .calendar-day {
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .calendar-day:hover {
            background: rgba(0, 255, 255, 0.2);
        }

        .calendar-day.has-event {
            background: rgba(157, 78, 221, 0.3);
            border: 1px solid #9d4edd;
        }

        /* Calendar styles removed */

        .event-item {
            display: flex;
            gap: 10px;
            padding: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            margin-bottom: 8px;
            border-left: 3px solid #9d4edd;
        }

        .event-date {
            color: #00ffff;
            font-weight: bold;
            font-size: 12px;
            min-width: 35px;
        }

        .event-title {
            color: white;
            font-size: 13px;
            font-weight: bold;
        }

        .event-time {
            color: rgba(255, 255, 255, 0.7);
            font-size: 11px;
        }

        /* Hub Entertainment Styles */
        .hub-post {
            border-left: 4px solid #9d4edd;
        }

        .music-release-card {
            background: rgba(157, 78, 221, 0.1);
            border: 1px solid rgba(157, 78, 221, 0.3);
            border-radius: 10px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .service-rates-card {
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 10px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .equipment-sale-card {
            background: rgba(255, 107, 53, 0.1);
            border: 1px solid rgba(255, 107, 53, 0.3);
            border-radius: 10px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .buy-music-btn {
            background: linear-gradient(45deg, #9d4edd, #00ffff);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .buy-music-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(157, 78, 221, 0.3);
        }

        .interested-btn {
            background: rgba(0, 255, 255, 0.2);
            border: 1px solid #00ffff;
            color: #00ffff;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .interested-btn:hover {
            background: rgba(0, 255, 255, 0.3);
        }

        /* Responsive design */
        @media (max-width: 768px) {
            html, body {
                overflow-x: hidden;
                width: 100%;
                max-width: 100vw;
            }
            
            .main-content {
                grid-template-columns: 1fr;
                padding: 0.5rem;
                gap: 0.75rem;
                max-width: 100vw;
                overflow-x: hidden;
                width: 100%;
            }
            
            .filters-sidebar,
            .right-sidebar {
                position: relative;
                top: 0;
            }
            
            /* Compact mobile filters */
            .filters-sidebar {
                padding: 0.75rem;
                margin: 0 0.25rem;
            }
            
            .filter-group {
                margin-bottom: 0.75rem;
            }
            
            .filter-options {
                gap: 0.5rem;
                flex-wrap: wrap;
            }
            
            .filter-btn {
                padding: 0.4rem 0.8rem;
                font-size: 12px;
            }
            
            .header-content {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto auto;
                gap: 0.75rem;
                padding: 0 0.75rem;
            }
            
            .header-left, .header-center, .header-right {
                justify-self: center;
                width: 100%;
            }
            
            .header-left {
                justify-content: center;
            }
            
            .header-center {
                max-width: 100%;
            }
            
            .header-right {
                justify-content: center;
                gap: 6px;
            }
            
            .header-right button {
                font-size: 10px !important;
                padding: 5px 8px !important;
            }
        }

        /* Mobile Responsiveness */
        @media screen and (max-width: 768px) {
            /* Adjust main layout for mobile */
            .main-layout {
                grid-template-columns: 1fr;
                padding: 10px;
                gap: 15px;
            }

            /* Hide sidebar on mobile */
            .sidebar {
                display: none;
            }

            /* Collapsible Calendar Mobile Adjustments */
            .top-calendar-container {
                padding: 15px;
                margin: 10px;
            }

            .calendar-header {
                font-size: 16px !important;
                padding: 12px 15px;
            }

            .toggle-icon {
                font-size: 14px;
            }

            .calendar-grid {
                grid-template-columns: repeat(7, 1fr) !important;
                gap: 4px !important;
                font-size: 12px !important;
            }

            .calendar-day {
                padding: 8px 4px !important;
                min-height: 40px !important;
                font-size: 12px !important;
            }

            .calendar-day.today {
                font-size: 14px !important;
            }

            .event-text {
                font-size: 7px !important;
                margin-top: 1px !important;
            }

            .calendar-legend {
                flex-direction: column !important;
                gap: 10px !important;
                align-items: center;
            }

            .legend-item {
                font-size: 12px !important;
            }

            /* Feed Content Mobile */
            .feed-content {
                width: 100%;
                max-width: 100%;
                padding: 0.5rem;
                margin: 0;
            }

            /* Post Composer Mobile */
            .post-composer {
                padding: 0.75rem;
                margin: 0 0.25rem 0.75rem 0.25rem;
                border-radius: 12px;
            }

            .composer-input {
                font-size: 14px;
                padding: 0.75rem;
                min-height: 60px;
                border-radius: 8px;
            }

            .composer-actions {
                flex-wrap: wrap;
                gap: 0.5rem;
                margin-top: 0.75rem;
            }

            .post-type-selector {
                gap: 0.25rem;
                flex-wrap: wrap;
            }

            .post-type-btn {
                font-size: 11px;
                padding: 0.4rem 0.6rem;
                border-radius: 6px;
            }

            .post-btn {
                font-size: 12px;
                padding: 0.5rem 1rem;
                border-radius: 8px;
            }

            /* Post Mobile */
            .post {
                padding: 0.75rem;
                margin: 0 0.25rem 0.75rem 0.25rem;
                border-radius: 12px;
            }
            
            .post-content {
                font-size: 14px;
                line-height: 1.4;
            }
            
            .post-actions {
                padding: 0.5rem 0;
                gap: 1rem;
            }
            
            .action-btn {
                font-size: 12px;
                padding: 0.4rem 0.8rem;
            }
            
            /* Mobile Calendar Fixes */
            .menu-calendar-section {
                margin: 0 0.25rem 0.75rem 0.25rem;
            }
            
            .menu-calendar-expanded.active {
                max-height: 300px;
                padding: 10px;
            }
            
            .calendar-grid {
                grid-template-columns: repeat(7, 1fr);
                gap: 2px;
                font-size: 12px;
            }
            
            .calendar-day {
                min-height: 30px;
                padding: 5px;
                font-size: 11px;
            }
            
            .month-nav {
                padding: 5px 10px;
                font-size: 14px;
            }
            
            .current-month {
                font-size: 14px;
            }

            .post-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }

            .post-meta {
                font-size: 12px;
            }

            .post-content {
                font-size: 14px;
                line-height: 1.5;
                margin: 10px 0;
            }

            .post-actions {
                gap: 15px;
                flex-wrap: wrap;
            }

            .action-button {
                font-size: 12px;
                padding: 6px 10px;
            }

            /* Location Filter Mobile */
            .location-filter {
                padding: 15px;
                margin-bottom: 15px;
            }

            .filter-controls {
                flex-direction: column;
                gap: 15px;
            }

            .radius-control {
                flex-direction: column;
                gap: 10px;
            }

            /* Top navigation adjustments */
            .top-nav {
                padding: 10px 15px;
                flex-wrap: wrap;
                gap: 10px;
            }

            .nav-buttons {
                order: 2;
                width: 100%;
                justify-content: center;
                gap: 8px;
            }

            .nav-btn {
                font-size: 12px;
                padding: 8px 12px;
            }

            /* Demo mode banner mobile */
            .demo-mode-banner {
                padding: 15px;
                font-size: 14px;
                text-align: center;
            }

            /* User menu mobile - stack buttons vertically */
            .user-menu {
                flex-direction: column !important;
                gap: 8px !important;
                align-items: stretch !important;
            }

            .user-menu button {
                width: 100% !important;
                padding: 10px 15px !important;
                font-size: 13px !important;
                text-align: center;
            }

            .demo-badge {
                width: 100% !important;
                text-align: center;
                padding: 10px;
            }

            /* Item actions mobile */
            .item-actions {
                flex-direction: column;
                gap: 8px;
            }

            .item-action-btn {
                width: 100%;
                text-align: center;
                padding: 12px;
                font-size: 14px;
            }

            /* Menu items mobile */
            .menu-item {
                padding: 15px;
                font-size: 14px;
            }

            /* Poll options mobile */
            .poll-options {
                gap: 8px;
            }

            .poll-option {
                padding: 12px;
                font-size: 13px;
            }

            /* Floating particles - reduce on mobile for performance */
            .particle {
                width: 3px !important;
                height: 3px !important;
            }

            /* Reduce animation on mobile */
            .particles {
                opacity: 0.3;
            }
        }

        /* Extra small mobile screens */
        @media screen and (max-width: 480px) {
            body {
                font-size: 14px;
            }

            .main-layout {
                padding: 5px;
                gap: 10px;
            }

            .top-calendar-container {
                margin: 5px;
                padding: 10px;
            }

            .calendar-header {
                font-size: 14px !important;
                padding: 10px;
            }

            .calendar-grid {
                gap: 2px !important;
            }

            .calendar-day {
                padding: 6px 2px !important;
                min-height: 35px !important;
                font-size: 11px !important;
            }

            .event-text {
                font-size: 6px !important;
            }

            .feed-content {
                padding: 5px;
            }

            .post-composer,
            .post,
            .location-filter {
                padding: 10px;
                margin-bottom: 10px;
            }

            .composer-input {
                min-height: 60px;
                font-size: 13px;
            }

            .post-content {
                font-size: 13px;
            }

            .action-btn,
            .action-button {
                font-size: 11px;
                padding: 6px 8px;
            }
        }
    </style>
</head>
<body>
    <!-- Floating particles -->
    <div class="particles" id="particles"></div>






    <!-- Demo Mode Banner -->
    <div style="background: linear-gradient(135deg, rgba(255, 107, 53, 0.2), rgba(157, 78, 221, 0.2)); padding: 0.5rem; text-align: center; border-bottom: 1px solid rgba(255, 107, 53, 0.3);">
        <span style="color: #ff6b35; font-weight: bold;">🚀 DEMO MODE</span>
        <span style="color: white; margin: 0 1rem;">|</span>
        <span style="color: rgba(255,255,255,0.9);">No live purchases • Upload items for launch • Need 50+ members & 5+ drivers</span>
        <span style="color: white; margin: 0 1rem;">|</span>
        <span style="color: #00ffff; font-size: 0.9rem;">Demo items deleted at launch</span>
    </div>



    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <!-- Left Section: Back Button + Logo -->
            <div class="header-left">
                <button onclick="window.location.href='/'" style="background: transparent; color: #87ceeb; border: none; padding: 4px 8px; font-size: 14px; cursor: pointer; transition: all 0.2s ease; display: flex; align-items: center; gap: 6px;" onmouseover="this.style.color='#00ffff'; this.style.transform='translateX(-2px)'" onmouseout="this.style.color='#87ceeb'; this.style.transform='translateX(0)'">
                    <span style="font-size: 16px; font-weight: 300;">←</span> Back
                </button>
                
                <div id="headerLogoContainer" style="position: relative; overflow: visible;">
                    <!-- Header logo flow particles -->
                    <div id="headerLogoFlowParticles" style="
                      position: absolute;
                      top: -30px;
                      left: -30px;
                      right: -30px;
                      bottom: -30px;
                      z-index: 4;
                      pointer-events: none;
                    "></div>
                    
                    <img src="/marketpace-hero-logo.jpeg" alt="MarketPace" style="
                      height: 70px; 
                      width: auto; 
                      border-radius: 12px; 
                      object-fit: cover;
                      filter: drop-shadow(0 0 15px rgba(0, 255, 255, 0.6)) drop-shadow(0 0 30px rgba(138, 43, 226, 0.3));
                      mask: radial-gradient(ellipse at center, rgba(0,0,0,1) 75%, rgba(0,0,0,0.6) 90%, rgba(0,0,0,0) 100%);
                      -webkit-mask: radial-gradient(ellipse at center, rgba(0,0,0,1) 75%, rgba(0,0,0,0.6) 90%, rgba(0,0,0,0) 100%);
                      position: relative;
                      z-index: 5;
                    ">
                </div>
            </div>
            
            <!-- Center Section: Search Bar -->
            <div class="header-center">
                <div class="search-bar">
                    <input type="text" class="search-input" placeholder="Search posts, products, services, or people..." id="searchInput">
                </div>
            </div>
            
            <!-- Right Section: Action Buttons -->
            <div class="header-right">
                <button class="demo-badge" onclick="showDemoPopup()" id="demoBadgeBtn" style="background: linear-gradient(135deg, #1e40af, #3730a3); color: white; border: none; padding: 6px 10px; border-radius: 6px; font-weight: bold; font-size: 11px; cursor: pointer; box-shadow: 0 2px 6px rgba(30, 64, 175, 0.3); transition: transform 0.2s ease; white-space: nowrap;" onmouseover="this.style.transform='translateY(-1px)'" onmouseout="this.style.transform='translateY(0)'">
                    Demo Mode
                </button>
                <button onclick="window.location.href='/driver-application.html'" style="background: linear-gradient(135deg, #1e40af, #3730a3); color: white; border: none; padding: 6px 10px; border-radius: 6px; font-weight: bold; font-size: 11px; cursor: pointer; box-shadow: 0 2px 6px rgba(30, 64, 175, 0.3); transition: transform 0.2s ease; white-space: nowrap;" onmouseover="this.style.transform='translateY(-1px)'" onmouseout="this.style.transform='translateY(0)'">
                    Apply to Drive
                </button>
                <button onclick="window.location.href='/sponsorship.html'" style="background: linear-gradient(135deg, #1e40af, #3730a3); color: white; border: none; padding: 6px 10px; border-radius: 6px; font-weight: bold; font-size: 11px; cursor: pointer; box-shadow: 0 2px 6px rgba(30, 64, 175, 0.3); transition: transform 0.2s ease; white-space: nowrap;" onmouseover="this.style.transform='translateY(-1px)'" onmouseout="this.style.transform='translateY(0)'">
                    Sponsor/Support
                </button>
            </div>
        </div>
    </header>



    <!-- Main content -->
    <main class="main-content">
        <!-- Left sidebar - Filters -->
        <aside class="filters-sidebar">
            <!-- Main Menu Button -->
            <button class="main-menu-btn" onclick="toggleMainMenu()">☰ Main Menu</button>
            
            <h3 class="filters-title">Filters</h3>
            
            <div class="filter-group">
                <label class="filter-label">Category</label>
                <select class="filter-dropdown" id="categoryFilter" onchange="handleFilterChange('category', this.value)">
                    <option value="all">All Categories</option>
                    <option value="buy-sell">Buy/Sell</option>
                    <option value="rent">Rent</option>
                    <option value="services">Services</option>
                    <option value="hub">The Hub</option>
                    <option value="shops">Shops</option>
                </select>
            </div>

            <div class="filter-group">
                <label class="filter-label">Post Type</label>
                <select class="filter-dropdown" id="postTypeFilter" onchange="handleFilterChange('postType', this.value)">
                    <option value="all">All Types</option>
                    <option value="product">Products</option>
                    <option value="iso">ISO Posts</option>
                    <option value="poll">Polls</option>
                    <option value="general">General</option>
                </select>
            </div>

            <div class="filter-group">
                <label class="filter-label">Location</label>
                <select class="filter-dropdown" id="locationFilter" onchange="handleFilterChange('location', this.value)">
                    <option value="nearby">Nearby</option>
                    <option value="town-search">Search by Town</option>
                </select>
                <div class="location-controls" style="margin-top: 1rem;">
                    <label class="filter-label">Radius (miles)</label>
                    <input type="range" id="radiusSlider" min="1" max="50" value="10" class="radius-slider">
                    <span id="radiusValue">10 miles</span>
                    
                    <div class="town-search-container" style="margin-top: 1rem; display: none;">
                        <input type="text" id="townSearch" placeholder="Enter town name..." class="town-search-input">
                        <button class="search-town-btn">Search</button>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Center content - Feed -->
        <div class="feed-content">
            <!-- Post composer -->
            <div class="post-composer">
                <div class="composer-header">
                    <div class="user-avatar" id="composerAvatar">D</div>
                    <textarea class="composer-input" placeholder="What's happening in your community?" id="postInput"></textarea>
                </div>
                <div class="composer-actions">
                    <div class="post-type-selector">
                        <button class="post-type-btn active" data-type="general">General</button>
                        <button class="post-type-btn" data-type="product">Product</button>
                        <button class="post-type-btn" data-type="iso">ISO</button>
                        <button class="post-type-btn" data-type="poll">Poll</button>
                        <button class="post-type-btn" data-type="events">Events</button>
                        <button class="post-type-btn" data-type="rentals">Rentals</button>
                        <button class="post-type-btn" data-type="services">Services</button>
                        <button class="post-type-btn" data-type="shop">Shop</button>
                    </div>
                    <button class="post-btn" onclick="createPost()">Post</button>
                </div>
                
                <!-- Poll creation section (hidden by default) -->
                <div class="poll-creator" id="pollCreator" style="display: none; margin-top: 1rem;">
                    <div class="poll-question-input">
                        <input type="text" id="pollQuestion" placeholder="Ask a question..." class="form-input">
                    </div>
                    <div class="poll-options-container">
                        <div class="poll-option-input">
                            <input type="text" placeholder="Option 1" class="poll-option-field">
                            <button class="remove-option-btn" onclick="removePollOption(this)" style="display: none;">✕</button>
                        </div>
                        <div class="poll-option-input">
                            <input type="text" placeholder="Option 2" class="poll-option-field">
                            <button class="remove-option-btn" onclick="removePollOption(this)" style="display: none;">✕</button>
                        </div>
                    </div>
                    <button class="add-poll-option-btn" onclick="addPollOption()">+ Add Option</button>
                </div>

                <!-- Event creation section (hidden by default) -->
                <div class="event-creator" id="eventCreator" style="display: none; margin-top: 1rem;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                        <div>
                            <label style="display: block; color: rgba(255,255,255,0.8); margin-bottom: 0.5rem; font-size: 0.9rem;">Event Date</label>
                            <input type="date" id="eventDate" class="form-input" style="height: 45px;">
                        </div>
                        <div>
                            <label style="display: block; color: rgba(255,255,255,0.8); margin-bottom: 0.5rem; font-size: 0.9rem;">Event Time</label>
                            <input type="time" id="eventTime" class="form-input" style="height: 45px;">
                        </div>
                    </div>
                    <div style="margin-bottom: 1rem;">
                        <label style="display: block; color: rgba(255,255,255,0.8); margin-bottom: 0.5rem; font-size: 0.9rem;">Location</label>
                        <input type="text" id="eventLocation" class="form-input" placeholder="Where is this event happening?" style="height: 45px;">
                    </div>
                    <div style="margin-bottom: 1rem;">
                        <label style="display: block; color: rgba(255,255,255,0.8); margin-bottom: 0.5rem; font-size: 0.9rem;">Event Type</label>
                        <select id="eventType" class="form-input" style="height: 45px;">
                            <option value="community">Community Gathering</option>
                            <option value="music">Music Performance</option>
                            <option value="theater">Theater/Comedy</option>
                            <option value="workshop">Workshop/Class</option>
                            <option value="sports">Sports Event</option>
                            <option value="food">Food & Drink</option>
                            <option value="art">Art Exhibition</option>
                            <option value="business">Business Event</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Feed posts -->
            <div id="feedPosts">
                <!-- Sample posts will be populated here -->
            </div>
        </div>

        <!-- Right sidebar -->
        <aside class="right-sidebar">


            <div class="sidebar-section">
                <h3 class="sidebar-title">Trending Now</h3>
                <div class="trending-item">
                    <div style="font-weight: bold; color: #00ffff;">#LocalMarket</div>
                    <div style="font-size: 0.9rem; color: rgba(255,255,255,0.7);">2.3k posts</div>
                </div>
                <div class="trending-item">
                    <div style="font-weight: bold; color: #00ffff;">#TheHub</div>
                    <div style="font-size: 0.9rem; color: rgba(255,255,255,0.7);">1.9k posts</div>
                </div>
                <div class="trending-item">
                    <div style="font-weight: bold; color: #00ffff;">#RentAnything</div>
                    <div style="font-size: 0.9rem; color: rgba(255,255,255,0.7);">1.8k posts</div>
                </div>
                <div class="trending-item">
                    <div style="font-weight: bold; color: #00ffff;">#CommunityFirst</div>
                    <div style="font-size: 0.9rem; color: rgba(255,255,255,0.7);">1.2k posts</div>
                </div>
            </div>

            <div class="sidebar-section">
                <h3 class="sidebar-title">Featured Shops</h3>
                <div class="trending-item">
                    <div style="font-weight: bold; color: #00ffff;">Sarah's Handmade</div>
                    <div style="font-size: 0.9rem; color: rgba(255,255,255,0.7);">Crafts & Jewelry</div>
                </div>
                <div class="trending-item">
                    <div style="font-weight: bold; color: #00ffff;">Mike's Tech Repair</div>
                    <div style="font-size: 0.9rem; color: rgba(255,255,255,0.7);">Electronics</div>
                </div>
                <div class="trending-item">
                    <div style="font-weight: bold; color: #00ffff;">Local Farmers Market</div>
                    <div style="font-size: 0.9rem; color: rgba(255,255,255,0.7);">Fresh Produce</div>
                </div>
            </div>


        </aside>
    </main>

    <script>
        // Initialize particles
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            for (let i = 0; i < 50; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 6 + 's';
                particle.style.animationDuration = (Math.random() * 3 + 3) + 's';
                particlesContainer.appendChild(particle);
            }
        }

        // Current user profile
        let currentUser = null;
        
        // Load user profile on page load
        function loadUserProfile() {
            // Get user profile from localStorage or API
            const userEmail = localStorage.getItem('currentUserEmail');
            if (userEmail) {
                // In a real implementation, fetch from API
                // For now, get from localStorage
                const userData = localStorage.getItem('currentUserData');
                if (userData) {
                    currentUser = JSON.parse(userData);
                    updateUserInterface();
                    
                    // Update demo badge for logged-in users
                    const demoBadgeBtn = document.getElementById('demoBadgeBtn');
                    if (demoBadgeBtn) {
                        demoBadgeBtn.textContent = `Welcome, ${currentUser.fullName.split(' ')[0]}!`;
                        demoBadgeBtn.style.background = 'linear-gradient(135deg, #10B981, #059669)';
                        demoBadgeBtn.onclick = () => window.location.href = '/profile';
                    }
                }
            }
        }
        
        // Update UI with current user information
        function updateUserInterface() {
            if (currentUser) {
                const composerAvatar = document.getElementById('composerAvatar');
                if (composerAvatar) {
                    composerAvatar.textContent = currentUser.fullName.charAt(0);
                }
                
                // Update profile avatar
                const profileAvatar = document.querySelector('.profile-avatar');
                if (profileAvatar) {
                    profileAvatar.textContent = currentUser.fullName.charAt(0);
                }
            }
        }
        
        // Check if user is in demo mode (no profile picture = demo mode)
        function isDemo(user) {
            return !user.profilePicture;
        }
        
        // Sample posts data
        const samplePosts = [
            {
                id: 1,
                type: 'product',
                category: 'buy-sell',
                author: 'Sarah Johnson',
                time: '2 hours ago',
                content: 'Selling my barely used MacBook Pro 2023! Perfect condition, comes with original charger and box. Great for students or professionals.',
                likes: 24,
                comments: 8,
                shares: 3,
                price: 1200.00,
                image: 'https://via.placeholder.com/500x300/0d0221/00ffff?text=MacBook+Pro+2023',
                hasCounterOffer: true,
                hasAddToCart: true,
                hasDeliverNow: true,
                isDemo: true
            },
            {
                id: 2,
                type: 'hub',
                category: 'hub',
                author: 'Guitar Lessons Pro',
                time: '3 hours ago',
                content: 'Learn guitar from a professional instructor! 🎸 Beginner to advanced levels welcome. Individual or group lessons available.',
                likes: 35,
                comments: 18,
                shares: 12,
                price: 50.00,
                image: 'https://via.placeholder.com/500x300/9d4edd/ffffff?text=Guitar+Lessons',
                hasBookNow: true,
                serviceType: 'lessons',
                isDemo: true
            },
            {
                id: 3,
                type: 'shop',
                category: 'shops',
                author: 'Local Coffee Roasters',
                time: '4 hours ago',
                content: 'Fresh roasted coffee beans available now! ☕ Premium Ethiopian blend, roasted this morning. Perfect for coffee enthusiasts.',
                likes: 42,
                comments: 15,
                shares: 8,
                price: 18.00,
                image: 'https://via.placeholder.com/500x300/0d0221/8B4513?text=Coffee+Beans',
                hasCounterOffer: true,
                hasAddToCart: true,
                hasDeliverNow: true
            },
            {
                id: 4,
                type: 'poll',
                category: 'general',
                author: 'Community Admin',
                time: '6 hours ago',
                content: 'What new features would you like to see in MarketPace?',
                likes: 45,
                comments: 32,
                shares: 8,
                poll: {
                    question: 'What new features would you like to see in MarketPace?',
                    options: [
                        { text: 'Video calls for negotiations', votes: 45, percentage: 35 },
                        { text: 'Live streaming events', votes: 32, percentage: 25 },
                        { text: 'Advanced search filters', votes: 38, percentage: 30 },
                        { text: 'Mobile app notifications', votes: 13, percentage: 10 }
                    ]
                }
            },
            {
                id: 5,
                type: 'product',
                category: 'rent',
                author: 'David Wilson',
                time: '8 hours ago',
                content: 'Renting out my camping gear for the weekend! ⛺ Great for families heading to the mountains. Everything included!',
                likes: 18,
                comments: 6,
                shares: 4,
                price: 25.00,
                image: 'https://via.placeholder.com/500x300/0d0221/00ffff?text=Camping+Gear',
                hasCounterOffer: true,
                hasAddToCart: true,
                hasDeliverNow: true
            },
            {
                id: 6,
                type: 'services',
                category: 'services',
                author: 'Lisa Anderson',
                time: '10 hours ago',
                content: 'Offering tutoring services for high school math and science. 📚 $30/hour, flexible scheduling available!',
                likes: 28,
                comments: 12,
                shares: 5,
                price: 30.00,
                hasBookNow: true,
                serviceType: 'tutoring'
            },
            {
                id: 7,
                type: 'services',
                category: 'services',
                author: 'Emma Martinez',
                time: '12 hours ago',
                content: 'Babysitting services available! 👶 Experienced with children ages 2-12. CPR certified, references available.',
                likes: 33,
                comments: 9,
                shares: 6,
                price: 15.00,
                hasBookNow: true,
                serviceType: 'babysitting'
            },
            {
                id: 8,
                type: 'product',
                category: 'buy-sell',
                author: 'Mike Chen',
                time: '14 hours ago',
                content: 'Vintage vinyl records collection! 🎵 Classic rock, jazz, and blues. Individual records or entire collection available.',
                likes: 56,
                comments: 22,
                shares: 18,
                price: 250.00,
                image: 'https://via.placeholder.com/500x300/0d0221/FFD700?text=Vinyl+Records',
                hasCounterOffer: true,
                hasAddToCart: true,
                hasDeliverNow: true
            },
            {
                id: 9,
                type: 'services',
                category: 'services',
                author: 'Carlos Rodriguez',
                time: '16 hours ago',
                content: 'Handyman services available! 🔧 Plumbing, electrical, carpentry, and general repairs. Licensed and insured.',
                likes: 41,
                comments: 14,
                shares: 7,
                price: 45.00,
                hasBookNow: true,
                serviceType: 'handyman'
            },
            {
                id: 10,
                type: 'product',
                category: 'buy-sell',
                author: 'Jessica Lee',
                time: '18 hours ago',
                content: 'Designer handbags for sale! 👜 Authentic Coach, Michael Kors, and Kate Spade. Excellent condition.',
                likes: 38,
                comments: 16,
                shares: 9,
                price: 125.00,
                image: 'https://via.placeholder.com/500x300/0d0221/FF69B4?text=Designer+Handbags',
                hasCounterOffer: true,
                hasAddToCart: true,
                hasDeliverNow: true
            },
            {
                id: 11,
                type: 'iso',
                category: 'buy-sell',
                author: 'Robert Kim',
                time: '20 hours ago',
                content: 'ISO: Looking for a good condition iPhone 14 Pro. Willing to pay up to $800. Must be unlocked!',
                likes: 12,
                comments: 15,
                shares: 2
            },
            {
                id: 3,
                type: 'poll',
                category: 'general',
                author: 'Community Admin',
                time: '6 hours ago',
                content: 'What new features would you like to see in MarketPace?',
                likes: 45,
                comments: 32,
                shares: 8,
                poll: {
                    question: 'What new features would you like to see in MarketPace?',
                    options: [
                        { text: 'Video calls for negotiations', votes: 45, percentage: 35 },
                        { text: 'Live streaming events', votes: 32, percentage: 25 },
                        { text: 'Advanced search filters', votes: 38, percentage: 30 },
                        { text: 'Mobile app notifications', votes: 13, percentage: 10 }
                    ]
                }
            },
            {
                id: 4,
                type: 'product',
                category: 'rent',
                author: 'David Wilson',
                time: '8 hours ago',
                content: 'Renting out my camping gear for the weekend! Great for families heading to the mountains.',
                likes: 18,
                comments: 6,
                shares: 4,
                price: 25.00,
                image: 'https://via.placeholder.com/500x300/0d0221/00ffff?text=Camping+Gear'
            },
            {
                id: 5,
                type: 'general',
                category: 'services',
                author: 'Lisa Anderson',
                time: '1 day ago',
                content: 'Just finished helping the Johnson family move their piano! Love being part of this community 💪',
                likes: 56,
                comments: 12,
                shares: 7
            },
            {
                id: 6,
                type: 'hub-music',
                category: 'the-hub',
                author: 'Jake Rivers - Musician',
                time: '1 day ago',
                content: '🎵 NEW SONG ALERT! Just dropped "City Lights" - my latest single about our amazing community! Available now for $0.99',
                likes: 89,
                comments: 23,
                shares: 34,
                musicRelease: {
                    title: 'City Lights',
                    artist: 'Jake Rivers',
                    price: 0.99,
                    duration: '3:42',
                    genre: 'Indie Folk'
                },
                hubCategory: 'music'
            },
            {
                id: 7,
                type: 'hub-event',
                category: 'the-hub',
                author: 'Sound Pro Audio - Marcus',
                time: '3 hours ago',
                content: 'Professional sound engineer available for your events! 15+ years experience with concerts, weddings, and corporate events.',
                likes: 34,
                comments: 12,
                shares: 8,
                serviceRates: {
                    hourlyRate: '$75/hour',
                    dayRate: '$500/day',
                    equipment: 'Full PA system included',
                    experience: '15+ years'
                },
                hubCategory: 'services'
            },
            {
                id: 8,
                type: 'hub-equipment',
                category: 'the-hub',
                author: 'Alex Thompson - Guitarist',
                time: '5 hours ago',
                content: 'Selling my beloved 2019 Fender Stratocaster. Amazing tone, perfect for gigs or studio work. Includes hardcase and strap!',
                likes: 67,
                comments: 15,
                shares: 12,
                equipmentSale: {
                    item: '2019 Fender Stratocaster',
                    price: '$850',
                    condition: 'Excellent',
                    includes: 'Hardcase, strap, cables'
                },
                hubCategory: 'equipment',
                image: 'https://via.placeholder.com/500x300/0d0221/ff6b35?text=Fender+Stratocaster'
            },
            {
                id: 9,
                type: 'hub-event',
                category: 'the-hub',
                author: 'DJ Luna - Event DJ',
                time: '8 hours ago',
                content: 'Available for all your party needs! Weddings, birthdays, corporate events. Let\'s make your event unforgettable! 🎧',
                likes: 45,
                comments: 18,
                shares: 9,
                djRates: {
                    weddingRate: '$300/4 hours',
                    partyRate: '$200/3 hours',
                    equipment: 'Professional DJ setup',
                    genres: 'All genres available'
                },
                hubCategory: 'services'
            },
            {
                id: 10,
                type: 'hub-event',
                category: 'the-hub',
                author: 'Community Theater Group',
                time: '12 hours ago',
                content: 'AUDITIONS OPEN: "A Midsummer Night\'s Dream" - Feb 15-17 at Central Library. All skill levels welcome! 🎭',
                likes: 123,
                comments: 31,
                shares: 45,
                auditionInfo: {
                    play: 'A Midsummer Night\'s Dream',
                    dates: 'Feb 15-17, 2025',
                    location: 'Central Library Theater',
                    time: '7:00 PM - 9:00 PM',
                    requirements: 'All skill levels welcome'
                },
                hubCategory: 'theater',
                eventDetails: {
                    date: '2025-02-15',
                    time: '19:00',
                    location: 'Central Library Theater',
                    interested: 47
                }
            },
            {
                id: 7,
                type: 'rentals',
                category: 'rentals',
                author: 'Outdoor Adventures Co',
                time: '3 hours ago',
                content: 'Weekend camping package available for rent! Includes tent, sleeping bags, camping chairs, and portable grill. Perfect for families!',
                likes: 31,
                comments: 12,
                shares: 8,
                price: 85.00,
                image: 'https://via.placeholder.com/500x300/0d0221/00ffff?text=Camping+Package'
            },
            {
                id: 8,
                type: 'services',
                category: 'services',
                author: 'HandyHelper Tom',
                time: '5 hours ago',
                content: 'Available for home repairs this weekend! Specializing in plumbing, electrical work, and general maintenance. Local references available.',
                likes: 18,
                comments: 7,
                shares: 5
            },
            {
                id: 9,
                type: 'hub',
                category: 'hub',
                author: 'Echo & The Soundwaves',
                time: '2 hours ago',
                content: '🎵 NEW SINGLE RELEASE! "City Lights" is now available for download. Support local music and get your copy today!',
                likes: 67,
                comments: 23,
                shares: 31,
                hubCategory: 'music',
                musicRelease: {
                    title: 'City Lights',
                    artist: 'Echo & The Soundwaves',
                    genre: 'Alternative Rock',
                    price: 0.99,
                    duration: '3:47',
                    album: 'Urban Dreams EP'
                }
            },
            {
                id: 10,
                type: 'hub',
                category: 'hub',
                author: 'SoundCraft Pro Audio',
                time: '4 hours ago',
                content: '🎧 Professional sound equipment rates for your events! Full PA systems, microphones, mixing boards - everything you need for a successful show.',
                likes: 34,
                comments: 12,
                shares: 18,
                hubCategory: 'equipment',
                serviceRates: {
                    basicPA: '$150/day',
                    fullSystem: '$300/day',
                    recordingSetup: '$200/day',
                    technician: '$50/hour',
                    delivery: '$25 (within 10 miles)'
                }
            },
            {
                id: 11,
                type: 'hub',
                category: 'hub',
                author: 'Marcus Thompson Music',
                time: '6 hours ago',
                content: '🎸 Guitar lessons available! Professional instructor with 15+ years experience. All styles welcome - rock, jazz, classical, country.',
                likes: 45,
                comments: 19,
                shares: 22,
                hubCategory: 'lessons',
                lessonInfo: {
                    instructor: 'Marcus Thompson',
                    experience: '15+ years',
                    styles: ['Rock', 'Jazz', 'Classical', 'Country'],
                    rates: {
                        single: '$40/hour',
                        package4: '$140 (4 lessons)',
                        monthly: '$120 (weekly lessons)'
                    },
                    location: 'Home studio or travel to you (+$10)'
                }
            },
            {
                id: 12,
                type: 'hub',
                category: 'hub',
                author: 'Vintage Instruments Co.',
                time: '1 day ago',
                content: '🎺 RARE FIND: 1970s Fender Jazz Bass for sale! Excellent condition, original case included. Serious inquiries only.',
                likes: 89,
                comments: 34,
                shares: 41,
                hubCategory: 'sale',
                instrumentSale: {
                    instrument: 'Fender Jazz Bass',
                    year: '1970s',
                    condition: 'Excellent',
                    price: 2850,
                    includes: ['Original hardshell case', 'Certificate of authenticity', 'Recent professional setup'],
                    serialNumber: 'F******45',
                    description: 'Classic 70s jazz bass with that vintage tone. Recently serviced by certified Fender tech.'
                }
            }
        ];

        // Filter functionality
        let currentFilter = 'all';
        let currentSearchTerm = '';

        // Handle dropdown filter changes
        function handleFilterChange(filterType, value) {
            if (filterType === 'category') {
                currentFilter = value;
            } else if (filterType === 'location') {
                const townSearchContainer = document.querySelector('.town-search-container');
                if (value === 'town-search') {
                    townSearchContainer.style.display = 'block';
                } else {
                    townSearchContainer.style.display = 'none';
                }
            }
            renderPosts();
        }
        
        function initializeFilters() {
            // Keep existing filter button functionality for any remaining buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    // Remove active class from all buttons in the same group
                    const group = this.closest('.filter-group');
                    group.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    
                    // Add active class to clicked button
                    this.classList.add('active');
                    
                    // Update filter and render posts
                    const filterType = this.getAttribute('data-filter');
                    if (filterType === 'all' || filterType === 'nearby') {
                        currentFilter = 'all';
                        document.querySelector('.town-search-container').style.display = 'none';
                    } else if (filterType === 'town-search') {
                        currentFilter = 'all';
                        document.querySelector('.town-search-container').style.display = 'block';
                    } else {
                        currentFilter = filterType;
                        document.querySelector('.town-search-container').style.display = 'none';
                    }
                    renderPosts();
                });
            });

            // Initialize radius slider
            const radiusSlider = document.getElementById('radiusSlider');
            const radiusValue = document.getElementById('radiusValue');
            radiusSlider.addEventListener('input', function() {
                radiusValue.textContent = this.value + ' miles';
                // In a real app, this would filter posts by radius
            });

            // Initialize town search
            document.querySelector('.search-town-btn').addEventListener('click', function() {
                const townName = document.getElementById('townSearch').value;
                if (townName.trim()) {
                    // In a real app, this would filter posts by town
                    console.log('Searching for posts in:', townName);
                    alert(`Searching for posts in ${townName}...`);
                }
            });
        }

        // Post type selector
        function initializePostTypes() {
            document.querySelectorAll('.post-type-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.post-type-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    const type = this.getAttribute('data-type');
                    
                    // Show/hide poll creator and event creator
                    const pollCreator = document.getElementById('pollCreator');
                    const eventCreator = document.getElementById('eventCreator');
                    
                    if (type === 'poll') {
                        pollCreator.style.display = 'block';
                        eventCreator.style.display = 'none';
                        document.getElementById('postInput').placeholder = 'What would you like to ask the community?';
                    } else if (type === 'events') {
                        pollCreator.style.display = 'none';
                        eventCreator.style.display = 'block';
                        document.getElementById('postInput').placeholder = 'Describe your event...';
                    } else {
                        pollCreator.style.display = 'none';
                        eventCreator.style.display = 'none';
                        
                        // Update placeholder based on type
                        const placeholders = {
                            general: 'What\'s happening in your community?',
                            product: 'What are you selling or looking for?',
                            iso: 'What are you looking for?',
                            events: 'What event are you hosting or promoting?',
                            rentals: 'What do you have available for rent?',
                            services: 'What services are you offering?',
                            shop: 'What\'s new in your shop?'
                        };
                        document.getElementById('postInput').placeholder = placeholders[type] || placeholders.general;
                    }
                });
            });
        }

        // Search functionality
        function initializeSearch() {
            const searchInput = document.getElementById('searchInput');
            searchInput.addEventListener('input', function() {
                currentSearchTerm = this.value.toLowerCase();
                renderPosts();
            });
        }

        // Render posts based on current filter and search
        function renderPosts() {
            const feedContainer = document.getElementById('feedPosts');
            let filteredPosts = samplePosts;

            // Apply category filter
            if (currentFilter !== 'all') {
                filteredPosts = filteredPosts.filter(post => 
                    post.category === currentFilter || post.type === currentFilter
                );
            }

            // Apply search filter
            if (currentSearchTerm) {
                filteredPosts = filteredPosts.filter(post => 
                    post.content.toLowerCase().includes(currentSearchTerm) ||
                    post.author.toLowerCase().includes(currentSearchTerm)
                );
            }

            // Render posts
            feedContainer.innerHTML = filteredPosts.map(post => createPostHTML(post)).join('');
        }

        // Create post HTML
        function createPostHTML(post) {
            // Demo posts (created during development) get no badge
            // Member posts (created by real signed-up users) get member badge
            // All current posts are demo posts since we created them
            const isUserCreatedPost = post.createdByUser === true; // Only real user-created posts get badges
            const badge = isUserCreatedPost ? '<span class="member-badge">Member</span>' : '';
            
            let postContent = `
                <div class="feed-post" data-category="${post.category}" id="post-${post.id}">
                    <div class="post-header">
                        <div class="user-avatar">${post.author.charAt(0)}</div>
                        <div class="post-meta">
                            <div class="post-author">${post.author} ${badge}</div>
                            <div class="post-time">${post.time}</div>
                        </div>
                        <div class="post-category">${post.category.replace('-', '/')}</div>
                    </div>
                    <div class="post-content">${post.content}</div>
            `;

            // Add image if present
            if (post.image) {
                postContent += `<img src="${post.image}" alt="Post image" class="post-image">`;
            }

            // Add shop items if present
            if (post.shopItems) {
                postContent += `
                    <div class="shop-showcase">
                        ${post.shopItems.map(item => `
                            <div class="shop-item">
                                <div class="shop-item-image">${item.emoji}</div>
                                <div class="shop-item-name">${item.name}</div>
                                <div class="shop-item-price">${item.price}</div>
                                <div class="item-actions">
                                    <button class="item-action-btn counter-offer" onclick="makeCounterOffer('${item.name}', '${item.price}')">
                                        💰 Counter Offer
                                    </button>
                                    <button class="item-action-btn add-to-cart" onclick="addToCart('${item.name}')">
                                        🛒 Add to Cart
                                    </button>
                                    <button class="item-action-btn deliver-now" onclick="deliverNow('${item.name}')">
                                        🚚 Deliver Now
                                    </button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            // Add individual post price and actions if it's a direct product post
            if (post.price) {
                postContent += `<div class="post-price">$${post.price.toFixed(2)}</div>`;
                
                // Add service booking buttons for services
                if (post.hasBookNow) {
                    postContent += `
                        <div class="service-actions">
                            <button class="service-action-btn book-now" onclick="bookService(${post.id}, '${post.serviceType}')">
                                📅 Book Now
                            </button>
                            <button class="service-action-btn contact-service" onclick="contactService(${post.id})">
                                💬 Contact
                            </button>
                        </div>
                    `;
                }
                
                // Add e-commerce buttons for items for sale, rent, and shops
                if (post.hasCounterOffer || post.hasAddToCart || post.hasDeliverNow) {
                    postContent += `<div class="item-actions">`;
                    
                    if (post.hasCounterOffer) {
                        postContent += `<button class="item-action-btn counter-offer" onclick="makeCounterOffer(${post.id}, ${post.price})">💰 Counter Offer</button>`;
                    }
                    
                    if (post.hasAddToCart) {
                        postContent += `<button class="item-action-btn add-to-cart" onclick="addToCart(${post.id})">🛒 Add to Cart</button>`;
                    }
                    
                    if (post.hasDeliverNow) {
                        postContent += `<button class="item-action-btn deliver-now" onclick="deliverNow(${post.id})">🚚 Deliver Now</button>`;
                    }
                    
                    postContent += `</div>`;
                }
            }

            // Add Hub entertainment content
            if (post.category === 'hub') {
                if (post.musicRelease) {
                    postContent += `
                        <div class="music-release-card">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <div>
                                    <div style="font-weight: bold; color: #9d4edd; font-size: 18px;">${post.musicRelease.title}</div>
                                    <div style="color: #00ffff;">${post.musicRelease.artist} • ${post.musicRelease.genre}</div>
                                    <div style="color: rgba(255,255,255,0.7); font-size: 14px;">${post.musicRelease.duration} • ${post.musicRelease.album}</div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="color: white; font-size: 20px; font-weight: bold;">$${post.musicRelease.price}</div>
                                    <button class="buy-music-btn" onclick="buyMusic('${post.musicRelease.title}')">Buy Now</button>
                                </div>
                            </div>
                        </div>
                    `;
                }

                if (post.serviceRates) {
                    postContent += `
                        <div class="service-rates-card">
                            <div style="color: #00ffff; font-weight: bold; margin-bottom: 10px;">Equipment Rental Rates</div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                <div>Basic PA System: <span style="color: #00ffff;">${post.serviceRates.basicPA}</span></div>
                                <div>Full System: <span style="color: #00ffff;">${post.serviceRates.fullSystem}</span></div>
                                <div>Recording Setup: <span style="color: #00ffff;">${post.serviceRates.recordingSetup}</span></div>
                                <div>Technician: <span style="color: #00ffff;">${post.serviceRates.technician}</span></div>
                            </div>
                            <div style="margin-top: 10px; color: rgba(255,255,255,0.8);">Delivery: ${post.serviceRates.delivery}</div>
                            <button class="interested-btn" onclick="contactService('${post.author}')">Get Quote</button>
                        </div>
                    `;
                }

                if (post.lessonInfo) {
                    postContent += `
                        <div class="service-rates-card">
                            <div style="color: #00ffff; font-weight: bold; margin-bottom: 10px;">Lesson Details</div>
                            <div style="margin-bottom: 10px;">
                                <div>Instructor: <span style="color: #00ffff;">${post.lessonInfo.instructor}</span></div>
                                <div>Experience: <span style="color: #00ffff;">${post.lessonInfo.experience}</span></div>
                                <div>Styles: <span style="color: #00ffff;">${post.lessonInfo.styles.join(', ')}</span></div>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                                <div>Single: <span style="color: #00ffff;">${post.lessonInfo.rates.single}</span></div>
                                <div>4-Pack: <span style="color: #00ffff;">${post.lessonInfo.rates.package4}</span></div>
                                <div>Monthly: <span style="color: #00ffff;">${post.lessonInfo.rates.monthly}</span></div>
                            </div>
                            <div style="color: rgba(255,255,255,0.8); margin-bottom: 10px;">${post.lessonInfo.location}</div>
                            <button class="interested-btn" onclick="bookLesson('${post.author}')">Book Lesson</button>
                        </div>
                    `;
                }

                if (post.instrumentSale) {
                    postContent += `
                        <div class="equipment-sale-card">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <div>
                                    <div style="font-weight: bold; color: #ff6b35; font-size: 18px;">${post.instrumentSale.instrument}</div>
                                    <div style="color: #00ffff;">Year: ${post.instrumentSale.year} • Condition: ${post.instrumentSale.condition}</div>
                                    <div style="color: rgba(255,255,255,0.7); font-size: 14px;">Serial: ${post.instrumentSale.serialNumber}</div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="color: white; font-size: 24px; font-weight: bold;">$${post.instrumentSale.price.toLocaleString()}</div>
                                </div>
                            </div>
                            <div style="margin-bottom: 10px;">
                                <div style="color: #00ffff; font-weight: bold; margin-bottom: 5px;">Includes:</div>
                                <ul style="margin: 0; padding-left: 20px; color: rgba(255,255,255,0.8);">
                                    ${post.instrumentSale.includes.map(item => `<li>${item}</li>`).join('')}
                                </ul>
                            </div>
                            <div style="color: rgba(255,255,255,0.8); margin-bottom: 10px;">${post.instrumentSale.description}</div>
                            <button class="interested-btn" onclick="inquireInstrument('${post.instrumentSale.instrument}')">Serious Inquiries</button>
                        </div>
                    `;
                }
            }

            // Add poll if present
            if (post.poll) {
                postContent += `
                    <div class="poll-container">
                        <div class="poll-question">${post.poll.question}</div>
                        ${post.poll.options.map(option => `
                            <div class="poll-option">
                                <span>${option.text}</span>
                                <span class="poll-percentage">${option.percentage}%</span>
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            // Add post actions with heart favorite
            postContent += `
                    <div class="post-actions">
                        <button class="action-btn">
                            <span>👍</span>
                            <span>${post.likes}</span>
                        </button>
                        <button class="action-btn">
                            <span>💬</span>
                            <span>${post.comments}</span>
                        </button>
                        <button class="action-btn">
                            <span>📤</span>
                            <span>${post.shares}</span>
                        </button>
                        <button class="action-btn" onclick="shareToFacebook(${post.id}, \`${post.content.replace(/`/g, '\\`')}\`, '${post.author}')">
                            <span>📘</span>
                        </button>
                        <button class="action-btn favorite-btn" onclick="togglePostFavorite(${post.id})" id="favorite-${post.id}">
                            <span>♡</span>
                        </button>
                    </div>
                </div>
            `;

            return postContent;
        }

        // Create new post
        function createPost() {
            const postInput = document.getElementById('postInput');
            const activeType = document.querySelector('.post-type-btn.active').getAttribute('data-type');
            
            if (!postInput.value.trim()) {
                alert('Please enter some content for your post!');
                return;
            }

            // Create new post object
            const newPost = {
                id: Date.now(),
                type: activeType,
                category: activeType === 'general' ? 'general' : activeType,
                author: currentUser ? currentUser.fullName : 'Demo User',
                time: 'Just now',
                content: postInput.value,
                likes: 0,
                comments: 0,
                shares: 0,
                isDemo: !currentUser || isDemo(currentUser)
            };

            // Handle poll creation
            if (activeType === 'poll') {
                const pollQuestion = document.getElementById('pollQuestion').value;
                const pollOptions = Array.from(document.querySelectorAll('.poll-option-field'))
                    .map(input => input.value.trim())
                    .filter(value => value !== '');

                if (!pollQuestion.trim() || pollOptions.length < 2) {
                    alert('Please provide a poll question and at least 2 options!');
                    return;
                }

                newPost.poll = {
                    question: pollQuestion,
                    options: pollOptions.map(option => ({
                        text: option,
                        votes: 0,
                        percentage: 0
                    }))
                };

                // Reset poll creator
                document.getElementById('pollQuestion').value = '';
                document.querySelectorAll('.poll-option-field').forEach(input => input.value = '');
            }

            samplePosts.unshift(newPost);
            postInput.value = '';
            document.getElementById('pollCreator').style.display = 'none';
            document.querySelector('.post-type-btn[data-type="general"]').classList.add('active');
            document.querySelectorAll('.post-type-btn:not([data-type="general"])').forEach(btn => btn.classList.remove('active'));
            renderPosts();
            setTimeout(checkPostFavorites, 100);
        }

        // Poll creation functions
        function addPollOption() {
            const container = document.querySelector('.poll-options-container');
            const optionCount = container.children.length;
            
            if (optionCount >= 6) {
                alert('Maximum 6 poll options allowed');
                return;
            }

            const newOption = document.createElement('div');
            newOption.className = 'poll-option-input';
            newOption.innerHTML = `
                <input type="text" placeholder="Option ${optionCount + 1}" class="poll-option-field">
                <button class="remove-option-btn" onclick="removePollOption(this)">✕</button>
            `;
            container.appendChild(newOption);

            // Show remove buttons if more than 2 options
            if (optionCount >= 2) {
                document.querySelectorAll('.remove-option-btn').forEach(btn => {
                    btn.style.display = 'block';
                });
            }
        }

        function removePollOption(button) {
            const container = document.querySelector('.poll-options-container');
            const optionDiv = button.parentElement;
            container.removeChild(optionDiv);

            // Hide remove buttons if only 2 options left
            if (container.children.length <= 2) {
                document.querySelectorAll('.remove-option-btn').forEach(btn => {
                    btn.style.display = 'none';
                });
            }

            // Update placeholders
            Array.from(container.children).forEach((child, index) => {
                const input = child.querySelector('.poll-option-field');
                input.placeholder = `Option ${index + 1}`;
            });
        }

        // Facebook sharing function
        function shareToFacebook(postId, content, author) {
            // Clean content for sharing
            const cleanContent = content.replace(/'/g, "\\'").substring(0, 200);
            const shareUrl = encodeURIComponent(window.location.href + '#post-' + postId);
            const shareText = encodeURIComponent(`Check out this post from ${author} on MarketPace: "${cleanContent}${cleanContent.length >= 200 ? '...' : ''}"`);
            const facebookUrl = `https://www.facebook.com/sharer/sharer.php?u=${shareUrl}&quote=${shareText}`;
            window.open(facebookUrl, '_blank', 'width=600,height=400,scrollbars=yes,resizable=yes');
        }

        // Main Menu Functions
        function toggleMainMenu() {
            const menu = document.getElementById('mainMenu');
            if (menu.style.display === 'none' || menu.style.display === '') {
                menu.style.display = 'flex';
                // Reset menu scroll position when opening
                menu.scrollTop = 0;
                // Also close calendar if it's open
                const expanded = document.getElementById('menuCalendarExpanded');
                const arrow = document.getElementById('menuCalendarArrow');
                if (expanded && expanded.classList.contains('active')) {
                    expanded.classList.remove('active');
                    arrow.textContent = '▼';
                }
            } else {
                menu.style.display = 'none';
            }
        }

        // Menu Calendar Functions
        function toggleMenuCalendar() {
            const expanded = document.getElementById('menuCalendarExpanded');
            const arrow = document.getElementById('menuCalendarArrow');
            const mainMenu = document.getElementById('mainMenu');
            
            if (expanded.classList.contains('active')) {
                expanded.classList.remove('active');
                arrow.textContent = '▼';
                // Allow main menu to scroll normally
                if (mainMenu) {
                    mainMenu.style.overflowY = 'auto';
                }
            } else {
                expanded.classList.add('active');
                arrow.textContent = '▲';
                // Generate calendar when opened
                setTimeout(() => {
                    generateCalendar();
                }, 100);
                // Scroll to calendar section
                setTimeout(() => {
                    if (mainMenu) {
                        const calendarSection = document.querySelector('.menu-calendar-section');
                        if (calendarSection) {
                            calendarSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        }
                    }
                }, 200);
            }
        }

        function navigateToFavorites() {
            alert('Navigating to Favorites page...');
            toggleMainMenu();
        }

        function navigateToForYou() {
            alert('Navigating to For You page...');
            toggleMainMenu();
        }

        function showPrivacyPolicies() {
            alert('Privacy Policies:\n\n• We collect minimal data necessary for platform operation\n• Your personal information is never sold to third parties\n• All data is encrypted and stored securely\n• You can export or delete your data at any time');
            toggleMainMenu();
        }

        function showAccountSettings() {
            alert('Account Settings:\n\n• Update profile information\n• Change password\n• Notification preferences\n• Privacy settings\n• Account deletion');
            toggleMainMenu();
        }

        function showIntegrations() {
            alert('Website Integrations:\n\n• Connect your existing online store\n• Shopify integration\n• Facebook Shop sync\n• TikTok Shop connection\n• Custom website embedding');
            toggleMainMenu();
        }

        function showAnalytics() {
            alert('Profile Analytics:\n\n• Post performance metrics\n• Engagement statistics\n• Shop visit analytics\n• Revenue tracking\n• Community interaction insights');
            toggleMainMenu();
        }

        function upgradeToDual() {
            alert('Upgrade to Dual Profile:\n\n• Add business features\n• Create professional shop\n• Advanced analytics\n• Marketing tools\n• Priority support');
            toggleMainMenu();
        }

        // Profile Functions
        function openProfile() {
            window.location.href = '/profile';
        }

        // Item Action Functions
        function makeCounterOffer(itemId, currentPrice) {
            alert(`🚀 DEMO MODE - Counter Offer Preview!\n\n⚠️ Live negotiations disabled until launch\n\n📋 When we launch:\n• Make counter offers to sellers\n• Real-time negotiation messaging\n• Secure payment processing\n• Binding purchase agreements\n\n🎯 Get ready for launch:\n• Upload your items now\n• Set competitive prices\n• Write compelling descriptions\n• Take quality photos\n\n💡 Your items will be ready to sell when we go live!\nAll demo examples will be deleted at launch.`);
        }

        function addToCart(itemId) {
            // Demo mode notification
            alert(`🚀 DEMO MODE - Item Added to Preparation Cart!\n\n⚠️ Purchases disabled until launch in your area\n\n📋 What you can do now:\n• Create your profile\n• Upload items for sale/rent\n• Browse and favorite items\n• Apply to become a driver\n\n🎯 Launch Requirements:\n• Minimum 50 members in town\n• At least 5 verified drivers\n• Community readiness assessment\n\n💡 Your uploaded items will go LIVE when we launch!\nAll demo examples will be deleted at launch.`);
        }

        function deliverNow(itemId) {
            alert(`🚀 DEMO MODE - Delivery Preview!\n\n⚠️ Live delivery disabled until launch\n\n📋 When we launch in your area:\n• Estimated delivery: 2-4 hours\n• Delivery fee calculated by distance\n• Driver contact for coordination\n• Real-time tracking available\n\n🎯 Launch Requirements:\n• 50+ members in your town\n• 5+ verified drivers ready\n• Platform safety verification\n\n💡 Apply to drive now to help us launch faster!`);
        }

        // Demo popup functionality
        function showDemoPopup() {
            document.getElementById('demoPopup').classList.remove('hidden');
        }

        function signUpNow() {
            window.location.href = '/enhanced-signup';
        }

        function continueBrowsing() {
            document.getElementById('demoPopup').classList.add('hidden');
        }

        // Calendar functionality
        let currentDate = new Date();
        const eventDates = [15, 18, 22]; // Sample event dates for February

        function initializeCalendar() {
            generateCalendar();
        }

        // Community calendar functions - Now in Main Menu
        let isCalendarExpanded = false;

        function generateCalendar() {
            const calendarGrid = document.getElementById('calendarGrid');
            const currentMonthElement = document.getElementById('currentMonth');
            
            const months = ['January', 'February', 'March', 'April', 'May', 'June',
                           'July', 'August', 'September', 'October', 'November', 'December'];
            
            currentMonthElement.textContent = `${months[currentDate.getMonth()]} ${currentDate.getFullYear()}`;
            
            // Clear existing calendar
            calendarGrid.innerHTML = '';
            
            // Add day headers
            const dayHeaders = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            dayHeaders.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.textContent = day;
                dayHeader.style.fontWeight = 'bold';
                dayHeader.style.color = '#00ffff';
                dayHeader.style.textAlign = 'center';
                dayHeader.style.padding = '5px';
                calendarGrid.appendChild(dayHeader);
            });
            
            // Get first day of month and number of days
            const firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
            const lastDay = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
            const startDate = firstDay.getDay();
            const daysInMonth = lastDay.getDate();
            
            // Add empty cells for days before month starts
            for (let i = 0; i < startDate; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day';
                emptyDay.style.opacity = '0.3';
                calendarGrid.appendChild(emptyDay);
            }
            
            // Add days of month
            const today = new Date();
            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = day;
                
                // Highlight today
                if (day === today.getDate() && 
                    currentDate.getMonth() === today.getMonth() && 
                    currentDate.getFullYear() === today.getFullYear()) {
                    dayElement.classList.add('today');
                }
                
                // Add events to specific days
                if (eventDates.includes(day)) {
                    dayElement.classList.add('has-event');
                }
                
                calendarGrid.appendChild(dayElement);
            }
        }

        function previousMonth() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            generateCalendar();
        }

        function nextMonth() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            generateCalendar();
        }

        // E-commerce and service button functions
        function makeCounterOffer(postId, price) {
            if (!currentUser || isDemo(currentUser)) {
                alert('Demo Mode: Counter offers will be available when MarketPace launches in your area! Your profile is set up and ready to go.');
                return;
            }
            alert(`Making counter offer for post ${postId}. Original price: $${price}`);
        }

        function addToCart(postId) {
            if (!currentUser || isDemo(currentUser)) {
                alert('Demo Mode: Shopping cart will be available when MarketPace launches in your area! Your profile is set up and ready to go.');
                return;
            }
            alert(`Added item from post ${postId} to cart!`);
        }

        function deliverNow(postId) {
            if (!currentUser || isDemo(currentUser)) {
                alert('Demo Mode: Delivery services will be available when MarketPace launches in your area! Your profile is set up and ready to go.');
                return;
            }
            alert(`Requesting immediate delivery for post ${postId}`);
        }

        function bookService(postId, serviceType) {
            if (!currentUser || isDemo(currentUser)) {
                alert('Demo Mode: Service booking will be available when MarketPace launches in your area! Your profile is set up and ready to go.');
                return;
            }
            alert(`Booking ${serviceType} service from post ${postId}`);
        }

        function contactService(postId) {
            // Allow contacting - this is not purchasing/booking
            alert(`Contacting service provider from post ${postId}`);
        }

        // Header scroll functionality removed - header is now static

        // Calendar functions removed - no longer needed

        function toggleEventCalendar() {
            const modal = document.getElementById('eventCalendarModal');
            modal.classList.remove('hidden');
            renderCalendar();
        }

        function hideEventCalendar() {
            const modal = document.getElementById('eventCalendarModal');
            modal.classList.add('hidden');
        }

        // Hub entertainment interaction handlers
        function buyMusic(title) {
            alert(`Demo Mode: Would purchase "${title}" for $0.99. Feature available when MarketPace launches in your area!`);
        }

        function contactService(provider) {
            alert(`Demo Mode: Would send message to ${provider}. Feature available when MarketPace launches in your area!`);
        }

        function bookLesson(instructor) {
            alert(`Demo Mode: Would book lesson with ${instructor}. Feature available when MarketPace launches in your area!`);
        }

        function inquireInstrument(instrument) {
            alert(`Demo Mode: Would send serious inquiry about ${instrument}. Feature available when MarketPace launches in your area!`);
        }

        // Override the existing createPost function to handle events and real member posts
        function createPost() {
            const postInput = document.getElementById('postInput');
            const activeType = document.querySelector('.post-type-btn.active').getAttribute('data-type');
            
            if (!currentUser) {
                alert('Please sign up to create posts! Your posts will be visible to the community and help grow local engagement.');
                return;
            }
            
            if (activeType === 'events') {
                const eventDate = document.getElementById('eventDate').value;
                const eventTime = document.getElementById('eventTime').value;
                const eventLocation = document.getElementById('eventLocation').value;
                const eventType = document.getElementById('eventType').value;
                
                if (!postInput.value.trim()) {
                    alert('Please describe your event');
                    return;
                }
                
                if (!eventDate || !eventTime || !eventLocation.trim()) {
                    alert('Please fill in all event details');
                    return;
                }
                
                // Create real user event post
                const newPost = {
                    id: Date.now(),
                    author: currentUser.fullName,
                    time: 'Just now',
                    content: postInput.value,
                    category: 'hub',
                    type: 'events',
                    createdByUser: true, // This marks it as a real member post
                    eventDate: eventDate,
                    eventTime: eventTime,
                    eventLocation: eventLocation,
                    eventType: eventType,
                    likes: 0,
                    comments: 0,
                    shares: 0
                };
                
                // Add to posts array and re-render
                samplePosts.unshift(newPost);
                renderPosts();
                
                alert(`Event created successfully! Your event "${postInput.value}" is now live in the community feed.`);
                
                // Clear form
                postInput.value = '';
                document.getElementById('eventDate').value = '';
                document.getElementById('eventTime').value = '';
                document.getElementById('eventLocation').value = '';
                document.getElementById('eventType').value = 'community';
            } else {
                if (!postInput.value.trim()) {
                    alert('Please enter some content for your post');
                    return;
                }
                
                // Create real user post
                const newPost = {
                    id: Date.now(),
                    author: currentUser.fullName,
                    time: 'Just now',
                    content: postInput.value,
                    category: activeType === 'general' ? 'buy-sell' : activeType,
                    type: activeType,
                    createdByUser: true, // This marks it as a real member post
                    likes: 0,
                    comments: 0,
                    shares: 0
                };
                
                // Add to posts array and re-render
                samplePosts.unshift(newPost);
                renderPosts();
                
                alert(`Post created successfully! Your ${activeType} post is now live in the community feed.`);
                postInput.value = '';
            }
        }

        // Create header logo flow particles
        function createHeaderLogoFlowParticles() {
            const logoContainer = document.getElementById('headerLogoFlowParticles');
            if (!logoContainer) return;

            for (let i = 0; i < 8; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.className = 'header-logo-flow-particle';
                    
                    // Random starting position around logo perimeter
                    const angle = Math.random() * 2 * Math.PI;
                    const radius = 40 + Math.random() * 20;
                    const centerX = 60; // Header logo center X (70px logo)
                    const centerY = 60; // Header logo center Y (70px logo)
                    const startX = Math.cos(angle) * radius + centerX;
                    const startY = Math.sin(angle) * radius + centerY;
                    
                    // Create flowing end position
                    const flowAngle = angle + (Math.random() - 0.5) * Math.PI * 0.5;
                    const flowRadius = radius + Math.random() * 40 + 30;
                    const endX = Math.cos(flowAngle) * flowRadius + centerX;
                    const endY = Math.sin(flowAngle) * flowRadius + centerY;
                    
                    particle.style.left = '0px';
                    particle.style.top = '0px';
                    
                    // Random color with higher opacity
                    const colors = ['rgba(0, 255, 255, 0.8)', 'rgba(138, 43, 226, 0.8)', 'rgba(255, 255, 255, 0.7)'];
                    particle.style.background = colors[Math.floor(Math.random() * colors.length)];
                    
                    // Smaller size for header
                    const size = Math.random() * 2 + 1.5;
                    particle.style.width = size + 'px';
                    particle.style.height = size + 'px';
                    
                    // Set custom properties for animation
                    particle.style.setProperty('--start-x', startX + 'px');
                    particle.style.setProperty('--start-y', startY + 'px');
                    particle.style.setProperty('--end-x', endX + 'px');
                    particle.style.setProperty('--end-y', endY + 'px');
                    
                    // Random animation duration
                    particle.style.animationDuration = (Math.random() * 4 + 3) + 's';
                    
                    logoContainer.appendChild(particle);
                    
                    // Remove particle after animation
                    setTimeout(() => {
                        if (particle.parentNode) {
                            particle.parentNode.removeChild(particle);
                        }
                    }, 7000);
                }, i * 200);
            }
            
            // Restart header logo particles every 3 seconds
            setTimeout(createHeaderLogoFlowParticles, 3000);
        }

        // Favorites functionality
        function toggleFavorite() {
            const heartIcon = document.getElementById('heartIcon');
            const favoritesHeart = document.getElementById('favoritesHeart');
            const currentPage = window.location.pathname;
            
            let favorites = JSON.parse(localStorage.getItem('marketPaceFavorites') || '[]');
            
            if (favorites.includes(currentPage)) {
                // Remove from favorites
                favorites = favorites.filter(page => page !== currentPage);
                heartIcon.textContent = '♡';
                favoritesHeart.style.background = 'rgba(255, 255, 255, 0.1)';
                favoritesHeart.style.borderColor = 'rgba(255, 105, 180, 0.5)';
            } else {
                // Add to favorites
                favorites.push(currentPage);
                heartIcon.textContent = '♥';
                favoritesHeart.style.background = 'rgba(255, 105, 180, 0.3)';
                favoritesHeart.style.borderColor = 'rgba(255, 105, 180, 0.8)';
            }
            
            localStorage.setItem('marketPaceFavorites', JSON.stringify(favorites));
        }
        
        // Check if current page is favorited
        function checkFavoriteStatus() {
            const currentPage = window.location.pathname;
            const favorites = JSON.parse(localStorage.getItem('marketPaceFavorites') || '[]');
            
            if (favorites.includes(currentPage)) {
                const heartIcon = document.getElementById('heartIcon');
                const favoritesHeart = document.getElementById('favoritesHeart');
                if (heartIcon && favoritesHeart) {
                    heartIcon.textContent = '♥';
                    favoritesHeart.style.background = 'rgba(255, 105, 180, 0.3)';
                    favoritesHeart.style.borderColor = 'rgba(255, 105, 180, 0.8)';
                }
            }
        }

        // Toggle individual post favorite
        function togglePostFavorite(postId) {
            let favoritesPosts = JSON.parse(localStorage.getItem('marketPaceFavoritePosts') || '[]');
            const favoriteBtn = document.getElementById(`favorite-${postId}`);
            const heartSpan = favoriteBtn.querySelector('span');
            
            if (favoritesPosts.includes(postId)) {
                // Remove from favorites
                favoritesPosts = favoritesPosts.filter(id => id !== postId);
                heartSpan.textContent = '♡';
                favoriteBtn.style.color = 'rgba(255, 255, 255, 0.7)';
            } else {
                // Add to favorites
                favoritesPosts.push(postId);
                heartSpan.textContent = '♥';
                favoriteBtn.style.color = '#ff69b4';
            }
            
            localStorage.setItem('marketPaceFavoritePosts', JSON.stringify(favoritesPosts));
        }

        // Check post favorite status after rendering
        function checkPostFavorites() {
            const favoritesPosts = JSON.parse(localStorage.getItem('marketPaceFavoritePosts') || '[]');
            favoritesPosts.forEach(postId => {
                const favoriteBtn = document.getElementById(`favorite-${postId}`);
                if (favoriteBtn) {
                    const heartSpan = favoriteBtn.querySelector('span');
                    heartSpan.textContent = '♥';
                    favoriteBtn.style.color = '#ff69b4';
                }
            });
        }

        // Sample events data for calendar
        const calendarEvents = {
            15: [
                { title: "Community BBQ", time: "6:00 PM", type: "community" },
                { title: "Local Art Show", time: "7:30 PM", type: "entertainment" }
            ],
            22: [
                { title: "Farmers Market", time: "9:00 AM", type: "market" },
                { title: "Guitar Lessons", time: "2:00 PM", type: "service" }
            ],
            28: [
                { title: "Book Club Meeting", time: "7:00 PM", type: "community" }
            ]
        };
        
        function setupCalendarEvents() {
            setTimeout(() => {
                const calendarDays = document.querySelectorAll('.calendar-day');
                calendarDays.forEach(dayEl => {
                    const day = parseInt(dayEl.textContent);
                    if (calendarEvents[day]) {
                        dayEl.classList.add('has-event');
                        dayEl.style.cursor = 'pointer';
                        dayEl.style.background = 'rgba(0, 255, 255, 0.2)';
                        dayEl.onclick = () => showEventDetails(day);
                        dayEl.title = calendarEvents[day].map(e => e.title).join(', ');
                    }
                });
            }, 1000);
        }
        
        function showEventDetails(day) {
            const events = calendarEvents[day];
            if (!events) return;
            
            let eventDetails = `Events for September ${day}:\n\n`;
            events.forEach(event => {
                eventDetails += `• ${event.title}\n  Time: ${event.time}\n  Type: ${event.type}\n\n`;
            });
            
            alert(eventDetails);
        }

        // Initialize everything
        document.addEventListener('DOMContentLoaded', function() {
            loadUserProfile(); // Load user profile first
            createParticles();
            createHeaderLogoFlowParticles(); // Start header logo particle flow
            initializeFilters();
            initializePostTypes();
            initializeSearch();
            initializeCalendar();
            checkFavoriteStatus();
            setupCalendarEvents();
            // updateMiniCalendar removed
            renderPosts();
            

        });
    </script>

    <!-- Floating Profile Icon -->
    <div class="floating-profile" onclick="openProfile()">
        <div class="profile-avatar">D</div>
    </div>

    <!-- Main Menu Overlay -->
    <div class="main-menu" id="mainMenu" style="display: none;">
        <div class="menu-content">
            <div class="menu-header">
                <h3>Main Menu</h3>
                <button class="close-menu-btn" onclick="toggleMainMenu()">✕</button>
            </div>
            
            <!-- Calendar Section in Main Menu -->
            <div class="menu-calendar-section">
                <div class="menu-calendar-header" onclick="toggleMenuCalendar()">
                    <div class="menu-calendar-title">📅 Community Calendar</div>
                    <div class="menu-calendar-toggle">
                        <span>View Events</span>
                        <span id="menuCalendarArrow">▼</span>
                    </div>
                </div>
                
                <div class="menu-calendar-expanded" id="menuCalendarExpanded">
                    <div class="calendar-nav-header">
                        <button class="month-nav" onclick="previousMonth()">‹</button>
                        <div class="current-month" id="currentMonth">January 2025</div>
                        <button class="month-nav" onclick="nextMonth()">›</button>
                    </div>
                    <div style="text-align: right; margin-bottom: 10px;">
                        <button onclick="toggleMenuCalendar()" style="background: rgba(255,255,255,0.1); border: 1px solid rgba(0,255,255,0.3); color: #00ffff; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 12px;">Close Calendar</button>
                    </div>
                    
                    <div class="calendar-grid" id="calendarGrid">
                        <!-- Calendar days will be populated by JavaScript -->
                    </div>
                    
                    <div class="calendar-events" id="calendarEvents">
                        <div class="calendar-event">
                            <strong>Town Hall Meeting</strong> - Jan 15, 7:00 PM
                            <div style="color: rgba(255,255,255,0.7); font-size: 0.9rem;">Discuss new community initiatives</div>
                        </div>
                        <div class="calendar-event">
                            <strong>Local Market Day</strong> - Jan 20, 9:00 AM
                            <div style="color: rgba(255,255,255,0.7); font-size: 0.9rem;">Support local vendors and shops</div>
                        </div>
                        <div class="calendar-event">
                            <strong>Community Cleanup</strong> - Jan 25, 10:00 AM
                            <div style="color: rgba(255,255,255,0.7); font-size: 0.9rem;">Help beautify our neighborhood</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="menu-items">
                <button class="menu-item" onclick="navigateToFavorites()">
                    <span>⭐</span> Favorites
                </button>
                <button class="menu-item" onclick="navigateToForYou()">
                    <span>🎯</span> For You Page
                </button>
                <button class="menu-item" onclick="showPrivacyPolicies()">
                    <span>🔒</span> Privacy Policies
                </button>
                <button class="menu-item" onclick="showAccountSettings()">
                    <span>⚙️</span> Account Settings
                </button>
                <button class="menu-item" onclick="showIntegrations()">
                    <span>🔗</span> Website Integrations
                </button>
                <button class="menu-item" onclick="showAnalytics()">
                    <span>📊</span> Profile Analytics
                </button>
                <button class="menu-item" onclick="upgradeToDual()">
                    <span>🏢</span> Upgrade to Dual Profile
                </button>
            </div>
        </div>
    </div>

    <!-- Event Calendar Modal -->
    <div id="eventCalendarModal" class="modal hidden">
        <div class="modal-content calendar-modal-content">
            <div class="calendar-header">
                <button onclick="previousMonth()" class="calendar-nav-btn">‹</button>
                <h2 id="calendarMonth">February 2025</h2>
                <button onclick="nextMonth()" class="calendar-nav-btn">›</button>
            </div>
            <div id="calendarGrid" class="calendar-grid">
                <!-- Calendar will be generated here -->
            </div>
            
            <!-- Upcoming Events List -->
            <div style="margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 10px;">
                <h3 style="color: #00ffff; margin-bottom: 15px;">📅 Upcoming Events</h3>
                <div id="upcomingEventsList">
                    <div class="event-item" style="margin-bottom: 10px; padding: 10px; background: rgba(0,255,255,0.1); border-radius: 8px; border-left: 4px solid #9d4edd;">
                        <div style="font-weight: bold; color: #9d4edd;">🎵 Live Jazz Night</div>
                        <div style="color: #00ffff; font-size: 14px;">Feb 15 • 8:00 PM • Downtown Venue</div>
                        <div style="color: rgba(255,255,255,0.8); font-size: 12px;">Entertainment • $15 cover</div>
                    </div>
                    <div class="event-item" style="margin-bottom: 10px; padding: 10px; background: rgba(255,107,53,0.1); border-radius: 8px; border-left: 4px solid #ff6b35;">
                        <div style="font-weight: bold; color: #ff6b35;">🛍️ Vintage Clothing Sale</div>
                        <div style="color: #00ffff; font-size: 14px;">Feb 18 • 10:00 AM • Retro Threads Shop</div>
                        <div style="color: rgba(255,255,255,0.8); font-size: 12px;">Shop Sale • 30% off everything</div>
                    </div>
                    <div class="event-item" style="margin-bottom: 10px; padding: 10px; background: rgba(0,255,255,0.1); border-radius: 8px; border-left: 4px solid #00ffff;">
                        <div style="font-weight: bold; color: #00ffff;">🎸 Guitar Workshop</div>
                        <div style="color: #00ffff; font-size: 14px;">Feb 22 • 2:00 PM • Music Academy</div>
                        <div style="color: rgba(255,255,255,0.8); font-size: 12px;">Education • Beginner friendly</div>
                    </div>
                    <div class="event-item" style="margin-bottom: 10px; padding: 10px; background: rgba(255,107,53,0.1); border-radius: 8px; border-left: 4px solid #ff6b35;">
                        <div style="font-weight: bold; color: #ff6b35;">💻 Tech Equipment Flash Sale</div>
                        <div style="color: #00ffff; font-size: 14px;">Feb 25 • 9:00 AM • TechWorld Shop</div>
                        <div style="color: rgba(255,255,255,0.8); font-size: 12px;">Shop Sale • Laptops, phones, accessories</div>
                    </div>
                    <div class="event-item" style="margin-bottom: 10px; padding: 10px; background: rgba(157,78,221,0.1); border-radius: 8px; border-left: 4px solid #9d4edd;">
                        <div style="font-weight: bold; color: #9d4edd;">🍕 Food Truck Rally</div>
                        <div style="color: #00ffff; font-size: 14px;">Feb 28 • 12:00 PM • City Park</div>
                        <div style="color: rgba(255,255,255,0.8); font-size: 12px;">Community Event • Free entry</div>
                    </div>
                </div>
                
                <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.2);">
                    <div style="font-size: 14px; color: rgba(255,255,255,0.7);">
                        📍 All events within 25 miles of Seattle, WA<br>
                        🏪 Shops can post sale events to boost visibility<br>
                        🎭 Entertainment venues can promote upcoming shows
                    </div>
                </div>
            </div>
            
            <button onclick="hideEventCalendar()" class="close-btn" style="margin-top: 20px;">Close Calendar</button>
        </div>
    </div>

    <!-- Floating particles container -->
    <div id="particles-container"></div>

</body>
</html>